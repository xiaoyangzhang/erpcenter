<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yimayhd.erpcenter.dal.product.dao.TrafficResProductMapper">
	<resultMap id="BaseResultMap" type="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="res_id" jdbcType="INTEGER" property="resId" />
		<result column="product_name" jdbcType="VARCHAR" property="productName" />
		<result column="product_code" jdbcType="INTEGER" property="productCode" />
		<result column="num_stock" jdbcType="INTEGER" property="numStock" />
		<result column="num_sold" jdbcType="INTEGER" property="numSold" />
		<result column="adult_cost_price" jdbcType="DECIMAL" property="adultCostPrice" />
		<result column="adult_suggest_price" jdbcType="DECIMAL"
			property="adultSuggestPrice" />
		<result column="adult_same_pay" jdbcType="DECIMAL" property="adultSamePay" />
		<result column="adult_proxy_pay" jdbcType="DECIMAL" property="adultProxyPay" />
		<result column="adult_min_deposit" jdbcType="DECIMAL" property="adultMinDeposit" />
		<result column="child_cost_price" jdbcType="DECIMAL" property="childCostPrice" />
		<result column="child_suggest_price" jdbcType="DECIMAL"
			property="childSuggestPrice" />
		<result column="child_same_pay" jdbcType="DECIMAL" property="childSamePay" />
		<result column="child_proxy_pay" jdbcType="DECIMAL" property="childProxyPay" />
		<result column="child_min_deposit" jdbcType="DECIMAL" property="childMinDeposit" />
		<result column="baby_cost_price" jdbcType="DECIMAL" property="babyCostPrice" />
		<result column="baby_suggest_price" jdbcType="DECIMAL"
			property="babySuggestPrice" />
		<result column="baby_same_pay" jdbcType="DECIMAL" property="babySamePay" />
		<result column="bady_proxy_pay" jdbcType="DECIMAL" property="badyProxyPay" />
		<result column="bady_min_deposit" jdbcType="DECIMAL" property="badyMinDeposit" />
		<result column="reserve_time" jdbcType="INTEGER" property="reserveTime" />
		<result column="reserve_stock_limit" jdbcType="INTEGER"
			property="reserveStockLimit" />
		<result column="user_id" jdbcType="INTEGER" property="userId" />
		<result column="user_name" jdbcType="VARCHAR" property="userName" />
		<result column="time_create" jdbcType="TIMESTAMP" property="timeCreate" />
		<result column="time_update" jdbcType="TIMESTAMP" property="timeUpdate" />
		
		<result column="date_start" jdbcType="VARCHAR" property="dateStart" />
		<result column="num_balance" jdbcType="INTEGER" property="numBalance" />
		<result column="res_name" jdbcType="VARCHAR" property="resName" />
		<result column="lineInfo " jdbcType="VARCHAR" property="lineInfo " />
		<result column="remark " jdbcType="VARCHAR" property="remark " />
		<result column="biz_id" jdbcType="INTEGER" property="bizId" />
		<result column="operator_id" jdbcType="INTEGER" property="operatorId" />
		<result column="operator_name" jdbcType="VARCHAR" property="operatorName" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from traffic_res_product
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into traffic_res_product (id, res_id, product_name,
		product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price, adult_same_pay,
		adult_proxy_pay,
		adult_min_deposit, child_suggest_price,child_cost_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit,baby_cost_price,baby_suggest_price,
		baby_same_pay, bady_proxy_pay, bady_min_deposit,
		reserve_time,
		reserve_stock_limit, user_id,
		user_name, time_create, time_update
		)
		values (#{id,jdbcType=INTEGER}, #{resId,jdbcType=INTEGER},
		#{productName,jdbcType=VARCHAR},
		#{productCode,jdbcType=INTEGER},
		#{numStock,jdbcType=INTEGER}, #{numSold,jdbcType=INTEGER},
		#{adultCostPrice,jdbcType=DECIMAL},
		#{adultSuggestPrice,jdbcType=DECIMAL},
		#{adultSamePay,jdbcType=DECIMAL}, #{adultProxyPay,jdbcType=DECIMAL},
		#{adultMinDeposit,jdbcType=DECIMAL},
		#{childCostPrice,jdbcType=DECIMAL},
		#{childSuggestPrice,jdbcType=DECIMAL},
		#{childSamePay,jdbcType=DECIMAL},
		#{childProxyPay,jdbcType=DECIMAL},
		#{childMinDeposit,jdbcType=DECIMAL},
		#{babyCostPrice,jdbcType=DECIMAL},
		#{babySuggestPrice,jdbcType=DECIMAL},
		#{babySamePay,jdbcType=DECIMAL},
		#{badyProxyPay,jdbcType=DECIMAL}, #{badyMinDeposit,jdbcType=DECIMAL},
		#{reserveTime,jdbcType=TIMESTAMP},
		#{reserveStockLimit,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER},
		#{userName,jdbcType=VARCHAR}, #{timeCreate,jdbcType=TIMESTAMP},
		#{timeUpdate,jdbcType=TIMESTAMP}
		)
	</insert>
	<update id="updateByPrimaryKey" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update traffic_res_product
		set res_id = #{resId,jdbcType=INTEGER},
		product_name = #{productName,jdbcType=VARCHAR},
		product_code =
		#{productCode,jdbcType=INTEGER},
		num_stock =
		#{numStock,jdbcType=INTEGER},
		num_sold = #{numSold,jdbcType=INTEGER},
		adult_cost_price=#{adultCostPrice,jdbcType=DECIMAL},
		adult_suggest_price = #{adultSuggestPrice,jdbcType=DECIMAL},
		adult_same_pay = #{adultSamePay,jdbcType=DECIMAL},
		adult_proxy_pay =
		#{adultProxyPay,jdbcType=DECIMAL},
		adult_min_deposit =
		#{adultMinDeposit,jdbcType=DECIMAL},
		child_cost_price=#{childCostPrice,jdbcType=DECIMAL},
		child_suggest_price =
		#{childSuggestPrice,jdbcType=DECIMAL},
		child_same_pay =
		#{childSamePay,jdbcType=DECIMAL},
		child_proxy_pay =
		#{childProxyPay,jdbcType=DECIMAL},
		child_min_deposit =
		#{childMinDeposit,jdbcType=DECIMAL},
		baby_cost_price=#{babyCostPrice,jdbcType=DECIMAL},
		baby_suggest_price =
		#{babySuggestPrice,jdbcType=DECIMAL},
		baby_same_pay =
		#{babySamePay,jdbcType=DECIMAL},
		bady_proxy_pay =
		#{badyProxyPay,jdbcType=DECIMAL},
		bady_min_deposit =
		#{badyMinDeposit,jdbcType=DECIMAL},
		reserve_time =
		#{reserveTime,jdbcType=TIMESTAMP},
		reserve_stock_limit =
		#{reserveStockLimit,jdbcType=INTEGER},
		user_id =
		#{userId,jdbcType=INTEGER},
		user_name = #{userName,jdbcType=VARCHAR},
		time_update =now()
		where id = #{id,jdbcType=INTEGER}
	</update>
	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select id, res_id, product_name, product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay,
		adult_min_deposit, child_suggest_price,
		child_cost_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit, 
		baby_cost_price,
		baby_suggest_price, baby_same_pay,
		bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit,
		user_id,
		user_name, time_create,
		time_update
		from traffic_res_product
		where id = #{id,jdbcType=INTEGER}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select id, res_id, product_name, product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay,
		adult_min_deposit, 
		child_cost_price,
		child_suggest_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit,
		baby_cost_price,
		baby_suggest_price, baby_same_pay,
		bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit,
		user_id,
		user_name, time_create,
		time_update
		from traffic_res_product
	</select>

	<!-- 根据资源ID进行查询 -->
	<select id="findTrafficProductResId" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		select id, res_id, product_name, product_code, num_stock,
		num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay,
		adult_min_deposit, child_cost_price,child_suggest_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit, 
		baby_cost_price,
		baby_suggest_price, baby_same_pay,
		bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit,
		user_id,
		user_name, time_create,
		time_update
		from traffic_res_product
		where res_id = #{resId}
	</select>

	<insert id="insertTrafficResProduct" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct" useGeneratedKeys="true" keyProperty="id">
		insert into
		traffic_res_product (res_id, product_name,
		product_code, num_stock,
		num_sold,
		adult_cost_price,
		adult_suggest_price, adult_same_pay, adult_proxy_pay,
		adult_min_deposit, 
		child_cost_price,
		child_suggest_price, child_same_pay,
		child_proxy_pay, child_min_deposit,
		baby_cost_price,
		baby_suggest_price,
		baby_same_pay,
		bady_proxy_pay, bady_min_deposit,
		reserve_time, reserve_stock_limit,
		user_id,
		user_name, time_create, time_update
		)
		values
		(#{resId,jdbcType=INTEGER}, #{productName,jdbcType=VARCHAR},
		#{productCode,jdbcType=INTEGER}, #{numStock,jdbcType=INTEGER},
		#{numSold,jdbcType=INTEGER},
		#{adultCostPrice,jdbcType=DECIMAL},
		#{adultSuggestPrice,jdbcType=DECIMAL},
		#{adultSamePay,jdbcType=DECIMAL}, #{adultProxyPay,jdbcType=DECIMAL},
		#{adultMinDeposit,jdbcType=DECIMAL},
		#{childCostPrice,jdbcType=DECIMAL},
		#{childSuggestPrice,jdbcType=DECIMAL},
		#{childSamePay,jdbcType=DECIMAL},
		#{childProxyPay,jdbcType=DECIMAL},
		#{childMinDeposit,jdbcType=DECIMAL},
		#{babyCostPrice,jdbcType=DECIMAL},
		#{babySuggestPrice,jdbcType=DECIMAL},
		#{babySamePay,jdbcType=DECIMAL},
		#{badyProxyPay,jdbcType=DECIMAL}, #{badyMinDeposit,jdbcType=DECIMAL},
		#{reserveTime,jdbcType=TIMESTAMP},
		#{reserveStockLimit,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER},
		#{userName,jdbcType=VARCHAR}, #{timeCreate,jdbcType=TIMESTAMP},
		#{timeUpdate,jdbcType=TIMESTAMP}
		)
	</insert>

	<select id="selectResProductId" parameterType="int" resultMap="BaseResultMap">
		select id, res_id, product_name, product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay,
		adult_min_deposit, 
		child_cost_price,
		child_suggest_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit,
		baby_cost_price,
		baby_suggest_price, baby_same_pay,
		bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit,
		user_id,
		user_name, time_create,
		time_update
		from traffic_res_product
		where id = #{id}
	</select>

	<update id="updateToSaveResProduct" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct">
		update
		traffic_res_product
		set res_id = #{resId,jdbcType=INTEGER},
		product_name = #{productName,jdbcType=VARCHAR},
		product_code =
		#{productCode,jdbcType=INTEGER},
		num_stock =
		#{numStock,jdbcType=INTEGER},
		num_sold = #{numSold,jdbcType=INTEGER},
		adult_cost_price=#{adultCostPrice,jdbcType=DECIMAL},
		adult_suggest_price = #{adultSuggestPrice,jdbcType=DECIMAL},
		adult_same_pay = #{adultSamePay,jdbcType=DECIMAL},
		adult_proxy_pay =
		#{adultProxyPay,jdbcType=DECIMAL},
		adult_min_deposit =
		#{adultMinDeposit,jdbcType=DECIMAL},
		child_cost_price=#{childCostPrice,jdbcType=DECIMAL},
		child_suggest_price =
		#{childSuggestPrice,jdbcType=DECIMAL},
		child_same_pay =
		#{childSamePay,jdbcType=DECIMAL},
		child_proxy_pay =
		#{childProxyPay,jdbcType=DECIMAL},
		child_min_deposit =
		#{childMinDeposit,jdbcType=DECIMAL},
		baby_cost_price=#{babyCostPrice,jdbcType=DECIMAL},
		baby_suggest_price =
		#{babySuggestPrice,jdbcType=DECIMAL},
		baby_same_pay =
		#{babySamePay,jdbcType=DECIMAL},
		bady_proxy_pay =
		#{badyProxyPay,jdbcType=DECIMAL},
		bady_min_deposit =
		#{badyMinDeposit,jdbcType=DECIMAL},
		reserve_time = #{reserveTime,jdbcType=TIMESTAMP},
		reserve_stock_limit = #{reserveStockLimit,jdbcType=INTEGER},
		user_id = #{userId,jdbcType=INTEGER},
		user_name = #{userName,jdbcType=VARCHAR},
		time_update =now()
		where id = #{id,jdbcType=INTEGER}
	</update>

	<delete id="delResProduct" parameterType="java.lang.Integer">
		delete from
		traffic_res_product
		where id = #{id,jdbcType=INTEGER}
	</delete>

	<select id="findByResProductId" parameterType="java.util.Set"
		resultMap="BaseResultMap">
		select id, res_id, product_name, product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay, adult_min_deposit, 
		child_cost_price,
		child_suggest_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit, 
		baby_cost_price,
		baby_suggest_price, baby_same_pay, bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit, user_id,
		user_name, time_create,time_update
		from traffic_res_product
		where id in
		<foreach collection="id" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</select>
	<select id="findByResProId" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		select id, res_id, product_name, product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay, adult_min_deposit, 
		child_cost_price,
		child_suggest_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit, 
		baby_cost_price,
		baby_suggest_price, baby_same_pay, bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit, user_id,
		user_name, time_create,time_update
		from traffic_res_product
		where id = #{id,jdbcType=INTEGER}
	</select>	

	<update id="updateByCostPricePriceId" parameterType="java.util.List">
		<foreach collection="costPriceList" index="index" item="item"
			separator=";">
			update traffic_res_product
			<set>
				adult_cost_price=#{item.adultCostPrice},
				child_cost_price=#{item.childCostPrice},
				baby_cost_price=#{item.babyCostPrice}
			</set>
			where id = #{item.id}
		</foreach>
	</update>

	<update id="updateBysuggestPriceId" parameterType="java.util.List">
		<foreach collection="suggestPriceList" index="index" item="item"
			separator=";">
			update traffic_res_product
			<set>
				adult_suggest_price=#{item.adultSuggestPrice},
				child_suggest_price=#{item.childSuggestPrice},
				baby_suggest_price=#{item.babySuggestPrice}
			</set>
			where id = #{item.id}
		</foreach>
	</update>

	<update id="updateBySamePayId" parameterType="java.util.List">
		<foreach collection="samePayList" index="index" item="item"
			separator=";">
			update traffic_res_product
			<set>
				adult_same_pay=#{item.adultSamePay},
				child_same_pay=#{item.childSamePay},
				baby_same_pay=#{item.babySamePay}
			</set>
			where id = #{item.id}
		</foreach>
	</update>

	<update id="updateByProxyPayId" parameterType="java.util.List">
		<foreach collection="proxyPayList" index="index" item="item"
			separator=";">
			update traffic_res_product
			<set>
				adult_proxy_pay=#{item.adultProxyPay},
				child_proxy_pay=#{item.childProxyPay},
				bady_proxy_pay=#{item.badyProxyPay}
			</set>
			where id = #{item.id}
		</foreach>
	</update>


	<select id="selectTrafficProductByResId" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct"
		resultMap="BaseResultMap">
		select res_id, product_name, product_code, num_stock, num_sold,
		adult_cost_price,
		adult_suggest_price,
		adult_same_pay, adult_proxy_pay, adult_min_deposit, 
		child_cost_price,
		child_suggest_price,
		child_same_pay,
		child_proxy_pay, child_min_deposit, 
		baby_cost_price,
		baby_suggest_price, baby_same_pay, bady_proxy_pay,
		bady_min_deposit, reserve_time, reserve_stock_limit, user_id,
		user_name, time_create,
		time_update
		from traffic_res_product
		where res_id = #{resId}
	</select>
	
	<select id="selectTrafficProductInfo" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct" resultMap="BaseResultMap">
	SELECT trp.*,tr.date_start,tr.num_balance,pi.operator_id,pi.operator_name FROM traffic_res_product trp 
	LEFT JOIN traffic_res tr on(tr.id=trp.res_id)
	LEFT JOIN product_info pi on(pi.id=trp.product_code)
	WHERE trp.id =#{id}
		</select>
		
	<update id="updateNumSoldById" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update traffic_res_product
		set  num_sold = #{numSold,jdbcType=INTEGER}
	 	where id = #{id,jdbcType=INTEGER}
	</update>
	
	<select id="selectTrafficProductInfoByProductCode" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct" resultMap="BaseResultMap">
	SELECT trp.*,tr.date_start,tr.num_balance FROM traffic_res_product trp 
	LEFT JOIN traffic_res tr on(tr.id=trp.res_id)
	WHERE trp.product_code =#{productCode}
	and trp.res_id=#{resId} limit 1
		</select>
		
	<select id="selectResProductListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT trp.*,tr.date_start,tr.num_balance,tr.res_name,tr.remark,lineInfo,pi.operator_id,pi.operator_name FROM traffic_res_product trp 
			LEFT JOIN traffic_res tr on(tr.id=trp.res_id)
			LEFT JOIN product_info pi on(pi.id=trp.product_code)
			LEFT JOIN (select res_id, GROUP_CONCAT(CONCAT_WS(' ',class_no,CONCAT(departure_city,'-',arrival_city), CONCAT(departure_time,'-',arrival_time)) separator '<![CDATA[<br/>]]>') as lineInfo
			from traffic_res_line group by res_id) b ON(b.res_id=tr.id)
    		where tr.state=1  and trp.product_code>0
			AND tr.biz_id =#{page.parameter.bizId,jdbcType=INTEGER}  
	  	<if test="page.parameter.productName != null and page.parameter.productName!=''">
           AND trp.product_name LIKE CONCAT('%',#{page.parameter.productName},'%' )
         </if>
         <if test="page.parameter.resMethod!=null and page.parameter.resMethod!=''">
				and tr.res_method =#{page.parameter.resMethod}
			</if>
			<if test="page.parameter.startMin != null and page.parameter.startMin!='' ">
            AND tr.date_start <![CDATA[>= ]]>#{page.parameter.startMin}
        </if>	
        <if test="page.parameter.startMax!= null and page.parameter.startMax!='' ">
            AND tr.date_start <![CDATA[<= ]]>#{page.parameter.startMax}
        </if>	
        <if test="page.parameter.resName != null and page.parameter.resName!=''">
           AND tr.res_name LIKE CONCAT('%',#{page.parameter.resName},'%' )
         </if>
        ORDER BY tr.date_start DESC
  </select>
  
  <select id="selectResProductNameCount" parameterType="com.yimayhd.erpcenter.dal.product.po.TrafficResProduct" 
  		resultType="java.lang.Integer">
		select count(id) as id from traffic_res_product 
		WHERE product_code =#{productCode} and res_id=#{resId}
</select>
	
</mapper>