<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yimayhd.erpcenter.dal.sales.sales.dao.GroupOrderMapper">
	<resultMap id="BaseResultMap" type="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="biz_id" property="bizId" jdbcType="INTEGER" />
		<result column="group_id" property="groupId" jdbcType="INTEGER" />
		<result column="supplier_id" property="supplierId" jdbcType="INTEGER" />
		<result column="supplier_name" property="supplierName" jdbcType="VARCHAR" />
		<result column="order_no" property="orderNo" jdbcType="VARCHAR" />
		<result column="order_no_sort" property="orderNoSort" jdbcType="VARCHAR" />
		<result column="order_type" property="orderType" jdbcType="INTEGER" />
		<result column="person" property="person" jdbcType="INTEGER" />
		<result column="businessName" property="businessName" jdbcType="VARCHAR" />

		<result column="sidx" property="sidx" jdbcType="VARCHAR" />
		<result column="sord" property="sord" jdbcType="VARCHAR" />
		
		<!--内部结算 总合计  -->
		<result column="sum_total" property="sumTotal" jdbcType="DECIMAL" />
		<result column="sum_qdtotal" property="sumQdtotal" jdbcType="DECIMAL" />
		<result column="sum_budget" property="sumBudget" jdbcType="DECIMAL" />
		<result column="sum_profit" property="sumProfit" jdbcType="DECIMAL" />
		
		
		<result column="budget" property="budget" jdbcType="DECIMAL" />
		
		<!-- 组团社版 新加 开始 -->
		<result column="type" property="type" jdbcType="INTEGER" />
		<result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
		<result column="guest_source_id" property="guestSourceId" jdbcType="INTEGER" />
		<result column="guest_source_name" property="guestSourceName" jdbcType="VARCHAR" />
		<result column="aiyou_group_id" property="aiyouGroupId" jdbcType="VARCHAR" />

		<result column="order_business" property="orderBusiness" jdbcType="VARCHAR" />
		<!-- 组团社版 新加 结束 -->

		<result column="supplier_code" property="supplierCode" jdbcType="VARCHAR" />
		<result column="contact_name" property="contactName" jdbcType="VARCHAR" />
		<result column="contact_tel" property="contactTel" jdbcType="VARCHAR" />
		<result column="contact_mobile" property="contactMobile" jdbcType="VARCHAR" />
		<result column="contact_fax" property="contactFax" jdbcType="VARCHAR" />
		<result column="operator_id" property="operatorId" jdbcType="INTEGER" />
		<result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
		<result column="sale_operator_id" property="saleOperatorId" jdbcType="INTEGER" />
		<result column="sale_operator_name" property="saleOperatorName" jdbcType="VARCHAR" />
		<result column="price_id" property="priceId" jdbcType="INTEGER" />
		
		<result column="num_adult" property="numAdult" jdbcType="INTEGER" />
		<result column="num_child" property="numChild" jdbcType="INTEGER" />
		<result column="num_guide" property="numGuide" jdbcType="INTEGER" />
		
		<result column="departure_date" property="departureDate" jdbcType="VARCHAR" />
		<result column="date_end" property="dateEnd" jdbcType="VARCHAR"/>
		<result column="product_id" property="productId" jdbcType="INTEGER" />
		<result column="product_brand_id" property="productBrandId" jdbcType="INTEGER" />
		<result column="product_brand_name" property="productBrandName" jdbcType="VARCHAR" />
		<result column="product_name" property="productName" jdbcType="VARCHAR" />
		<result column="product_short_name" property="productShortName" jdbcType="VARCHAR" />
		<result column="receive_mode" property="receiveMode" jdbcType="VARCHAR" />
		<result column="service_standard" property="serviceStandard" jdbcType="VARCHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="remark_internal" property="remarkInternal" jdbcType="VARCHAR" />
		<result column="creator_id" property="creatorId" jdbcType="INTEGER" />
		<result column="creator_name" property="creatorName" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="BIGINT" />
		<result column="state" property="state" jdbcType="INTEGER" />
		<result column="total" property="total" jdbcType="DECIMAL" />
		<result column="total_cash" property="totalCash" jdbcType="DECIMAL" />
		<result column="state_finance" property="stateFinance" jdbcType="INTEGER" />
		<result column="audit_user" property="auditUser" jdbcType="VARCHAR" />
		<result column="audit_user_id" property="auditUserId" jdbcType="INTEGER" />
		<result column="audit_time" property="auditTime" jdbcType="DATE" />
		<result column="total_balance" property="totalBalance" jdbcType="DECIMAL" />
		<result column="cost" property="cost" jdbcType="DECIMAL" />
		<result column="cost_cash" property="costCash" jdbcType="DECIMAL" />
		<result column="total_cost" property="totalCost" jdbcType="DECIMAL" />
		<result column="sub_income" property="subIncome" jdbcType="DECIMAL" />
		<result column="sub_price" property="subPrice" jdbcType="DECIMAL" />
		<result column="cost_balance" property="costBalance" jdbcType="DECIMAL" />
		<result column="date_start" property="dateStart" jdbcType="VARCHAR" />
		<result column="date_end" property="dateEnd" jdbcType="VARCHAR"/>
		<result column="group_cost" property="groupCost" jdbcType="DECIMAL" />
		<result column="other_total" property="otherTotal" jdbcType="DECIMAL" />
		<result column="other_total_cash" property="otherTotalCash" jdbcType="DECIMAL" />
		<result column="other_total_balance" property="otherTotalBalance" jdbcType="DECIMAL" />
		<result column="source_type_id" property="sourceTypeId" jdbcType="INTEGER" />
		<result column="source_type_name" property="sourceTypeName" jdbcType="VARCHAR" />

		<result column="province_id" property="provinceId" jdbcType="INTEGER" />
		<result column="province_name" property="provinceName" jdbcType="VARCHAR" />

		<result column="city_id" property="cityId" jdbcType="INTEGER" />
		<result column="pickUpInfo" property="pickUpInfo" jdbcType="VARCHAR" />
		<result column="transferInfo" property="transferInfo" jdbcType="VARCHAR" />
		<!-- <result column="guestInfo" property="guestInfo" jdbcType="VARCHAR" /> <result column="priceInfo" property="priceInfo" jdbcType="VARCHAR" /> -->
		<result column="city_name" property="cityName" jdbcType="VARCHAR" />
		
		<result column="depart_province_id" property="departProvinceId" jdbcType="INTEGER" />
		<result column="depart_province_name" property="departProvinceName" jdbcType="VARCHAR" />
		<result column="depart_city_id" property="departCityId" jdbcType="INTEGER" />
		<result column="depart_city_name" property="departCityName" jdbcType="VARCHAR" />
		
		<result column="num_child_baby" property="numChildBaby" jdbcType="INTEGER" />

		<result column="order_lock_state" property="orderLockState" jdbcType="INTEGER" />
		<result column="group_code" property="groupCode" jdbcType="VARCHAR" />
		<result column="group_mode" property="groupMode" jdbcType="INTEGER" />
		<result column="affirmOrderCount" property="affirmOrderCount" jdbcType="INTEGER" />
		<result column="reserveOrderCount" property="reserveOrderCount" jdbcType="INTEGER" />
		<result column="totalOrderNum" property="totalOrderNum" jdbcType="INTEGER" />
		<result column="count_double_room" property="countDoubleRoom" jdbcType="INTEGER" />
		<result column="extraBed" property="extraBed" jdbcType="INTEGER" />


		<result column="order_mode" property="orderMode" jdbcType="INTEGER" />
		<result column="limitTime" property="limitTime" jdbcType="VARCHAR" />
		<result column="ext_res_id" property="extResId" jdbcType="INTEGER" />
		<result column="ext_res_state" property="extResState" jdbcType="INTEGER" />
		<result column="ext_res_clean_time" property="extResCleanTime" jdbcType="INTEGER" />
		<result column="ext_res_clean_stock" property="extResCleanStock" jdbcType="INTEGER" />
		<result column="ext_res_prepay" property="extResPrepay" jdbcType="DECIMAL" />
		<result column="ext_res_confirm_id" property="extResConfirmId" jdbcType="INTEGER" />
		<result column="ext_res_confirm_name" property="extResConfirmName" jdbcType="VARCHAR" />
		<result column="ext_visa_info" property="extVisaInfo" jdbcType="VARCHAR" />
		<result column="sumPerson" property="sumPerson" jdbcType="INTEGER" />
		<result column="push_order_id" property="pushOrderId" jdbcType="INTEGER" />
		<result column="push_time_update" property="pushTimeUpdate" jdbcType="DATE" />
		<result column="push_supplier_name" property="pushSupplierName" jdbcType="VARCHAR" />
		<result column="buyer_nick" property="buyerNick" jdbcType="VARCHAR" />
		<result column="date_latest" property="dateLatest" jdbcType="VARCHAR"/>
		<association property="tourGroup" column="group_id" select="com.yimayhd.erpcenter.dal.sales.sales.dao.TourGroupMapper.selectByPrimaryKey" />
	</resultMap>


	<resultMap id="SaleOperatorOrderStaticMap" type="com.yimayhd.erpcenter.dal.sales.client.sales.vo.SaleOperatorOrderStatic">
		<result column="orderNum" property="orderNum" jdbcType="INTEGER" />
		<result column="saleOperatorName" property="saleOperatorName" jdbcType="VARCHAR" />
		<result column="numAdult" property="numAdult" jdbcType="INTEGER" />
		<result column="numChild" property="numChild" jdbcType="INTEGER" />
		<result column="numGuide" property="numGuide" jdbcType="INTEGER" />
		<result column="orderIncome" property="orderIncome" jdbcType="DECIMAL" />
		<result column="totalCost" property="totalCost" jdbcType="DECIMAL" />
		<result column="totalPersons" property="totalPersons" jdbcType="DECIMAL" />
		<result column="otherIncome" property="otherIncome" jdbcType="DECIMAL" />
		<result column="rayPayIncome" property="rayPayIncome" jdbcType="DECIMAL" />
		<result column="fsIncome" property="fsIncome" jdbcType="DECIMAL" />
		<result column="totalIncome" property="totalIncome" jdbcType="DECIMAL" />
	</resultMap>


	<resultMap id="SaleOperatorMap" type="com.yimayhd.erpcenter.dal.sales.client.sales.vo.SaleOperatorVo">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="group_id" property="groupId" jdbcType="INTEGER" />
		<result column="order_type" property="orderType" jdbcType="INTEGER" />
		<result column="supplier_name" property="supplierName" jdbcType="VARCHAR" />
		<result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
		<result column="sale_operator_name" property="saleOperatorName" jdbcType="VARCHAR" />
		<result column="num_adult" property="numAdult" jdbcType="INTEGER" />
		<result column="num_child" property="numChild" jdbcType="INTEGER" />
		<result column="num_guide" property="numGuide" jdbcType="INTEGER" />
		<result column="product_brand_name" property="productBrandName" jdbcType="VARCHAR" />
		<result column="product_name" property="productName" jdbcType="VARCHAR" />
		<result column="contact_name" property="contactName" jdbcType="VARCHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="group_code" property="groupCode" jdbcType="VARCHAR" />
		<result column="nums" property="nums" jdbcType="VARCHAR" />
		<result column="guestNames" property="guestNames" jdbcType="VARCHAR" />
		<result column="mobiles" property="mobiles" jdbcType="VARCHAR" />
		<result column="cerNums" property="cerNums" jdbcType="VARCHAR" />
		<result column="hotelLevels" property="hotelLevels" jdbcType="VARCHAR" />
		<result column="hotelNums" property="hotelNums" jdbcType="VARCHAR" />
		<result column="guestName" property="guestName" jdbcType="VARCHAR" />
		<result column="upAir" property="upAir" jdbcType="VARCHAR" />
		<result column="offAir" property="offAir" jdbcType="VARCHAR" />
		<result column="trans" property="trans" jdbcType="VARCHAR" />
		<result column="orderNum" property="orderNum" jdbcType="INTEGER" />
		<result column="saleOperatorName" property="saleOperatorName" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="SalePriceMap" type="com.yimayhd.erpcenter.dal.sales.client.sales.vo.SalePrice">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="mode" property="mode" jdbcType="INTEGER" />
		<result column="order_id" property="orderId" jdbcType="INTEGER" />
		<result column="item_id" property="itemId" jdbcType="VARCHAR" />
		<result column="item_name" property="itemName" jdbcType="VARCHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="unit_price" property="unitPrice" jdbcType="VARCHAR" />
		<result column="num_times" property="numTimes" jdbcType="VARCHAR" />
		<result column="num_person" property="numPerson" jdbcType="VARCHAR" />
		<result column="total_price" property="totalPrice" jdbcType="VARCHAR" />
		<result column="row_state" property="rowState" jdbcType="VARCHAR" />
		<result column="create_id" property="createId" jdbcType="VARCHAR" />
		<result column="create_name" property="createName" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="VARCHAR" />
		<result column="price_lock_state" property="priceLockState" jdbcType="VARCHAR" />
		<result column="group_code" property="groupCode" jdbcType="VARCHAR" />
		<result column="date_start" property="dateStart" jdbcType="VARCHAR" />
		<result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
		<result column="num_adult" property="numAdult" jdbcType="INTEGER" />
		<result column="num_child" property="numChild" jdbcType="INTEGER" />
		<result column="num_guide" property="numGuide" jdbcType="INTEGER" />
		<result column="supplier_name" property="supplierName" jdbcType="VARCHAR" />
		<result column="receive_mode" property="receiveMode" jdbcType="VARCHAR" />
		<result column="sale_operator_name" property="saleOperatorName" jdbcType="VARCHAR" />
		<result column="product_name" property="productName" jdbcType="VARCHAR" />
		<result column="product_brand_name" property="productBrandName" jdbcType="VARCHAR" />

	</resultMap>
	<resultMap id="groupOrderForCarCar" type="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrderForCarCar">

		<result property="groupCode" column="group_code"/>
		<collection  ofType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder" property="groupOrderList">
			<id column="id" property="id" jdbcType="INTEGER" />
			<result column="product_name" property="productName" jdbcType="VARCHAR" />
			<result column="product_brand_name" property="productBrandName" jdbcType="VARCHAR" />
			<result column="num_adult" property="numAdult" jdbcType="INTEGER" />
			<result column="num_child" property="numChild" jdbcType="INTEGER" />
			<result column="num_guide" property="numGuide" jdbcType="INTEGER" />
			<result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
			<result column="operator_id" property="operatorId" jdbcType="INTEGER" />
			<result column="receive_mode" property="receiveMode" jdbcType="VARCHAR" />
			<result column="group_id" property="groupId" jdbcType="INTEGER" />
			<result column="order_type" property="orderType" jdbcType="INTEGER" />
			<result column="departure_date" property="departureDate" jdbcType="VARCHAR" />
			<result column="product_id" property="productId" jdbcType="INTEGER" />
			<result column="product_brand_id" property="productBrandId" jdbcType="INTEGER" />
			<result column="type" property="type" jdbcType="INTEGER" />
			<result column="remark" property="remark" jdbcType="VARCHAR" />
			<result column="total" property="total" jdbcType="DECIMAL" />
			<result column="contact_name" property="contactName" jdbcType="VARCHAR" />
			<result column="contact_tel" property="contactTel" jdbcType="VARCHAR" />
			<result column="contact_mobile" property="contactMobile" jdbcType="VARCHAR" />
			<result column="contact_fax" property="contactFax" jdbcType="VARCHAR" />
			<result column="order_no" property="orderNo" jdbcType="VARCHAR" />
			<result property="guideId" column="guide_id" />
			<result property="guideName" column="guide_name" />
			<result property="guideMobile" column="guide_mobile" />
			<result column="province_name" property="provinceName" jdbcType="VARCHAR" />
			<result column="city_name" property="cityName" jdbcType="VARCHAR" />
		</collection>
	</resultMap>
	<sql id="Base_Column_List">
		id, biz_id, group_id, supplier_id,supplier_name,order_business,
		order_no,order_no_sort,order_type,type,contract_no,guest_source_id,guest_source_name,
		supplier_code,total,total_cash,
		contact_name,
		contact_tel,
		contact_mobile, contact_fax,
		operator_id,
		operator_name,
		sale_operator_id,
		sale_operator_name,
		price_id,
		num_adult,
		num_child,
		num_guide,
		num_child_baby,
		departure_date,date_end, product_id,
		product_brand_id,
		product_brand_name,
		product_name,
		product_short_name,receive_mode,
		service_standard,
		remark,
		remark_internal, creator_id,
		creator_name,
		create_time,state,state_finance,audit_user,audit_user_id,audit_time,source_type_id,source_type_name,province_id,province_name,city_id,city_name,order_lock_state,aiyou_group_id,
		ext_res_id,ext_res_state,ext_res_clean_time,ext_res_clean_stock,ext_visa_info,ext_res_prepay,ext_res_confirm_id,ext_res_confirm_name,order_mode,
		push_order_id, push_time_update, push_supplier_name,depart_province_id ,depart_province_name ,depart_city_id ,depart_city_name,buyer_nick 
	</sql>
	
	<!-- 应收款统计下对账明细中的期初、本期、期末数据 -->
	<select id="selectTotalStatic" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		SELECT
		SUM(IFNULL(go.total, 0)) as total,SUM(IFNULL(go.total_cash, 0)) as total_cash
		FROM group_order go
		left join tour_group tg on (go.group_id=tg.id)
		WHERE go.biz_id = #{bizId} AND go.state=1
		and supplier_id = #{page.parameter.supplierId}
		and IFNULL(tg.group_state,0) <![CDATA[!=]]>
		2
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- 人员 -->
		<if test="page.parameter.type == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.type == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !='' and page.parameter.provinceId !=-1">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !='' and page.parameter.cityId !=-1">
			and go.city_id =#{page.parameter.cityId}
		</if>
		<!-- 团类型 由订单类型判断 -->
		<if test="page.parameter.groupMode!=null and page.parameter.groupMode!=''">
			<if test="page.parameter.groupMode =='0'">and
				tg.group_mode <![CDATA[<=]]>
				0
			</if>
			<if test="page.parameter.groupMode =='1' ">and
				tg.group_mode <![CDATA[>]]>0
			</if>
		</if>
		<!-- 时间 -->
		<if test="page.parameter.startTime != null and page.parameter.startTime != '' and page.parameter.endTime == null">
			and departure_date <![CDATA[<]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != '' and page.parameter.startTime != null and page.parameter.startTime != '' ">
			and departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
			and departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<!-- 财务状态 -->
		<if test="page.parameter.paymentState == 0">and
			go.total <![CDATA[<>]]>go.total_cash
		</if>
		<if test="page.parameter.paymentState == 1">and go.total = go.total_cash</if>

		<if test="page.parameter.productName != null and page.parameter.productName !=''">and
			CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE CONCAT('%',#{page.parameter.productName},'%')
		</if>

	</select>
	<!-- 查询应收款项导出 -->
	<select id="selectPaymentStaticData" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		select ss.*,IFNULL(sss.preTotal,0) preTotal from (
		SELECT
		*
		FROM
		(SELECT
		supplier_id,
		supplier_name,
		operator_id,
		product_name,
		departure_date,
		create_time,
		product_brand_name,
		SUM(IFNULL(total, 0)) AS total,
		SUM(IFNULL(total_cash, 0)) AS total_cash,
		SUM(
		IFNULL(total, 0) - IFNULL(total_cash, 0)
		) AS totalBalance,
		SUM(IFNULL(num_adult, 0)) AS num_adult,
		SUM(IFNULL(num_child, 0)) AS num_child,
		SUM(IFNULL(num_guide, 0)) AS num_guide,
		COUNT(0) orderCount
		FROM
		group_order
		WHERE biz_id = #{bizId} AND state=1
		<if test="set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- 人员 -->
		<if test="page.parameter.type == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.type == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<!-- 团类型 订单类型 -->
		<if test="page.parameter.groupMode !=null and page.parameter.groupMode !=''">
			<if test="page.parameter.groupMode == 1">and
				order_type <![CDATA[=]]>1
			</if>
			<if test="page.parameter.groupMode == 0">and
				order_type <![CDATA[!=]]>1
			</if>
		</if>
		<!-- 时间 -->
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">and
			departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">and
			departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != '' ">and supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName != ''">and
			CONCAT('【',product_brand_name,'】',product_name) LIKE
			CONCAT('%',#{page.parameter.productName},'%')
		</if>

		<!-- 财务状态 -->
		<if test="page.parameter.paymentState!=null">
			<if test="page.parameter.paymentState == 0">and
				total <![CDATA[<>]]>
				total_cash
			</if>
			<if test="page.parameter.paymentState == 1">and total = total_cash</if>
		</if>
		GROUP BY supplier_id) a
		order by departure_date ,create_time ) ss
		LEFT JOIN (SELECT
		SUM(IFNULL(go.total, 0) - IFNULL(go.total_cash, 0)) AS
		preTotal,go.supplier_id,go.supplier_name FROM group_order go WHERE
		go.state =1
		and go.biz_id = #{bizId}

		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.type == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.type == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">and
			go.departure_date <![CDATA[<]]>
			#{page.parameter.startTime}
		</if>
		<!-- 团类型 判断期初欠收数 -->
		<if test="page.parameter.groupMode !=null and page.parameter.groupMode !=''">
			<if test="page.parameter.groupMode == 1">and
				go.order_type <![CDATA[=]]>1
			</if>
			<if test="page.parameter.groupMode == 0">and
				go.order_type <![CDATA[!=]]>1
			</if>
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName != ''">and
			CONCAT('【',product_brand_name,'】',product_name) LIKE
			CONCAT('%',#{page.parameter.productName},'%')
		</if>
		GROUP BY go.supplier_id
		) sss
		ON ss.supplier_id =
		sss.supplier_id
	</select>

	<select id="selectPaymentStaticData2" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		select distinct o.supplier_id,o.supplier_name as supplierName,IFNULL(s2.preTotal, 0) AS preTotal,
		COUNT(o.id) AS orderCount,
		IFNULL(SUM(o.total), 0) AS total,
		SUM(IFNULL(o.total_Cash, 0)) AS totalCash,
		SUM(o.total - IFNULL(total_Cash, 0)) totalBalance,
		IFNULL(SUM(o.num_adult), 0) AS num_adult,
		IFNULL(SUM(o.num_child), 0) AS num_child,
		IFNULL(SUM(o.num_guide), 0) AS num_guide
		from group_order o
		 left join tour_group tg on (o.group_id=tg.id)

		left join (SELECT SUM(total-total_cash) AS preTotal,supplier_id as supplierId2
		FROM group_order o left join tour_group tg on (o.group_id=tg.id)
		WHERE o.state =1 and o.biz_id = #{bizId} and IFNULL(tg.group_state,0) <![CDATA[!=]]>2
		<if test="set!=null">
			AND o.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- 人员 -->
		<if test="page.parameter.type == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.type == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<!-- 时间 -->
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">and
			departure_date <![CDATA[<]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">and supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName != ''">and
			CONCAT('【',product_brand_name,'】',product_name) LIKE CONCAT('%',#{page.parameter.productName},'%')
		</if>
		<!-- 团类型 订单类型count判断 -->
		<if test="page.parameter.groupMode !=null and page.parameter.groupMode !=''">
			<if test="page.parameter.groupMode == 1">and
				order_type <![CDATA[=]]>1
			</if>
			<if test="page.parameter.groupMode == 0">and
				order_type <![CDATA[!=]]>1
			</if>
		</if>
		<!-- 财务状态 -->
		<if test="page.parameter.paymentState!=null">
			<if test="page.parameter.paymentState == 0">and
				total <![CDATA[<>]]>
				total_cash
			</if>
			<if test="page.parameter.paymentState == 1">and total = total_cash</if>
		</if>
		GROUP BY supplier_id
		having SUM(total-total_cash) <![CDATA[!=]]>0
		)s2 ON o.supplier_id = s2.supplierId2
		where o.biz_id = #{bizId} and ((supplier_id is not null) or (s2.supplierId2 is not null))
		AND o.state=1 and IFNULL(tg.group_state,0) <![CDATA[!=]]>2
		<if test="set!=null">
			AND o.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- 人员 -->
		<if test="page.parameter.type == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.type == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<!-- 时间 -->
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">and
			departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">and
			departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">and supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName != ''">and
			CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE CONCAT('%',#{page.parameter.productName},'%')
		</if>
		<!-- 团类型 订单类型count判断 -->
		<if test="page.parameter.groupMode !=null and page.parameter.groupMode !=''">
			<if test="page.parameter.groupMode == 1">and
				order_type <![CDATA[=]]>1
			</if>
			<if test="page.parameter.groupMode == 0">and
				order_type <![CDATA[!=]]>1
			</if>
		</if>
		<!-- 财务状态 -->
		<if test="page.parameter.paymentState!=null">
			<if test="page.parameter.paymentState == 0">and
				total <![CDATA[<>]]>
				total_cash
			</if>
			<if test="page.parameter.paymentState == 1">and total = total_cash</if>
		</if>
		GROUP BY supplier_id

		order by ifNull(SUM(o.total - IFNULL(total_Cash, 0)),0)+ifNull(s2.preTotal,0) desc
	</select>
	<select id="selectTotalNumAdultByOrderId" resultType="Integer" parameterType="Integer">
		SELECT SUM(go.`num_adult`) FROM group_order go WHERE
		go.`id` = #{orderId}
	</select>
	<select id="selectTotalNumByOrderId" resultType="Integer" parameterType="Integer">
		SELECT IFNULL(go.`num_adult`,0)+IFNULL(go.`num_child`,0)+IFNULL(go.`num_guide`,0) FROM group_order go WHERE
		go.`id` = #{orderId}
	</select>
	<!-- 订单日志查询页面 -->
	<select id="selectOrderGroupByProductIdListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		go.product_id,
		go.departure_date,
		go.product_brand_name,
		go.product_name,
		COUNT(go.id) totalOrderNum,
		SUM(go.num_adult)
		totalNumAdult,
		SUM(go.num_child) totalNumChild,
		SUM(go.total) AS
		totalOrderIncome
		FROM group_order go
		WHERE go.product_id IS NOT NULL
		and
		go.biz_id=#{bizId}
		and go.state !=-1
		and go.order_type = 0
		<!-- and go.group_id IS NOT NULL -->
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>

		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in
				(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<choose>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != ''">
				<![CDATA[  and go.departure_date >=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')  and go.departure_date <=date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				and
				go.departure_date=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<![CDATA[  and go.departure_date =date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
		</choose>
		GROUP BY go.departure_date,go.product_id
	</select>
	<select id="selectOrderGroupByProductIdList" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		sum(ss.totalNumAdult) as totalAdult,
		sum(ss.totalNumChild) as totalChild,
		sum(ss.totalOrderNum) as totalOrder,
		sum(ss.totalOrderIncome) as totalSum
		from (
		SELECT
		go.product_id,
		go.departure_date,
		go.product_brand_name,
		go.product_name,
		COUNT(go.id) totalOrderNum,
		SUM(go.num_adult) totalNumAdult,
		SUM(go.num_child) totalNumChild,
		SUM(go.total) AS totalOrderIncome
		FROM group_order go
		WHERE
		go.product_id IS NOT NULL
		and go.biz_id=#{bizId}
		and go.state !=-1
		and
		go.order_type = 0
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>

		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in
				(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<choose>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != ''">
				<![CDATA[  and go.departure_date >=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')  and go.departure_date <=date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				and
				go.departure_date=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<![CDATA[  and go.departure_date =date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
		</choose>
		GROUP BY go.departure_date,go.product_id ) ss
	</select>


	<select id="getSalePriceListPage" resultMap="SalePriceMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		tg.group_code,
		tg.operator_name,
		tg.group_mode,
		gopp.*
		FROM(
		SELECT
		go.group_id,
		go.supplier_name,
		go.receive_mode,
		go.sale_operator_name,
		go.product_brand_name,
		go.product_name,
		go.departure_date date_start,
		IFNULL(go.num_adult,0) num_adult,
		IFNULL(go.num_child,0) num_child,
		IFNULL(go.num_guide,0) num_guide,
		gop.*
		FROM
		group_order_price gop
		INNER
		JOIN group_order go ON go.id = gop.`order_id`
		where go.biz_id=#{bizId}
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			and go.supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName!= ''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%',#{page.parameter.productName},'%')
		</if>
		<if test="page.parameter.saleOperatorIds != null and page.parameter.saleOperatorIds != ''">
			and go.sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode != ''">
			and go.receive_mode like
			concat('%',#{page.parameter.receiveMode},'%')
		</if>
		<if test="page.parameter.orderType == 0">and
			go.order_type <![CDATA[=]]>0
		</if>
		<if test="page.parameter.orderType == 1 ">go.order_type <![CDATA[=]]>0
		</if>
		
		<if test="page.parameter.orderType == -1 ">go.order_type <![CDATA[=]]>-1
		</if>
		<if test="page.parameter.priceType == 0">
			and gop.mode =0
		</if>
		<if test="page.parameter.priceType == 1 ">
			and gop.mode = 1
		</if>
		<if test="page.parameter.itemId != -1">
			and gop.item_id = ${page.parameter.itemId}
		</if>
		) gopp
		LEFT JOIN tour_group tg ON tg.id = gopp.group_id
		where 1=1
		<if test="page.parameter.groupCode != null and page.parameter.groupCode != ''">
			and tg.group_code LIKE
			CONCAT('%',#{page.parameter.groupCode},'%')
		</if>
	</select>
	<select id="getSalePriceToalPrice" resultType="java.math.BigDecimal" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		SUM(ss.total_price)
		FROM (
		SELECT
		tg.group_code,
		tg.operator_name,
		gopp.*
		FROM(
		SELECT
		go.group_id,
		go.supplier_name,
		go.receive_mode,
		go.sale_operator_name,
		go.departure_date date_start,
		IFNULL(go.num_adult,0) num_dult,
		IFNULL(go.num_child,0) num_child,
		IFNULL(go.num_guide,0) num_guide,
		gop.*
		FROM
		group_order_price gop
		INNER
		JOIN group_order go ON go.id = gop.`order_id`
		where go.biz_id=#{bizId}
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			and go.supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName!= ''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%',#{page.parameter.productName},'%')
		</if>
		<if test="page.parameter.saleOperatorIds != null and page.parameter.saleOperatorIds != ''">
			and go.sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode != ''">
			and go.receive_mode like
			concat('%',#{page.parameter.receiveMode},'%')
		</if>
		<if test="page.parameter.orderType == 0">and
			go.order_type <![CDATA[=]]>0
		</if>
		<if test="page.parameter.orderType == 1 ">go.order_type <![CDATA[=]]>0
		</if>
		<if test="page.parameter.orderType == -1 ">go.order_type <![CDATA[=]]>-1
		</if>
		<if test="page.parameter.itemId != -1">
			and gop.item_id = ${page.parameter.itemId}
		</if>
		and gop.mode =0
		) gopp
		LEFT JOIN tour_group tg ON tg.id = gopp.group_id
		where 1=1
		<if test="page.parameter.groupCode != null and page.parameter.groupCode != ''">
			and tg.group_code LIKE
			CONCAT('%',#{page.parameter.groupCode},'%')
		</if>
		) ss
	</select>
	<select id="selectSaleOperatorByConListPage" resultMap="SaleOperatorMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		go.id,
		go.group_id,
		go.order_type,
		go.supplier_name,
		go.operator_name,
		go.sale_operator_name,
		ifnull(go.num_adult,0) as
		numAdult,
		ifnull(go.num_child,0) as numChild,
		ifnull(go.num_guide,0) as
		numGuide,
		go.product_brand_name,
		go.product_name,
		go.contact_name,
		go.remark_internal as remark,
		tg.group_code
		FROM group_order go LEFT JOIN tour_group tg ON (tg.id = go.group_id and group_code not like '%变更%')
		WHERE go.biz_id = #{bizId}  and go.state=1   and go.num_adult+go.num_child > 0

		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.mergeGroupState!=null and page.parameter.mergeGroupState!=''">
			<if test="page.parameter.mergeGroupState==1">
				AND ifnull(go.group_id,0)<![CDATA[<>]]>0
			</if>
			<if test="page.parameter.mergeGroupState==0">AND ifnull(go.group_id,0)=0 </if>
		</if>
		<if test="page.parameter.startTime!=null and page.parameter.startTime!=''">
			AND go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime!=null and page.parameter.endTime!=''">
			AND go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.supplierName !=null and page.parameter.supplierName !=''">
			AND go.supplier_name like concat('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			AND tg.group_code like concat('%',#{page.parameter.groupCode},'%')
		</if>
		<if test="page.parameter.productName !=null and page.parameter.productName !=''">
			AND CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE CONCAT('%',#{page.parameter.productName},'%')
		</if>
		<if test="page.parameter.orderIdSet!=null">
			AND go.id IN
			<foreach item="item" index="index" collection="page.parameter.orderIdSet" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		ORDER BY go.departure_date
	</select>
	<select id="selectSaleOperatorTotalPerson" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT sum(IFNULL(go.num_adult,0)) totalAdult,sum(IFNULL(go.num_child,0)) totalChild,sum(IFNULL(go.num_guide,0)) totalGuide
		FROM group_order go
		LEFT JOIN tour_group tg ON (tg.id = go.group_id and group_code not like '%变更%')
		WHERE go.biz_id = #{bizId} and go.state=1 and go.num_adult+go.num_child > 0
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.mergeGroupState!=null and page.parameter.mergeGroupState!=''">
			<if test="page.parameter.mergeGroupState== 1">AND
				ifnull(go.group_id,0)<![CDATA[<>]]>0
			</if>
			<if test="page.parameter.mergeGroupState== 0">AND ifnull(go.group_id,0)=0</if>
		</if>
		<if test="page.parameter.startTime!=null and page.parameter.startTime!=''">
			AND go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime!=null and page.parameter.endTime!=''">
			AND go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.supplierName !=null and page.parameter.supplierName !=''">
			AND go.supplier_name like concat('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			AND tg.group_code like concat('%',#{page.parameter.groupCode},'%')
		</if>
		<if test="page.parameter.productName !=null and page.parameter.productName !=''">
			AND CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE CONCAT('%',#{page.parameter.productName},'%')
		</if>
		<if test="page.parameter.orderIdSet!=null">
			AND go.id IN
			<foreach item="item" index="index" collection="page.parameter.orderIdSet" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in(${page.parameter.saleOperatorIds})
			</if>
		</if>
		
	</select>
	<select id="selectOrderLockByConListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		go.*
		from group_order go
		left join tour_group tg on tg.id =
		go.group_id
		where go.state !=-1
		and go.biz_id = #{bizId}
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.tourGroup.groupCode!=null and page.parameter.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${page.parameter.tourGroup.groupCode}','%')
		</if>
		<if test="page.parameter.orderLockState != null">
			and go.order_lock_state =${page.parameter.orderLockState}
		</if>
		<if test="page.parameter.orderType ==1 ">
			and go.order_type =1
		</if>
		<if test="page.parameter.orderType ==0 ">
			and go.order_type =0
		</if>
		<if test="page.parameter.orderType ==-1">
			and go.order_type = -1
		</if>

		<if test="page.parameter.state ==1">
			and go.group_id is not null
		</if>
		<if test="page.parameter.state ==2">
			and go.group_id is null
		</if>

		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and go.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.receiveMode!=null and page.parameter.receiveMode!=''">
			and go.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>

		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in
				(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode != ''">
			and go.receive_mode like concat('%',#{page.parameter.receiveMode},'%')
		</if>
		<choose>
			<when test="page.parameter.startTime != null and page.parameter.startTime !='' and page.parameter.endTime != null and page.parameter.endTime != ''">
				<if test="page.parameter.dateType==1">
					<![CDATA[  and go.departure_date >=#{page.parameter.startTime} and go.departure_date <=#{page.parameter.endTime}]]>
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[  and go.create_time >= #{page.parameter.startTime} and go.create_time <= #{page.parameter.endTime}]]>
				</if>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				<if test="page.parameter.dateType==1">
					and go.departure_date=#{page.parameter.startTime}
				</if>
				<if test="page.parameter.dateType==2">
					and go.create_time=#{page.parameter.startTime}
				</if>
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<if test="page.parameter.dateType==1">
					<![CDATA[  and go.departure_date =#{page.parameter.endTime}]]>
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[  and go.create_time = #{page.parameter.endTime} ]]>
				</if>
			</when>
		</choose>
		ORDER BY go.departure_date,go.create_time
	</select>
	<select id="selectOrderLockByCon" resultType="String" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		CONCAT(
		CONVERT(numAdult, CHAR),
		'+',
		CONVERT(numChild, CHAR),
		'+',
		CONVERT(numGuide, CHAR)
		)
		FROM (
		SELECT
		IFNULL(SUM(go.num_adult),0) AS
		numAdult,
		IFNULL(SUM(go.num_child),0) AS numChild,
		IFNULL(SUM(go.num_guide),0) AS numGuide
		FROM
		group_order go
		left join
		tour_group tg on tg.id = go.group_id
		where go.state !=-1
		and
		go.biz_id =
		#{bizId}
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.tourGroup.groupCode!=null and page.parameter.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${page.parameter.tourGroup.groupCode}','%')
		</if>
		<if test="page.parameter.orderLockState != null">
			and go.order_lock_state =${page.parameter.orderLockState}
		</if>
		<if test="page.parameter.orderType ==1 ">
			and go.order_type =1
		</if>
		<if test="page.parameter.orderType ==0 ">
			and go.order_type =0
		</if>
		<if test="page.parameter.orderType ==-1">
			and go.order_type = -1
		</if>

		<if test="page.parameter.state ==1">
			and go.group_id is not null
		</if>
		<if test="page.parameter.state ==2">
			and go.group_id is null
		</if>

		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and go.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.receiveMode!=null and page.parameter.receiveMode!=''">
			and go.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>

		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in
				(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<choose>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != ''">
				<![CDATA[  and go.departure_date >=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')  and go.departure_date <=date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				and
				go.departure_date=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<![CDATA[  and go.departure_date =date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
		</choose>
		ORDER BY go.departure_date,go.create_time ) ss
	</select>
	<select id="selectSupplierByGroupIdAndSupplierId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT
		go.id,go.supplier_id,go.supplier_name,go.receive_mode FROM
		group_order
		go
		INNER JOIN tour_group tg ON tg.id = go.group_id
		where go.supplier_id = #{supplierId}
		AND tg.id = #{groupId}
	</select>
	<select id="selectSupplierByGroupId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT go.supplier_id,go.supplier_name FROM group_order
		go
		INNER JOIN tour_group tg ON tg.id = go.group_id AND tg.id =
		#{groupId}
		GROUP BY go.supplier_id
	</select>
	<select id="selectSaleOperatorOrderStaticCon" resultMap="SaleOperatorOrderStaticMap" parameterType="com.yihg.mybatis.utility.PageBean">

		SELECT
		SUM(orderNum) sumOrderNum,
		SUM(totalPersons) sumTotalPersons,
		SUM(numAdult) sumAdult,
		SUM(numChild) sumChild,
		SUM(numGuide) SumGuide,
		SUM(orderIncome) sumOrderIncome,
		SUM(totalCost) sumTotalCost,
		SUM(totalIncome) sumTotalIncome,
		SUM(otherIncome) sumOtherIncome,
		SUM(rayPayIncome) sumRayPayIncome,
		SUM(fsIncome) sumFsIncome
		FROM (
		SELECT
		go.sale_operator_name AS saleOperatorName,
		COUNT(go.id) orderNum,
		SUM(tg.`total_adult`+tg.`total_child`+tg.`total_guide`) totalPersons,
		SUM(go.`num_adult`) numAdult,
		SUM(go.`num_child`) numChild,
		SUM(go.`num_guide`) numGuide,
		SUM(go.total) orderIncome,
		IFNULL(SUM(tg.`total_cost`),0) totalCost,
		IFNULL(SUM(tg.`total_income`),0) totalIncome,
		IFNULL(SUM(bs.total),0)
		AS otherIncome,
		IFNULL(SUM(shop.total_repay),0) AS rayPayIncome,
		IFNULL(SUM(fs.total),0) AS fsIncome
		FROM group_order go
		LEFT JOIN
		tour_group tg ON tg.id = go.`group_id`
		LEFT JOIN (SELECT bs.`group_id`,
		SUM(bs.`total`) total FROM
		booking_supplier bs WHERE bs.sub_type =1
		GROUP BY group_id)bs ON
		bs.group_id =
		go.`group_id`
		LEFT JOIN (SELECT
		shop.`group_id`,SUM(shop.`total_repay`)total_repay FROM
		booking_shop
		shop GROUP BY group_id) shop ON shop.group_id =
		go.`group_id`
		LEFT JOIN
		(SELECT fs.group_id,SUM(fs.total) total FROM finance_commission
		fs
		GROUP BY group_id) fs ON fs.group_id = go.`group_id`
		where go.biz_id =
		#{bizId}
		and go.`group_id` IS NOT NULL
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.startTime!=null and page.parameter.startTime!=''">
			and go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime!=null and page.parameter.endTime!=''">
			and go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.productName!=null and page.parameter.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.productName}','%')
		</if>
		<!-- 团类型 -->
		<if test="page.parameter.orderType == null">and go.order_type in(0,1)</if>
		<if test="page.parameter.orderType == 0">and
			go.order_type <![CDATA[=]]>0
		</if>
		<if test="page.parameter.orderType == 1">and
			go.order_type <![CDATA[=]]>1
		</if>
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
			and go.sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
		GROUP BY go.sale_operator_id ) total
	</select>
	<!-- 销售业绩统计 -->

	<select id="selectSaleOperatorOrderStaticListPage" resultMap="SaleOperatorOrderStaticMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		go.sale_operator_name AS saleOperatorName,
		COUNT(go.id) orderNum,
		SUM(tg.`total_adult`+tg.`total_child`+tg.`total_guide`) totalPersons,
		SUM(go.`num_adult`) numAdult,
		SUM(go.`num_child`) numChild,
		SUM(go.`num_guide`) numGuide,
		SUM(go.total) orderIncome,
		IFNULL(SUM(tg.`total_cost`),0) totalCost,
		IFNULL(SUM(tg.`total_income`),0) totalIncome,
		IFNULL(SUM(bs.total),0)
		AS otherIncome,
		IFNULL(SUM(shop.total_repay),0) AS rayPayIncome,
		IFNULL(SUM(fs.total),0) AS fsIncome
		FROM group_order go
		LEFT JOIN
		tour_group
		tg ON tg.id = go.`group_id`
		LEFT JOIN (SELECT bs.`group_id`,
		SUM(bs.`total`) total FROM
		booking_supplier bs WHERE bs.sub_type =1
		GROUP BY group_id)bs ON
		bs.group_id = go.`group_id`
		LEFT JOIN (SELECT
		shop.`group_id`,SUM(shop.`total_repay`)total_repay FROM
		booking_shop
		shop GROUP BY group_id) shop ON shop.group_id =
		go.`group_id`
		LEFT JOIN
		(SELECT fs.group_id,SUM(fs.total) total FROM finance_commission
		fs
		GROUP BY group_id) fs ON fs.group_id = go.`group_id`
		where go.biz_id =
		#{bizId}
		and go.`group_id` IS NOT
		NULL
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.startTime!=null and page.parameter.startTime!=''">
			and go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime!=null and page.parameter.endTime!=''">
			and go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>
		<if test="page.parameter.productName!=null and page.parameter.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.productName}','%')
		</if>
		<!-- 团类型 -->
		<if test="page.parameter.orderType == null">and go.order_type in(0,1)</if>
		<if test="page.parameter.orderType == 0">and
			go.order_type <![CDATA[=]]>0
		</if>
		<if test="page.parameter.orderType == 1">and
			go.order_type <![CDATA[=]]>1
		</if>
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
			and go.sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
		GROUP BY go.sale_operator_id
	</select>
	<!-- 查询应收款项 详情导出 -->
	<select id="selectPaymentDetailList" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		SELECT go.*, tg.`group_code` as groupCode
		FROM (SELECT go.*, GROUP_CONCAT( CONCAT_WS(',', CONCAT_WS(':', gop.item_name, gop.remark), CONCAT_WS('=',CONCAT_WS('*',CONVERT(gop.unit_price,DECIMAL),
		CONVERT(gop.num_times,DECIMAL),CONVERT(gop.num_person,DECIMAL) ), CONVERT( gop.unit_price*gop.num_times*gop.num_person, DECIMAL))
		)) prices
		FROM group_order go
		LEFT JOIN group_order_price gop ON (go.id = gop.order_id AND gop.mode=0)
		left join tour_group tg on (go.group_id=tg.id)
		where go.biz_id= #{bizId} and
		go.state = 1
		<if test="set!=null">
			and go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.type == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.type == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !='' and page.parameter.provinceId !=-1">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !='' and page.parameter.cityId !=-1">
			and go.city_id =#{page.parameter.cityId}
		</if>
		<!-- 团类型 -->
		<if test="page.parameter.groupMode =='0'">and
			tg.group_mode <![CDATA[<=]]>
			0
		</if>
		<if test="page.parameter.groupMode =='1' ">and
			tg.group_mode <![CDATA[>]]>0
		</if>
		<!-- 时间 -->
		<if test="page.parameter.dateType == 1">
			<if test="page.parameter.startTime != null">and go.departure_date <![CDATA[>=]]> #{page.parameter.startTime} </if>
			<if test="page.parameter.endTime != null">and go.departure_date <![CDATA[<=]]> #{page.parameter.endTime} </if>
		</if>
		<if test="page.parameter.dateType == 0">
			<if test="page.parameter.startTime != null">and go.create_time <![CDATA[>=]]> #{page.parameter.startTime} </if>
			<if test="page.parameter.endTime != null">and go.create_time <![CDATA[<=]]> #{page.parameter.endTime} </if>
		</if>
		<!--<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and go.departure_date <![CDATA[>=]]>
			#{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and go.departure_date <![CDATA[<=]]>
			#{page.parameter.endTime}
		</if>-->
		<!-- 财务状态 -->
		<if test="page.parameter.paymentState == 0">and
			go.total <![CDATA[<>]]>go.total_cash
		</if>
		<if test="page.parameter.paymentState == 1">and go.total = go.total_cash</if>
		<!-- 商家 -->
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and go.supplier_name LIKE CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.supplierId != null and page.parameter.supplierId !=''">
			and go.supplier_id =#{page.parameter.supplierId}
		</if>
		<!-- 行程 -->
		<if test="page.parameter.productName !=null and page.parameter.productName !=''">and
			CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE CONCAT('%',#{page.parameter.productName},'%')
		</if>
		GROUP BY go.id
		) go LEFT JOIN tour_group tg ON tg.id = go.group_id
		WHERE IFNULL(tg.group_state,0) <![CDATA[!=]]>
		2
		<if test="page.parameter.groupCode != null and page.parameter.groupCode !=''">
			and tg.group_code LIKE CONCAT('%',#{page.parameter.groupCode},'%')
		</if>
		order by go.departure_date,go.create_time
	</select>
	<select id="selectProfitByConAndMode" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		SUM(income) AS totalIncome,
		SUM(budget) AS totalBudget,
		group_code,
		product_name,
		product_brand_name,
		operator_id,
		sale_operator_id,
		departure_date
		FROM(
		SELECT gop.income, gop.budget, go.*,
			tg.group_code, tg.group_state,ifnull(c.qdtotal, 0) qdtotal
		FROM
		group_order go LEFT JOIN (
									SELECT SUM(gop2.income) AS income,SUM(gop2.budget) AS budget ,gop2.order_id AS order_id
									FROM(
											SELECT
												(CASE WHEN gop1.mode=0 THEN gop1.total_price ELSE 0 END) income,
												(CASE WHEN gop1.mode=1 THEN gop1.total_price ELSE 0 END) budget,
												gop1.`order_id`
											FROM group_order_price gop1
										) gop2 GROUP BY gop2.order_id
		<if test='page.parameter.budgetFlag !=null and page.parameter.budgetFlag == "0" '>
			<![CDATA[
					        			 HAVING budget = 0
					        		]]>
		</if>
		<if test='page.parameter.budgetFlag !=null and page.parameter.budgetFlag == "1" '>
			<![CDATA[
					        			 HAVING budget <> 0
					        		]]>
		</if>
								) gop ON go.`id`=gop.`order_id`
		LEFT JOIN tour_group tg ON go.group_id = tg.id
		left join (select sup.order_id,sum(sup.total) qdtotal from booking_supplier sup
		where sup.supplier_type=120 GROUP BY sup.order_id) c
		on c.order_id=go.id
		WHERE go.state != -1 and go.biz_id = #{bizId,jdbcType=INTEGER}
		<if test="set!=null">
			AND go.sale_operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
			</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.tourGroup.groupCode!=null and page.parameter.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${page.parameter.tourGroup.groupCode}','%')
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>
		
		<if test="page.parameter.SupplierName!=null and page.parameter.SupplierName!=''">
			and go.supplier_name LIKE CONCAT('%','${page.parameter.SupplierName}','%')
		</if>

		<if test="page.parameter.receiveMode!=null and page.parameter.receiveMode!=''">
			and go.receive_mode LIKE CONCAT('%','${page.parameter.receiveMode}','%')
		</if>

		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in
				(${page.parameter.saleOperatorIds})
			</if>
		</if>
		
		
		<choose>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != ''">
				<![CDATA[  and go.departure_date >=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')  and go.departure_date <=date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				and
				go.departure_date=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<![CDATA[  and go.departure_date =date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
		</choose>
		group by go.id
		) ss

	</select>

	<select id="selectProfitByCon" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT IFNULL(SUM(go.num_adult),0) as numAdult
		,IFNULL(SUM(go.num_child),0) AS numChild,IFNULL(SUM(go.num_guide),0)
		AS numGuide
		FROM
		group_order go
		left JOIN tour_group tg
		ON go.group_id
		=tg.id
		and
		tg.biz_id = ${bizId}
		WHERE go.state != -1
		AND go.biz_id =
		#{bizId,jdbcType=INTEGER}
		<if test="set!=null">
			AND go.sale_operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.tourGroup.groupCode!=null and page.parameter.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${page.parameter.tourGroup.groupCode}','%')
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',tg.product_brand_name,'】',tg.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>

		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		
		<!-- 客户 tengd 20161101 -->
		<if test="page.parameter.supplierName!=null and page.parameter.supplierName!=''">
			and go.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%')
		</if>

		<if test="page.parameter.receiveMode!=null and page.parameter.receiveMode!=''">
			and go.receive_mode LIKE CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		
		
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<choose>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != ''">
				<![CDATA[  and go.departure_date >=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')  and go.departure_date <=date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				and
				go.departure_date=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<![CDATA[  and go.departure_date =date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
		</choose>
	</select>
	
	

	<select id="selectProfitByConListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
			total AS income,
			ifnull(bd.total_price, 0) budget,
			go.id,
			go.group_id,
			go.order_type,
			go.supplier_name,
			go.product_brand_name,
			go.product_name,
			go.receive_mode,
			go.province_id,
			go.province_name,
			go.city_name,
			go.city_id,
			tg.group_code AS groupCode,
			go.operator_id,
			go.sale_operator_id,
			go.state_finance,
			go.departure_date,
			go.operator_name,
			go.sale_operator_name,
			go.num_adult,
			go.num_child,
			go.num_guide,
		    go.b2b_export_state,   <!-- 此当审核状态用 -->
			tg.group_state AS groupState,
		ifnull(c.qdtotal, 0) qdtotal
		FROM group_order go left join tour_group tg ON go.group_id = tg.id
		left join (select sup.order_id,sum(sup.total) qdtotal from booking_supplier sup
		where sup.supplier_type=120 GROUP BY sup.order_id) c on c.order_id=go.id
		left join (select
		order_id,sum(total_price) total_price from group_order_price where mode=1 group by order_id
		<if test='page.parameter.budgetFlag !=null and page.parameter.budgetFlag == "0" '>
			<![CDATA[
        			 HAVING total_price = 0
        		]]>
		</if>
		<if test='page.parameter.budgetFlag !=null and page.parameter.budgetFlag == "1" '>
			<![CDATA[
        			 HAVING total_price <> 0
        		]]>
		</if>
		) bd on (go.id=bd.order_id)
		WHERE
		go.state != -1
		AND
		go.biz_id = ${bizId}
		<if test="set!=null">
			AND go.sale_operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and go.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.tourGroup.groupCode!=null and page.parameter.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${page.parameter.tourGroup.groupCode}','%')
		</if>
		<if test="page.parameter.receiveMode!=null and page.parameter.receiveMode!=''">
			and go.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',go.product_brand_name,'】',go.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>
		<!-- 客户 tengd 20161101s -->
		<if test="page.parameter.supplierName!=null and page.parameter.supplierName!=''">
			and go.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%')
		</if>
		
		<if test="page.parameter.select == 0">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.select == 1">
			<if test="page.parameter.saleOperatorIds !=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in
				(${page.parameter.saleOperatorIds})
			</if>
		</if>
		<choose>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != ''">
				<![CDATA[  and go.departure_date >=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')  and go.departure_date <=date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
			<when test="page.parameter.tourGroup.startTime != null and page.parameter.tourGroup.startTime !='' and (page.parameter.tourGroup.endTime == null or page.parameter.tourGroup.endTime == '' )">
				and
				go.departure_date=date_format(#{page.parameter.tourGroup.startTime},'%Y-%m-%d')
			</when>
			<when test="page.parameter.tourGroup.endTime != null and page.parameter.tourGroup.endTime != '' and  (page.parameter.tourGroup.startTime == null or page.parameter.tourGroup.startTime == '' )">
				<![CDATA[  and go.departure_date =date_format(#{page.parameter.tourGroup.endTime},'%Y-%m-%d')]]>
			</when>
		</choose>
		<if test='page.parameter.budgetFlag !=null and page.parameter.budgetFlag == "0" '>
			<![CDATA[
        			 and ifnull(bd.total_price, 0) = 0
        		]]>
		</if>
		<if test='page.parameter.budgetFlag !=null and page.parameter.budgetFlag == "1" '>
			<![CDATA[
        			 and ifnull(bd.total_price, 0)  <> 0
        		]]>
		</if>
		ORDER BY go.departure_date,go.create_time
	</select>
	
	<!-- XTSM:销售利润统计查询 -->
	<select id="selectAllOrderByConListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT o.* FROM group_order o LEFT JOIN tour_group g ON
		o.group_id=g.id
		<if test='page.parameter.airApplyState=="Y" or page.parameter.issueStatus!=null'>
			RIGHT JOIN air_ticket_request a on a.group_order_id=o.id
			and
			a.is_del='N'
		</if>
		<if test='page.parameter.airApplyState=="N"'>
			LEFT JOIN air_ticket_request a on a.group_order_id=o.id
			and a.is_del='N'
		</if>
		where o.biz_id = #{bizId,jdbcType=INTEGER}
		and o.state=1
		AND
		(g.group_state=1 OR ISNULL(g.group_state) or (g.group_state=0 and
		g.group_mode=0))
		<if test="page.parameter.dataUser!=null">
			and (o.operator_id in (${page.parameter.dataUser}) or
			sale_operator_id in (${page.parameter.dataUser}))
		</if>
		<if test="page.parameter.dateFrom!=null">
			and o.departure_date <![CDATA[>=]]>
			#{page.parameter.dateFrom}
		</if>
		<if test="page.parameter.dateTo!=null">
			and o.departure_date <![CDATA[<=]]>
			#{page.parameter.dateTo}
		</if>
		<if test="page.parameter.orderNo!=null">
			and o.order_no LIKE
			CONCAT('%',#{page.parameter.orderNo},'%')
		</if>
		<if test="page.parameter.productName!=null">
			and (o.product_brand_name LIKE
			CONCAT('%',#{page.parameter.productName},'%') or o.product_name
			LIKE CONCAT('%',#{page.parameter.productName},'%'))
		</if>
		<if test="page.parameter.receiveMode!=null">
			and o.receive_mode LIKE
			CONCAT('%',#{page.parameter.receiveMode},'%')
		</if>
		<if test='page.parameter.airApplyState=="N"'>
			and isnull(a.id)
		</if>
		<if test='page.parameter.issueStatus!=null'>
			and a.status=#{page.parameter.issueStatus}
		</if>
		<if test='page.parameter.saleOperatorIds!=null'>
			and o.sale_operator_id in
			(${page.parameter.saleOperatorIds})
		</if>
		<if test='page.parameter.airApplyState=="Y"'>
			group by o.id
		</if>
		order by o.departure_date, create_time
	</select>
	<select id="selectAllOrderByConTotal" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT SUM(IFNULL(o.num_adult,0)) totalAdult,SUM(IFNULL(o.num_child,0)) totalChild,SUM(IFNULL(o.num_guide,0))
		totalGuide


		FROM group_order o LEFT JOIN tour_group g ON
		o.group_id=g.id
		<if test='page.parameter.airApplyState=="Y" or page.parameter.issueStatus!=null'>
			RIGHT JOIN air_ticket_request a on a.group_order_id=o.id
			and
			a.is_del='N'
		</if>
		<if test='page.parameter.airApplyState=="N"'>
			LEFT JOIN air_ticket_request a on a.group_order_id=o.id
			and a.is_del='N'
		</if>
		where o.biz_id = #{bizId,jdbcType=INTEGER}
		and o.state=1
		AND
		(g.group_state=1 OR ISNULL(g.group_state) or (g.group_state=0 and
		g.group_mode=0))
		<if test="page.parameter.dataUser!=null">
			and (o.operator_id in (${page.parameter.dataUser}) or
			sale_operator_id in (${page.parameter.dataUser}))
		</if>
		<if test="page.parameter.dateFrom!=null">
			and o.departure_date <![CDATA[>=]]>
			#{page.parameter.dateFrom}
		</if>
		<if test="page.parameter.dateTo!=null">
			and o.departure_date <![CDATA[<=]]>
			#{page.parameter.dateTo}
		</if>
		<if test="page.parameter.orderNo!=null">
			and o.order_no LIKE
			CONCAT('%',#{page.parameter.orderNo},'%')
		</if>
		<if test="page.parameter.productName!=null">
			and (o.product_brand_name LIKE
			CONCAT('%',#{page.parameter.productName},'%') or o.product_name
			LIKE CONCAT('%',#{page.parameter.productName},'%'))
		</if>
		<if test="page.parameter.receiveMode!=null">
			and o.receive_mode LIKE
			CONCAT('%',#{page.parameter.receiveMode},'%')
		</if>
		<if test='page.parameter.airApplyState=="N"'>
			and isnull(a.id)
		</if>
		<if test='page.parameter.issueStatus!=null'>
			and a.status=#{page.parameter.issueStatus}
		</if>
		<if test='page.parameter.saleOperatorIds!=null'>
			and o.sale_operator_id in
			(${page.parameter.saleOperatorIds})
		</if>
		<!--<if test='page.parameter.airApplyState=="Y"'>
			group by o.id
		</if>
		order by o.departure_date, o.create_time-->
	</select>

	<select id="selectByConListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		go.*
		from
		group_order go
		inner join
		tour_group tg
		on
		go.group_id =
		tg.id
		where
		tg.group_mode > 0 and
		go.state != -1 and
		go.order_type = 1 and
		go.biz_id = #{bizId,jdbcType=INTEGER}
		<if test="listType==0">
			and go.sale_operator_id in
		</if>
		<if test="listType==1">
			and go.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="page.parameter.dateType == 1">
			<if test="page.parameter.startTime !=null and page.parameter.startTime !=''">
				and tg.date_start <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime !=null and page.parameter.endTime !=''">
				and tg.date_start <![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType == 2">
			<if test="page.parameter.startTime !=null and page.parameter.startTime !=''">
				and tg.create_time <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime !=null and page.parameter.endTime !=''">
				and tg.create_time<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>

		<if test="page.parameter.tourState !=null and page.parameter.tourState !=''">
			and tg.group_state = #{page.parameter.tourState}
		</if>

		<if test="page.parameter.cashState == 0">
			and go.total != total_cash
		</if>
		<if test="page.parameter.cashState ==1">
			and go.total = total_cash
		</if>

		<if test="page.parameter.receiveMode!=null and page.parameter.receiveMode!=''">
			and go.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.supplierName!=null and page.parameter.supplierName!=''">
			and go.supplier_name LIKE
			CONCAT('%','${page.parameter.supplierName}','%')
		</if>


		<if test="page.parameter.orderLockState != null ">
			and go.order_lock_state =#{page.parameter.orderLockState}
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and go.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.tourGroup.groupCode!=null and page.parameter.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${page.parameter.tourGroup.groupCode}','%')
		</if>
		<if test="page.parameter.tourGroup.productName!=null and page.parameter.tourGroup.productName!=''">
			and CONCAT('【',tg.product_brand_name,'】',tg.product_name) LIKE
			CONCAT('%','${page.parameter.tourGroup.productName}','%')
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.sourceTypeId != null and page.parameter.sourceTypeId !=-1">
			and go.source_type_id=#{page.parameter.sourceTypeId}
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			AND go.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%')
		</if>
		<choose>
			<when test="page.parameter.sidx != null and page.parameter.sidx !=''">
				ORDER BY ${page.parameter.sidx} ${page.parameter.sord}
			</when>
			<otherwise>
				ORDER BY tg.date_start
			</otherwise>
		</choose>
	</select>


	<select id="selectTotalByCon" resultMap="BaseResultMap">
		select
		sum(go.num_adult) as numAdult,
		sum(go.num_child) as numChild,
		sum(go.num_guide) as numGuide
		from
		group_order go
		inner join
		tour_group tg
		on
		go.group_id =
		tg.id
		where
		tg.group_mode > 0 and
		go.state != -1 and
		go.order_type = 1 and
		go.biz_id = #{bizId,jdbcType=INTEGER}
		and
		<if test="listType==0">
			go.sale_operator_id in
		</if>
		<if test="listType==1">
			go.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="groupOrder.dateType == 1">
			<if test="groupOrder.startTime !=null and groupOrder.startTime !=''">
				and tg.date_start <![CDATA[>=]]>
				#{groupOrder.startTime}
			</if>
			<if test="groupOrder.endTime !=null and groupOrder.endTime !=''">
				and tg.date_start <![CDATA[<=]]>
				#{groupOrder.endTime}
			</if>
		</if>
		<if test="groupOrder.dateType == 2">
			<if test="groupOrder.startTime !=null and groupOrder.startTime !=''">
				and tg.create_time <![CDATA[>=]]>
				#{groupOrder.startTime}
			</if>
			<if test="groupOrder.endTime !=null and groupOrder.endTime !=''">
				and tg.create_time<![CDATA[<=]]>
				#{groupOrder.endTime}
			</if>
		</if>

		<if test="groupOrder.tourState !=null and groupOrder.tourState !=''">
			and tg.group_state = #{groupOrder.tourState}
		</if>
		<if test="groupOrder.cashState == 0">
			and go.total != total_cash
		</if>
		<if test="groupOrder.cashState ==1">
			and go.total = total_cash
		</if>

		<if test="groupOrder.receiveMode!=null and groupOrder.receiveMode!=''">
			and go.receive_mode LIKE
			CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.orderLockState != null ">
			and go.order_lock_state =#{groupOrder.orderLockState}
		</if>
		<if test="groupOrder.provinceId != null and groupOrder.provinceId !=-1">
			and go.province_id =#{groupOrder.provinceId}
		</if>
		<if test="groupOrder.cityId != null and groupOrder.cityId !=-1">
			and go.city_id =#{groupOrder.cityId}
		</if>
		<if test="groupOrder.tourGroup.groupCode!=null and groupOrder.tourGroup.groupCode!=''">
			and tg.group_code LIKE
			CONCAT('%','${groupOrder.tourGroup.groupCode}','%')
		</if>
		<if test="groupOrder.supplierName!=null and groupOrder.supplierName!=''">
			and go.supplier_name LIKE
			CONCAT('%','${groupOrder.supplierName}','%')
		</if>
		<if test="groupOrder.tourGroup.productName!=null and groupOrder.tourGroup.productName!=''">
			and CONCAT('【',tg.product_brand_name,'】',tg.product_name) LIKE
			CONCAT('%','${groupOrder.tourGroup.productName}','%')
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and go.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and go.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==3">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and go.creator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.sourceTypeId != null and groupOrder.sourceTypeId !=-1">
			and go.source_type_id=#{groupOrder.sourceTypeId}
		</if>
	</select>


	<select id="selectNotGroupListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		t.*
		from group_order t
		where t.biz_id = #{bizId,jdbcType=INTEGER}
		and t.group_id
		is null and t.state!=-1
		<if test="page.parameter.orderType !=null ">
			and t.order_type=#{page.parameter.orderType}
		</if>
		and
		t.operator_id in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and t.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and t.product_name LIKE
			CONCAT('%','${page.parameter.productName}','%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and t.supplier_name LIKE
			CONCAT('%','${page.parameter.supplierName}','%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and t.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.dateType==1">
			<if test="page.parameter.departureDate != null and page.parameter.departureDate !=''">
				<![CDATA[  and t.departure_date >=#{page.parameter.departureDate} ]]>
			</if>
			<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
				<![CDATA[  and t.departure_date <=#{page.parameter.endTime} ]]>
			</if>
		</if>
		<if test="page.parameter.dateType==2">
			<if test="page.parameter.departureDate != null and page.parameter.departureDate !=''">
				<![CDATA[  and t.create_time >=#{page.parameter.departureDate} ]]>
			</if>
			<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
				<![CDATA[  and t.create_time <=#{page.parameter.endTime} ]]>
			</if>
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and t.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and t.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			<![CDATA[]]>
		</if>
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and t.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and t.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and t.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.orderLockState!=null">

			and t.order_lock_state=#{page.parameter.orderLockState}
		</if>
		ORDER BY t.departure_date,t.create_time
	</select>


	<select id="selectTotalNotGroup" resultMap="BaseResultMap">
		select
		sum(t.num_adult) as numAdult,
		sum(t.num_child) as numChild,
		sum(t.total) as total
		from group_order t
		where t.biz_id =
		#{bizId,jdbcType=INTEGER}
		and t.group_id
		is null and t.state!=-1 and
		t.order_type=#{groupOrder.orderType}
		and t.operator_id in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="groupOrder.productBrandId != null and groupOrder.productBrandId != -1">
			and t.product_brand_id =#{groupOrder.productBrandId}
		</if>
		<if test="groupOrder.productName != null and groupOrder.productName !=''">
			and t.product_name LIKE
			CONCAT('%','${groupOrder.productName}','%')
		</if>
		<if test="groupOrder.supplierName != null and groupOrder.supplierName !=''">
			and t.supplier_name LIKE
			CONCAT('%','${groupOrder.supplierName}','%')
		</if>
		<if test="groupOrder.receiveMode != null and groupOrder.receiveMode !=''">
			and t.receive_mode LIKE
			CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.dateType==1">
			<if test="groupOrder.departureDate != null and groupOrder.departureDate !=''">
				<![CDATA[  and t.departure_date >=#{groupOrder.departureDate} ]]>
			</if>
			<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
				<![CDATA[  and t.departure_date <=#{groupOrder.endTime} ]]>
			</if>
		</if>
		<if test="groupOrder.dateType==2">
			<if test="groupOrder.departureDate != null and groupOrder.departureDate !=''">
				<![CDATA[  and t.create_time >=#{groupOrder.departureDate} ]]>
			</if>
			<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
				<![CDATA[  and t.create_time <=#{groupOrder.endTime} ]]>
			</if>
		</if>
		<if test="groupOrder.provinceId != null and groupOrder.provinceId !=-1">
			and t.province_id =#{groupOrder.provinceId}
		</if>
		<if test="groupOrder.cityId != null and groupOrder.cityId !=-1">
			and t.city_id =#{groupOrder.cityId}
		</if>
		<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
			<![CDATA[]]>
		</if>
		<if test="groupOrder.idList!=null and groupOrder.idList.size() > 0">
			and t.id not in
			<foreach collection="groupOrder.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and t.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>

		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and t.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>


		order by t.create_time desc
	</select>

	<select id="selectProductOrderListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select a.* from group_order a where a.state!=-1 and a.biz_id=#{bizId}
		and a.order_type=0
		and a.operator_id in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="page.parameter.productId != null and page.parameter.productId != ''">
			and a.product_id =#{page.parameter.productId}
		</if>
		<if test="page.parameter.departureDate != null and page.parameter.departureDate != ''">
			and a.departure_date =#{page.parameter.departureDate}
		</if>
		ORDER BY a.departure_date,a.create_time
	</select>
	<select id="selectFitOrderListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select a.*,ifnull(b.group_state,0) group_mode  from group_order a left join tour_group b on a.group_id= b.id 
		where a.state!=-1 and a.biz_id=#{bizId} and a.order_type=0
		and
		<if test="listType==0">
			a.sale_operator_id in
		</if>
		<if test="listType==1">
			a.operator_id in
		</if>

		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<choose>
			<when test="page.parameter.startTime != null and page.parameter.startTime !='' and page.parameter.endTime != null and page.parameter.endTime != ''">
				<if test="page.parameter.dateType==1">
					<![CDATA[  and a.departure_date >=#{page.parameter.startTime}  and a.departure_date <=#{page.parameter.endTime}]]>
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[  and a.create_time >=#{page.parameter.startTime}  and a.create_time <=#{page.parameter.endTime}]]>
				</if>
			</when>
			<when test="page.parameter.startTime != null and page.parameter.startTime !='' and (page.parameter.endTime == null or page.parameter.endTime == '' )">
				<if test="page.parameter.dateType==1">
					and a.departure_date=#{page.parameter.startTime}
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[	and a.create_time>=#{page.parameter.startTime}]]>
				</if>
			</when>
			<when test="page.parameter.endTime != null and page.parameter.endTime != '' and  (page.parameter.startTime == null or page.parameter.startTime == '' )">
				<if test="page.parameter.dateType==1">
					<![CDATA[  and a.departure_date =#{page.parameter.endTime}]]>
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[  and a.create_time <=#{page.parameter.endTime}]]>
				</if>
			</when>
		</choose>
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and a.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<!-- <if test="page.parameter.productId != null and page.parameter.productId 
			!= ''"> and a.product_id =#{page.parameter.productId} </if> <if test="page.parameter.departureDate 
			!= null and page.parameter.departureDate != ''"> and a.departure_date =#{page.parameter.departureDate} 
			</if> -->
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and (a.product_brand_name LIKE CONCAT('%','${page.parameter.productName}','%') or a.product_name LIKE CONCAT('%','${page.parameter.productName}','%'))
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and a.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and a.receive_mode LIKE CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.sourceTypeId != null and page.parameter.sourceTypeId !=-1">
			and a.source_type_id=#{page.parameter.sourceTypeId}
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and a.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and a.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.state ==1">
			and a.group_id is not null
		</if>
		<if test="page.parameter.groupCode!=null and page.parameter.groupCode!=''">
			and b.group_code like CONCAT('%','${page.parameter.groupCode}','%')
		</if>
		<if test="page.parameter.state ==2">
			and a.group_id is null
		</if>
		<if test="page.parameter.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="page.parameter.orderLockState ==1">
			and a.order_lock_state=1
		</if>
		<if test="page.parameter.cashState == 0">
			and a.total != a.total_cash
		</if>
		<if test="page.parameter.cashState ==1">
			and a.total = a.total_cash
		</if>
		<if test="page.parameter.type !=null and page.parameter.type !=-1">
			and a.type=#{page.parameter.type}
		</if>
		<if test="page.parameter.cashState ==1">
			and a.total = a.total_cash
		</if>

		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>

		ORDER BY a.departure_date,a.create_time
	</select>

	<select id="selectSubOrderList" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select a.* from group_order a where a.state!=-1
		and
		a.group_id = #{groupId,jdbcType=INTEGER}
		ORDER BY a.departure_date,a.create_time
	</select>

	<select id="selectFitOrderTotalCount" resultMap="BaseResultMap">
		select IFNULL(sum(a.num_adult),0) as numAdult ,
		IFNULL(sum(a.num_child),0) as numChild, IFNULL(sum(a.num_guide),0) as
		numGuide, IFNULL(sum(a.total),0) as total from group_order a left join
		tour_group b on a.group_id= b.id where a.state!=-1 and
		a.biz_id=${bizId} and a.order_type=0
		and
		<if test="listType==0">
			a.sale_operator_id in
		</if>
		<if test="listType==1">
			a.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<choose>
			<when test="groupOrder.startTime != null and groupOrder.startTime !='' and groupOrder.endTime != null and groupOrder.endTime != ''">
				<if test="groupOrder.dateType==1">
					<![CDATA[  and a.departure_date >=#{groupOrder.startTime}  and a.departure_date <=#{groupOrder.endTime}]]>
				</if>
				<if test="groupOrder.dateType==2">
					<![CDATA[  and a.create_time >=#{groupOrder.startTime}  and a.create_time <=#{groupOrder.endTime}]]>
				</if>
			</when>
			<when test="groupOrder.startTime != null and groupOrder.startTime !='' and (groupOrder.endTime == null or groupOrder.endTime == '' )">
				<if test="groupOrder.dateType==1">
					and a.departure_date=#{groupOrder.startTime}
				</if>
				<if test="groupOrder.dateType==2">
					<![CDATA[	and a.create_time>=#{groupOrder.startTime}]]>
				</if>
			</when>
			<when test="groupOrder.endTime != null and groupOrder.endTime != '' and  (groupOrder.startTime == null or groupOrder.startTime == '' )">
				<if test="groupOrder.dateType==1">
					<![CDATA[  and a.departure_date =#{groupOrder.endTime}]]>
				</if>
				<if test="groupOrder.dateType==2">
					<![CDATA[  and a.create_time <=#{groupOrder.endTime}]]>
				</if>
			</when>
		</choose>
		<if test="groupOrder.idList!=null and groupOrder.idList.size() > 0">
			and a.id not in
			<foreach collection="groupOrder.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="groupOrder.productBrandId != null and groupOrder.productBrandId != -1">
			and a.product_brand_id =#{groupOrder.productBrandId}
		</if>
		<!-- <if test="groupOrder.productId != null and groupOrder.productId != ''"> and a.product_id =#{groupOrder.productId} </if> <if test="groupOrder.departureDate != null and groupOrder.departureDate != ''"> and a.departure_date =#{groupOrder.departureDate} </if> -->
		<if test="groupOrder.productName != null and groupOrder.productName !=''">
			and (a.product_brand_name LIKE
			CONCAT('%','${groupOrder.productName}','%')
			or a.product_name LIKE
			CONCAT('%','${groupOrder.productName}','%'))
		</if>
		<if test="groupOrder.supplierName != null and groupOrder.supplierName !=''">
			and a.supplier_name LIKE
			CONCAT('%','${groupOrder.supplierName}','%')
		</if>
		<if test="groupOrder.receiveMode != null and groupOrder.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.sourceTypeId != null and groupOrder.sourceTypeId !=-1">
			and a.source_type_id=#{groupOrder.sourceTypeId}
		</if>
		<if test="groupOrder.provinceId != null and groupOrder.provinceId !=-1">
			and a.province_id =#{groupOrder.provinceId}
		</if>
		<if test="groupOrder.cityId != null and groupOrder.cityId !=-1">
			and a.city_id =#{groupOrder.cityId}
		</if>
		<if test="groupOrder.state ==1">
			and a.group_id is not null
		</if>
		<if test="groupOrder.groupCode!=null and groupOrder.groupCode!=''">
			and b.group_code like
			CONCAT('%','${groupOrder.groupCode}','%')
		</if>
		<if test="groupOrder.state ==2">
			and a.group_id is null
		</if>
		<if test="groupOrder.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="groupOrder.orderLockState ==1">
			and a.order_lock_state=1
		</if>
		<if test="groupOrder.cashState == 0">
			and a.total != a.total_cash
		</if>
		<if test="groupOrder.cashState ==1">
			and a.total = a.total_cash
		</if>
		<if test="groupOrder.type !=null and groupOrder.type !=-1">
			and a.type=#{groupOrder.type}
		</if>
		<if test="groupOrder.cashState ==1">
			and a.total = a.total_cash
		</if>

		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>

		ORDER BY a.departure_date,a.create_time
	</select>

	<select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from group_order
		where id = #{id,jdbcType=INTEGER}
	</select>

	<select id="selectOrderByPrimaryKey" resultMap="BaseResultMap">
		select * from
		group_order
		where biz_id=#{bizId,jdbcType=INTEGER} and
		id=#{id,jdbcType=INTEGER}
	</select>

	<select id='selectOrderByIdList' resultMap="BaseResultMap">
		select * from
		group_order where biz_id=#{bizId,jdbcType=INTEGER} and id in
		(${idList})
	</select>


	<select id="selectOrderByGroupId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from group_order t
		where t.group_id = #{groupId,jdbcType=INTEGER} and t.state != -1
		order
		by t.create_time desc
	</select>
	<select id="selectOrderByGroupIdAndBizIdAndSupplierId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from group_order t
		where t.group_id = #{groupId,jdbcType=INTEGER}
		and
		t.biz_id = #{bizId}
		and t.supplier_id = #{supplierId}
		order by
		t.create_time desc
	</select>
	<!-- app 计调 -->
	<select id="selectOrderByGroupIdAndBizId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from group_order t
		where t.group_id = #{groupId,jdbcType=INTEGER}
		and
		t.biz_id = #{bizId}
		order
		by t.create_time desc
	</select>

	<select id="selectOrderByGroupIdAndName" resultType="map">
		select
		sum(IFNULL(num_adult,0)) numAdult,sum(IFNULL(num_child,0))
		numChild,sum(IFNULL(num_guide,0)) numGuide
		from group_order t
		where
		t.group_id = #{groupId,jdbcType=INTEGER} and biz_id=#{bizId}
		group by
		group_id

	</select>
	
	<select id="selectByOrderIdExtVisaList" resultMap="BaseResultMap" parameterType="string">
		SELECT go.id,gg.`name` as guestName,gg.mobile,go.ext_visa_info
		from group_order go JOIN group_order_guest gg ON go.id=gg.order_id
		where 1=1 
		<if test="mobile != null and mobile != ''">
			and gg.mobile LIKE CONCAT('%',#{mobile},'%')
		</if>
	</select>
	<select id="selectGroupOrderCodeSort" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from group_order
		where biz_id = #{bizId,jdbcType=INTEGER}
		and
		departure_date=#{startTime,jdbcType=VARCHAR}
		order by order_no_sort
		desc limit 1
	</select>
	<delete id="deleteByOrderId" parameterType="java.lang.Integer">
		delete from
		group_order
		where group_id = #{id,jdbcType=INTEGER}
	</delete>

	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from
		group_order
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<delete id="delGroupOrder" parameterType="java.lang.Integer">
		update group_order set
		state = -1
		where id = #{id,jdbcType=INTEGER}
	</delete>

	<insert id="insert" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder" useGeneratedKeys="true" keyProperty="id">
		insert into group_order
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="bizId != null">
				biz_id,
			</if>
			<if test="groupId != null">
				group_id,
			</if>
			<if test="supplierId != null">
				supplier_id,
			</if>
			<if test="supplierName != null">
				supplier_name ,
			</if>
			<if test="orderNo != null">
				order_no,
			</if>
			<if test="orderNoSort != null">
				order_no_sort,
			</if>
			<if test="orderType != null">
				order_type,
			</if>
			<if test="type != null">
				type,
			</if>
			<if test="contractNo != null">
				contract_no,
			</if>
			<if test="guestSourceId != null">
				guest_source_id,
			</if>
			<if test="guestSourceName != null">
				guest_source_name,
			</if>
			<if test="supplierCode != null">
				supplier_code,
			</if>
			<if test="contactName != null">
				contact_name,
			</if>
			<if test="contactTel != null">
				contact_tel,
			</if>
			<if test="contactMobile != null">
				contact_mobile,
			</if>
			<if test="contactFax != null">
				contact_fax,
			</if>
			<if test="operatorId != null">
				operator_id,
			</if>
			<if test="operatorName != null">
				operator_name,
			</if>
			<if test="saleOperatorId != null">
				sale_operator_id,
			</if>
			<if test="saleOperatorName != null">
				sale_operator_name,
			</if>
			<if test="priceId != null">
				price_id,
			</if>
			<if test="numAdult != null">
				num_adult,
			</if>
			<if test="numChild != null">
				num_child,
			</if>
			<if test="numGuide != null">
				num_guide,
			</if>
			<if test="departureDate != null">
				departure_date,
			</if>
			<if test="dateEnd != null">
				date_end,
			</if>
			<if test="productId != null">
				product_id,
			</if>
			<if test="productBrandId != null">
				product_brand_id,
			</if>
			<if test="productBrandName != null">
				product_brand_name,
			</if>
			<if test="productName != null">
				product_name,
			</if>
			<if test="productShortName != null">
				product_short_name,
			</if>
			<if test="receiveMode != null">
				receive_mode,
			</if>
			<if test="serviceStandard != null">
				service_standard,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="remarkInternal != null">
				remark_internal,
			</if>
			<if test="creatorId != null">
				creator_id,
			</if>
			<if test="creatorName != null">
				creator_name,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="state != null">
				state,
			</if>

			<if test="total != null">
				total,
			</if>
			<if test="stateFinance != null">
				state_finance,
			</if>

			<if test="sourceTypeId != null">
				source_type_id,
			</if>
			<if test="sourceTypeName != null">
				source_type_name,
			</if>
			<if test="provinceId != null">
				province_id,
			</if>
			<if test="provinceName != null">
				province_name,
			</if>
			<if test="cityId != null">
				city_id,
			</if>
			<if test="cityName != null">
				city_name,
			</if>
			
				<if test="departProvinceId != null">
				depart_province_id,
			</if>
			<if test="departProvinceName != null">
				depart_province_name,
			</if>
			<if test="departCityId != null">
				depart_city_id,
			</if>
			<if test="departCityName != null">
				depart_city_name,
			</if>
			
			<if test="aiyouGroupId != null">
				aiyou_group_id,
			</if>
			<if test="orderBusiness != null">
				order_business,
			</if>
			<if test="extResId != null">
				ext_res_id,
			</if>
			<if test="extResState != null">
				ext_res_state,
			</if>
			<if test="extResCleanTime != null">
				ext_res_clean_time,
			</if>
			<if test="extResCleanStock != null">
				ext_res_clean_stock,
			</if>
			<if test="extResPrepay != null">
				ext_res_prepay,
			</if>
			<if test="numChildBaby != null">
				num_child_baby,
			</if>
			<if test="orderMode != null">
				order_mode,
			</if>
			<if test="pushOrderId != null">
				push_order_id,
			</if>
			<if test="pushTimeUpdate != null">
				push_time_update,
			</if>
			<if test="pushSupplierName != null and pushSupplierName != ''">
				push_supplier_name,
			</if>
			<if test="buyerNick != null and buyerNick != ''">
				buyer_nick
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="bizId != null">
				#{bizId,jdbcType=INTEGER},
			</if>
			<if test="groupId != null">
				#{groupId,jdbcType=INTEGER},
			</if>
			<if test="supplierId != null">
				#{supplierId,jdbcType=INTEGER},
			</if>
			<if test="supplierName != null">
				#{supplierName,jdbcType=VARCHAR},
			</if>
			<if test="orderNo != null">
				#{orderNo,jdbcType=VARCHAR},
			</if>
			<if test="orderNoSort != null">
				#{orderNoSort,jdbcType=INTEGER},
			</if>
			<if test="orderType != null">
				#{orderType,jdbcType=INTEGER},
			</if>
			<if test="type != null">
				#{type,jdbcType=INTEGER},
			</if>
			<if test="contractNo != null">
				#{contractNo,jdbcType=VARCHAR},
			</if>
			<if test="guestSourceId != null">
				#{guestSourceId,jdbcType=INTEGER},
			</if>
			<if test="guestSourceName != null">
				#{guestSourceName,jdbcType=VARCHAR},
			</if>
			<if test="supplierCode != null">
				#{supplierCode,jdbcType=VARCHAR},
			</if>
			<if test="contactName != null">
				#{contactName,jdbcType=VARCHAR},
			</if>
			<if test="contactTel != null">
				#{contactTel,jdbcType=VARCHAR},
			</if>
			<if test="contactMobile != null">
				#{contactMobile,jdbcType=VARCHAR},
			</if>
			<if test="contactFax != null">
				#{contactFax,jdbcType=VARCHAR},
			</if>
			<if test="operatorId != null">
				#{operatorId,jdbcType=INTEGER},
			</if>
			<if test="operatorName != null">
				#{operatorName,jdbcType=VARCHAR},
			</if>
			<if test="saleOperatorId != null">
				#{saleOperatorId,jdbcType=INTEGER},
			</if>
			<if test="saleOperatorName != null">
				#{saleOperatorName,jdbcType=VARCHAR},
			</if>
			<if test="priceId != null">
				#{priceId,jdbcType=INTEGER},
			</if>
			<if test="numAdult != null">
				#{numAdult,jdbcType=INTEGER},
			</if>
			<if test="numChild != null">
				#{numChild,jdbcType=INTEGER},
			</if>
			<if test="numGuide != null">
				#{numGuide,jdbcType=INTEGER},
			</if>
			<if test="departureDate != null">
				#{departureDate,jdbcType=DATE},
			</if>
			<if test="dateEnd != null">
				#{dateEnd,jdbcType=DATE},
			</if>
			<if test="productId != null">
				#{productId,jdbcType=INTEGER},
			</if>
			<if test="productBrandId != null">
				#{productBrandId,jdbcType=INTEGER},
			</if>
			<if test="productBrandName != null">
				#{productBrandName,jdbcType=VARCHAR},
			</if>
			<if test="productName != null">
				#{productName,jdbcType=VARCHAR},
			</if>
			<if test="productShortName != null">
				#{productShortName,jdbcType=VARCHAR},
			</if>
			<if test="receiveMode != null">
				#{receiveMode,jdbcType=VARCHAR},
			</if>
			<if test="serviceStandard != null">
				#{serviceStandard,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="remarkInternal != null">
				#{remarkInternal,jdbcType=VARCHAR},
			</if>
			<if test="creatorId != null">
				#{creatorId,jdbcType=INTEGER},
			</if>
			<if test="creatorName != null">
				#{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=BIGINT},
			</if>
			<if test="state != null">
				#{state,jdbcType=INTEGER},
			</if>
			<if test="total != null">
				#{total,jdbcType=DECIMAL},
			</if>
			<if test="stateFinance != null">
				#{stateFinance,jdbcType=INTEGER},
			</if>
			<if test="sourceTypeId != null">
				#{sourceTypeId,jdbcType=INTEGER},
			</if>
			<if test="sourceTypeName != null">
				#{sourceTypeName,jdbcType=VARCHAR},
			</if>
			<if test="provinceId != null">
				#{provinceId,jdbcType=INTEGER},
			</if>
			<if test="provinceName != null">
				#{provinceName,jdbcType=VARCHAR},
			</if>
			<if test="cityId != null">
				#{cityId,jdbcType=INTEGER},
			</if>
			<if test="cityName != null">
				#{cityName,jdbcType=VARCHAR},
			</if>
			<if test="departProvinceId != null">
				#{departProvinceId,jdbcType=INTEGER},
			</if>
			<if test="departProvinceName != null">
				#{departProvinceName,jdbcType=VARCHAR},
			</if>
			<if test="departCityId != null">
				#{departCityId,jdbcType=INTEGER},
			</if>
			<if test="departCityName != null">
				#{departCityName,jdbcType=VARCHAR},
			</if>
			<if test="aiyouGroupId != null">
				#{aiyouGroupId,jdbcType=VARCHAR},
			</if>
			<if test="orderBusiness != null">
				#{orderBusiness,jdbcType=VARCHAR},
			</if>
			<if test="extResId != null">
				#{extResId,jdbcType=INTEGER},
			</if>
			<if test="extResState != null">
				#{extResState,jdbcType=INTEGER},
			</if>
			<if test="extResCleanTime != null">
				#{extResCleanTime,jdbcType=VARCHAR},
			</if>
			<if test="extResCleanStock != null">
				#{extResCleanStock,jdbcType=INTEGER},
			</if>
			<if test="extResPrepay != null">
				#{extResPrepay,jdbcType=DECIMAL},
			</if>
			<if test="numChildBaby != null">
				#{numChildBaby,jdbcType=INTEGER},
			</if>
				<if test="orderMode != null">
				#{orderMode,jdbcType=INTEGER},
			</if>
			<if test="pushOrderId != null">
				#{pushOrderId, jdbcType=INTEGER},
			</if>
			<if test="pushTimeUpdate != null">
				#{pushTimeUpdate, jdbcType=DATE},
			</if>
			<if test="pushSupplierName != null and pushSupplierName != ''">
				#{pushSupplierName, jdbcType=VARCHAR},
			</if>
				<if test="buyerNick != null and buyerNick != ''">
				#{buyerNick, jdbcType=VARCHAR}
			</if>
		</trim>
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">SELECT
			LAST_INSERT_ID()
		</selectKey>
	</insert>
	<insert id="insertSelective" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder" useGeneratedKeys="true" keyProperty="id">
		insert into group_order
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="bizId != null">
				biz_id,
			</if>
			<if test="groupId != null">
				group_id,
			</if>
			<if test="supplierId != null">
				supplier_id,
			</if>
			<if test="supplierName != null">
				supplier_name ,
			</if>
			<if test="orderNo != null">
				order_no,
			</if>
			<if test="orderNoSort != null">
				order_no_sort,
			</if>
			<if test="orderType != null">
				order_type,
			</if>
			<if test="type != null">
				type,
			</if>
			<if test="contractNo != null">
				contract_no,
			</if>
			<if test="guestSourceId != null">
				guest_source_id,
			</if>
			<if test="guestSourceName != null">
				guest_source_name,
			</if>
			<if test="supplierCode != null">
				supplier_code,
			</if>
			<if test="contactName != null">
				contact_name,
			</if>
			<if test="contactTel != null">
				contact_tel,
			</if>
			<if test="contactMobile != null">
				contact_mobile,
			</if>
			<if test="contactFax != null">
				contact_fax,
			</if>
			<if test="operatorId != null">
				operator_id,
			</if>
			<if test="operatorName != null">
				operator_name,
			</if>
			<if test="saleOperatorId != null">
				sale_operator_id,
			</if>
			<if test="saleOperatorName != null">
				sale_operator_name,
			</if>
			<if test="priceId != null">
				price_id,
			</if>
			<if test="numAdult != null">
				num_adult,
			</if>
			<if test="numChild != null">
				num_child,
			</if>
			<if test="numGuide != null">
				num_guide,
			</if>
			<if test="departureDate != null">
				departure_date,
			</if>
			<if test="productId != null">
				product_id,
			</if>
			<if test="productBrandId != null">
				product_brand_id,
			</if>
			<if test="productBrandName != null">
				product_brand_name,
			</if>
			<if test="productName != null">
				product_name,
			</if>
			<if test="productShortName != null">
				product_short_name,
			</if>
			<if test="receiveMode != null">
				receive_mode,
			</if>
			<if test="serviceStandard != null">
				service_standard,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="remarkInternal != null">
				remark_internal,
			</if>
			<if test="creatorId != null">
				creator_id,
			</if>
			<if test="creatorName != null">
				creator_name,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="state != null">
				state,
			</if>

			<if test="total != null">
				total,
			</if>
			<if test="stateFinance != null">
				state_finance,
			</if>

			<if test="sourceTypeId != null">
				source_type_id,
			</if>
			<if test="sourceTypeName != null">
				source_type_name,
			</if>
			<if test="provinceId != null">
				province_id,
			</if>
			<if test="provinceName != null">
				province_name,
			</if>
			<if test="cityId != null">
				city_id,
			</if>
			<if test="cityName != null">
				city_name,
			</if>
			<if test="departProvinceId != null">
				depart_province_id,
			</if>
			<if test="departProvinceName != null">
				depart_province_name,
			</if>
			<if test="departCityId != null">
				depart_city_id,
			</if>
			<if test="departCityName != null">
				depart_city_name,
			</if>
			<if test="aiyouGroupId != null">
				aiyou_group_id,
			</if>
			<if test="orderBusiness != null">
				order_business,
			</if>
			<if test="pushOrderId != null">
				push_order_id,
			</if>
			<if test="pushTimeUpdate != null">
				push_time_update,
			</if>
			<if test="pushSupplierName != null and pushSupplierName != ''">
				push_supplier_name,
			</if>
			<if test="buyerNick != null and buyerNick != ''">
				buyer_nick
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="bizId != null">
				#{bizId,jdbcType=INTEGER},
			</if>
			<if test="groupId != null">
				#{groupId,jdbcType=INTEGER},
			</if>
			<if test="supplierId != null">
				#{supplierId,jdbcType=INTEGER},
			</if>
			<if test="supplierName != null">
				#{supplierName,jdbcType=VARCHAR},
			</if>
			<if test="orderNo != null">
				#{orderNo,jdbcType=VARCHAR},
			</if>
			<if test="orderNoSort != null">
				#{orderNoSort,jdbcType=INTEGER},
			</if>
			<if test="orderType != null">
				#{orderType,jdbcType=INTEGER},
			</if>
			<if test="type != null">
				#{type,jdbcType=INTEGER},
			</if>
			<if test="contractNo != null">
				#{contractNo,jdbcType=VARCHAR},
			</if>
			<if test="guestSourceId != null">
				#{guestSourceId,jdbcType=INTEGER},
			</if>
			<if test="guestSourceName != null">
				#{guestSourceName,jdbcType=VARCHAR},
			</if>
			<if test="supplierCode != null">
				#{supplierCode,jdbcType=VARCHAR},
			</if>
			<if test="contactName != null">
				#{contactName,jdbcType=VARCHAR},
			</if>
			<if test="contactTel != null">
				#{contactTel,jdbcType=VARCHAR},
			</if>
			<if test="contactMobile != null">
				#{contactMobile,jdbcType=VARCHAR},
			</if>
			<if test="contactFax != null">
				#{contactFax,jdbcType=VARCHAR},
			</if>
			<if test="operatorId != null">
				#{operatorId,jdbcType=INTEGER},
			</if>
			<if test="operatorName != null">
				#{operatorName,jdbcType=VARCHAR},
			</if>
			<if test="saleOperatorId != null">
				#{saleOperatorId,jdbcType=INTEGER},
			</if>
			<if test="saleOperatorName != null">
				#{saleOperatorName,jdbcType=VARCHAR},
			</if>
			<if test="priceId != null">
				#{priceId,jdbcType=INTEGER},
			</if>
			<if test="numAdult != null">
				#{numAdult,jdbcType=INTEGER},
			</if>
			<if test="numChild != null">
				#{numChild,jdbcType=INTEGER},
			</if>
			<if test="numGuide != null">
				#{numGuide,jdbcType=INTEGER},
			</if>
			<if test="departureDate != null">
				#{departureDate,jdbcType=DATE},
			</if>
			<if test="productId != null">
				#{productId,jdbcType=INTEGER},
			</if>
			<if test="productBrandId != null">
				#{productBrandId,jdbcType=INTEGER},
			</if>
			<if test="productBrandName != null">
				#{productBrandName,jdbcType=VARCHAR},
			</if>
			<if test="productName != null">
				#{productName,jdbcType=VARCHAR},
			</if>
			<if test="productShortName != null">
				#{productShortName,jdbcType=VARCHAR},
			</if>
			<if test="receiveMode != null">
				#{receiveMode,jdbcType=VARCHAR},
			</if>
			<if test="serviceStandard != null">
				#{serviceStandard,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="remarkInternal != null">
				#{remarkInternal,jdbcType=VARCHAR},
			</if>
			<if test="creatorId != null">
				#{creatorId,jdbcType=INTEGER},
			</if>
			<if test="creatorName != null">
				#{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=BIGINT},
			</if>
			<if test="state != null">
				#{state,jdbcType=INTEGER},
			</if>
			<if test="total != null">
				#{total,jdbcType=DECIMAL},
			</if>
			<if test="stateFinance != null">
				#{stateFinance,jdbcType=INTEGER},
			</if>
			<if test="sourceTypeId != null">
				#{sourceTypeId,jdbcType=INTEGER},
			</if>
			<if test="sourceTypeName != null">
				#{sourceTypeName,jdbcType=VARCHAR},
			</if>
			<if test="provinceId != null">
				#{provinceId,jdbcType=INTEGER},
			</if>
			<if test="provinceName != null">
				#{provinceName,jdbcType=VARCHAR},
			</if>
			<if test="cityId != null">
				#{cityId,jdbcType=INTEGER},
			</if>
			<if test="cityName != null">
				#{cityName,jdbcType=VARCHAR},
			</if>
			<if test="departProvinceId != null">
				#{departProvinceId,jdbcType=INTEGER},
			</if>
			<if test="departProvinceName != null">
				#{departProvinceName,jdbcType=VARCHAR},
			</if>
			<if test="departCityId != null">
				#{departCityId,jdbcType=INTEGER},
			</if>
			<if test="departCityName != null">
				#{departCityName,jdbcType=VARCHAR},
			</if>
			<if test="aiyouGroupId != null">
				#{aiyouGroupId,jdbcType=VARCHAR},
			</if>
			<if test="orderBusiness != null">
				#{orderBusiness,jdbcType=VARCHAR},
			</if>
			<if test="pushOrderId != null">
				#{pushOrderId,jdbcType=INTEGER},
			</if>
			<if test="pushTimeUpdate != null">
				#{pushTimeUpdate,jdbcType=DATE},
			</if>
			<if test="pushSupplierName != null and pushSupplierName != ''">
				#{pushSupplierName,jdbcType=VARCHAR},
			</if>
				<if test="buyerNick != null and buyerNick != ''">
				#{buyerNick,jdbcType=VARCHAR}
			</if>
		</trim>
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">SELECT
			LAST_INSERT_ID()
		</selectKey>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		update group_order
		<set>
			<if test="bizId != null">
				biz_id = #{bizId,jdbcType=INTEGER},
			</if>
			<if test="groupId != null">
				group_id = #{groupId,jdbcType=INTEGER},
			</if>
			<if test="supplierId != null">
				supplier_id = #{supplierId,jdbcType=INTEGER},
			</if>
			<if test="supplierName != null">
				supplier_name = #{supplierName,jdbcType=VARCHAR},
			</if>
			<if test="orderNo != null">
				order_no = #{orderNo,jdbcType=VARCHAR},
			</if>
			<if test="orderNoSort != null">
				order_no_sort = #{orderNoSort,jdbcType=INTEGER},
			</if>
			<if test="orderType != null">
				order_type = #{orderType,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				type = #{type,jdbcType=INTEGER},
			</if>
			<if test="contractNo != null">
				contract_no = #{contractNo,jdbcType=VARCHAR},
			</if>
			<if test="guestSourceId != null">
				guest_source_id = #{guestSourceId,jdbcType=INTEGER},
			</if>
			<if test="guestSourceName != null">
				guest_source_name = #{guestSourceName,jdbcType=VARCHAR},
			</if>
			<if test="supplierCode != null">
				supplier_code = #{supplierCode,jdbcType=VARCHAR},
			</if>
			<if test="contactName != null">
				contact_name = #{contactName,jdbcType=VARCHAR},
			</if>
			<if test="contactTel != null">
				contact_tel = #{contactTel,jdbcType=VARCHAR},
			</if>
			<if test="contactMobile != null">
				contact_mobile = #{contactMobile,jdbcType=VARCHAR},
			</if>
			<if test="contactFax != null">
				contact_fax = #{contactFax,jdbcType=VARCHAR},
			</if>
			<if test="operatorId != null">
				operator_id = #{operatorId,jdbcType=INTEGER},
			</if>
			<if test="operatorName != null">
				operator_name = #{operatorName,jdbcType=VARCHAR},
			</if>
			<if test="saleOperatorId != null">
				sale_operator_id = #{saleOperatorId,jdbcType=INTEGER},
			</if>
			<if test="saleOperatorName != null">
				sale_operator_name =
				#{saleOperatorName,jdbcType=VARCHAR},
			</if>
			<if test="priceId != null">
				price_id = #{priceId,jdbcType=INTEGER},
			</if>
			<if test="numAdult != null">
				num_adult = #{numAdult,jdbcType=INTEGER},
			</if>
			<if test="numChild != null">
				num_child = #{numChild,jdbcType=INTEGER},
			</if>
			<if test="numGuide != null">
				num_guide = #{numGuide,jdbcType=INTEGER},
			</if>
			<if test="departureDate != null">
				departure_date = #{departureDate,jdbcType=DATE},
			</if>
			<if test="dateEnd != null and dateEnd !=''">
				date_end = #{dateEnd,jdbcType=DATE},
			</if>
			<if test="productId != null">
				product_id = #{productId,jdbcType=INTEGER},
			</if>
			<if test="productBrandId != null">
				product_brand_id = #{productBrandId,jdbcType=INTEGER},
			</if>
			<if test="productBrandName != null">
				product_brand_name =
				#{productBrandName,jdbcType=VARCHAR},
			</if>
			<if test="productName != null">
				product_name = #{productName,jdbcType=VARCHAR},
			</if>
			<if test="productShortName != null">
				product_short_name =
				#{productShortName,jdbcType=VARCHAR},
			</if>
			<if test="receiveMode != null">
				receive_mode = #{receiveMode,jdbcType=VARCHAR},
			</if>
			<if test="serviceStandard != null">
				service_standard = #{serviceStandard,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="remarkInternal != null">
				remark_internal = #{remarkInternal,jdbcType=VARCHAR},
			</if>
			<if test="creatorId != null">
				creator_id = #{creatorId,jdbcType=INTEGER},
			</if>
			<if test="creatorName != null">
				creator_name = #{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=BIGINT},
			</if>
			<if test="state != null">
				state = #{state,jdbcType=INTEGER},
			</if>
			<if test="total != null">
				total = #{total,jdbcType=DECIMAL},
			</if>
			<if test="totalCash != null">
				total_cash = #{totalCash,jdbcType=DECIMAL},
			</if>
			<if test="stateFinance != null">
				state_finance = #{stateFinance,jdbcType=INTEGER},
			</if>

			<if test="sourceTypeId != null">
				source_type_id=#{sourceTypeId,jdbcType=INTEGER},
			</if>
			<if test="sourceTypeName != null">
				source_type_name=#{sourceTypeName,jdbcType=VARCHAR},
			</if>
			<if test="provinceId != null">
				province_id=#{provinceId,jdbcType=INTEGER},
			</if>
			<if test="provinceName != null">
				province_name=#{provinceName,jdbcType=VARCHAR},
			</if>
			<if test="cityId != null">
				city_id=#{cityId,jdbcType=INTEGER},
			</if>
			<if test="cityName != null">
				city_name=#{cityName,jdbcType=VARCHAR},
			</if>
			<if test="departProvinceId != null">
				depart_province_id  =#{departProvinceId,jdbcType=INTEGER},
			</if>
			<if test="departProvinceName != null">
				depart_province_name =#{departProvinceName,jdbcType=VARCHAR},
			</if>
			<if test="departCityId != null">
				depart_city_id =#{departCityId,jdbcType=INTEGER},
			</if>
			<if test="departCityName != null">
				depart_city_name =#{departCityName,jdbcType=VARCHAR},
			</if>
			<if test="orderLockState != null">
				order_lock_state=#{orderLockState,jdbcType=INTEGER},
			</if>
			<if test="aiyouGroupId != null">
				aiyou_group_id=#{aiyouGroupId,jdbcType=VARCHAR},
			</if>
			
			<!--  内部结算(销售)—审核功能  auther tengd  date 20161028-->
			<if test="b2b_export_state != null">
				b2b_export_state=#{b2b_export_state,jdbcType=INTEGER},
			</if>
			
			
			<if test="orderBusiness != null">
				order_business=#{orderBusiness,jdbcType=VARCHAR},
			</if>

			<if test="extResId != null">
				ext_res_id=#{extResId,jdbcType=INTEGER},
			</if>
			<if test="extResState != null">
				ext_res_state=#{extResState,jdbcType=INTEGER},
			</if>
			<if test="extResCleanTime != null">
				ext_res_clean_time=#{extResCleanTime,jdbcType=VARCHAR},
			</if>
			<if test="extResCleanStock != null">
				ext_res_clean_stock=#{extResCleanStock,jdbcType=INTEGER},
			</if>
			<if test="extResPrepay != null">
				ext_res_prepay=#{extResPrepay,jdbcType=DECIMAL},
			</if>
			<if test="numChildBaby != null">
				num_child_baby=#{numChildBaby,jdbcType=INTEGER},
			</if>
				<if test="orderMode != null">
				order_mode=#{orderMode,jdbcType=INTEGER},
			</if>
			<if test="pushOrderId != null">
				push_order_id=#{pushOrderId,jdbcType=INTEGER},
			</if>
			<if test="pushTimeUpdate != null">
				push_time_update=#{pushTimeUpdate,jdbcType=DATE},
			</if>
			<if test="pushSupplierName != null and pushSupplierName != ''">
				push_supplier_name=#{pushSupplierName,jdbcType=VARCHAR},
			</if>
			<if test="buyerNick != null and buyerNick != ''">
				buyer_nick=#{buyerNick,jdbcType=VARCHAR}
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		update group_order
		set biz_id = #{bizId,jdbcType=INTEGER},
		group_id =
		#{groupId,jdbcType=INTEGER},
		supplier_id =
		#{supplierId,jdbcType=INTEGER},
		supplier_name =
		#{supplierName,jdbcType=VARCHAR},
		order_no =
		#{orderNo,jdbcType=VARCHAR},
		order_no_sort =
		#{orderNoSort,jdbcType=INTEGER},
		order_type =
		#{orderType,jdbcType=INTEGER},
		type = #{type,jdbcType=INTEGER},
		contract_no = #{contractNo,jdbcType=VARCHAR},
		guest_source_id =
		#{guestSourceId,jdbcType=INTEGER},
		guest_source_name =
		#{guestSourceName,jdbcType=VARCHAR},
		supplier_code =
		#{supplierCode,jdbcType=VARCHAR},
		contact_name =
		#{contactName,jdbcType=VARCHAR},
		contact_tel =
		#{contactTel,jdbcType=VARCHAR},
		contact_mobile =
		#{contactMobile,jdbcType=VARCHAR},
		contact_fax =
		#{contactFax,jdbcType=VARCHAR},
		operator_id =
		#{operatorId,jdbcType=INTEGER},
		operator_name =
		#{operatorName,jdbcType=VARCHAR},
		sale_operator_id =
		#{saleOperatorId,jdbcType=INTEGER},
		sale_operator_name =
		#{saleOperatorName,jdbcType=VARCHAR},
		price_id
		=
		#{priceId,jdbcType=INTEGER},
		num_adult =
		#{numAdult,jdbcType=INTEGER},
		num_child = #{numChild,jdbcType=INTEGER},
		num_guide =
		#{numGuide,jdbcType=INTEGER},
		departure_date =
		#{departureDate,jdbcType=DATE},
		product_id =
		#{productId,jdbcType=INTEGER},
		product_brand_id =
		#{productBrandId,jdbcType=INTEGER},
		product_brand_name =
		#{productBrandName,jdbcType=VARCHAR},
		product_name =
		#{productName,jdbcType=VARCHAR},
		product_short_name =
		#{productShortName,jdbcType=VARCHAR},
		receive_mode =
		#{receiveMode,jdbcType=VARCHAR},
		service_standard =
		#{serviceStandard,jdbcType=VARCHAR},
		remark =
		#{remark,jdbcType=VARCHAR},
		remark_internal =
		#{remarkInternal,jdbcType=VARCHAR},
		creator_id =
		#{creatorId,jdbcType=INTEGER},
		creator_name =
		#{creatorName,jdbcType=VARCHAR},
		create_time =
		#{createTime,jdbcType=BIGINT},
		state =
		#{state,jdbcType=INTEGER},
		total=
		#{total,jdbcType=DECIMAL},
		state_finance=
		#{stateFinance,jdbcType=INTEGER},
		source_type_id=#{sourceTypeId,jdbcType=INTEGER},
		source_type_name=#{sourceTypeName,jdbcType=VARCHAR},
		province_id=#{provinceId,jdbcType=INTEGER},
		province_name=#{provinceName,jdbcType=VARCHAR},
		city_id=#{cityId,jdbcType=INTEGER},
		city_name=#{cityName,jdbcType=VARCHAR},
		depart_province_id  =#{departProvinceId,jdbcType=INTEGER},
		depart_province_name =#{departProvinceName,jdbcType=VARCHAR},
		depart_city_id =#{departCityId,jdbcType=INTEGER},
		depart_city_name =#{departCityName,jdbcType=VARCHAR},
		order_lock_state=#{orderLockState,jdbcType=INTEGER},
		aiyou_group_id=#{aiyouGroupId,jdbcType=VARCHAR},
		push_order_id=#{pushOrderId,jdbcType=INTEGER},
		push_time_update=#{pushTimeUpdate,jdbcType=DATE},
		push_supplier_name=#{pushSupplierName,jdbcType=VARCHAR},
		buyer_nick=#{buyerNick,jdbcType=VARCHAR}
		where id
		=
		#{id,jdbcType=INTEGER}
	</update>

	<update id="updateTotalByPrice" parameterType="java.lang.Integer">
		update group_order
		SET total=(SELECT SUM(IFNULL(total_price,0)) total_price
		FROM
		group_order_price WHERE order_id=#{orderId,jdbcType=INTEGER} and
		mode=0)
		WHERE id=#{orderId,jdbcType=INTEGER}
	</update>

	<resultMap id="ProductGuestStaticsMap" type="com.yimayhd.erpcenter.dal.sales.client.query.vo.ProductGuestStaticsVo">
		<result column="product_brand_name" property="productBrandName" jdbcType="VARCHAR" />
		<result column="product_name" property="productName" jdbcType="VARCHAR" />
		<result column="guestcnt" property="guestCnt" jdbcType="INTEGER" />
		<result column="orderCount" property="orderCount" jdbcType="INTEGER" />
	</resultMap>
	<select id="productGuestStatics" resultMap="ProductGuestStaticsMap">
		SELECT
		go.`product_brand_name`,go.`product_name`,COUNT(go.`id`)
		orderCount,SUM(IFNULL(num_adult,0))+SUM(IFNULL(num_child,0)) guestcnt
		FROM
		`group_order` go
		WHERE 1=1
		AND go.`state`=1
		AND
		go.biz_id=#{condition.bizId,jdbcType=INTEGER}
		and go.operator_id in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="condition.orderMode!=null">
			AND
			go.`order_type`=#{condition.orderMode,jdbcType=INTEGER}
		</if>
		<if test="condition.supplierName!=null and condition.supplierName!=''">
			AND go.`supplier_name` like
			CONCAT('%',#{condition.supplierName},'%')
		</if>
		<if test="condition.productName!=null and condition.productName!=''">
			AND ( go.`product_name` like
			CONCAT('%',#{condition.productName},'%') or
			go.`product_brand_name`
			like
			CONCAT('%',#{condition.productName},'%') )
		</if>
		<if test="condition.operatorIds!=null and condition.operatorIds!='' ">
			<if test="condition.operatorType==0">
				AND go.sale_operator_id in (${condition.operatorIds})
			</if>
			<if test="condition.operatorType==1">
				AND go.operator_id in (${condition.operatorIds})
			</if>
		</if>
		<if test="condition.dateType==0">
			<if test="condition.startDate!=null">
				<![CDATA[ AND go.departure_date>=#{condition.startDate}]]>
			</if>
			<if test="condition.endDate!=null">
				<![CDATA[ AND go.departure_date<=#{condition.endDate}]]>
			</if>
		</if>
		<if test="condition.dateType==1">
			<if test="condition.startDate!=null">
				<![CDATA[ AND go.create_time>=#{condition.startDateNum}]]>
			</if>
			<if test="condition.endDate!=null">
				<![CDATA[ AND go.create_time<#{condition.endDateNum}]]>
			</if>
		</if>
		GROUP BY go.`product_brand_name`,go.`product_name`
		ORDER BY
		guestcnt
		DESC
		<if test="condition.showNum!=null">
			limit #{condition.showNum}
		</if>

	</select>
	<select id="guestSourceStatics" resultType="java.util.HashMap">
		SELECT
		ttt.provinceName,ttt.guestCnt,ttt.adultCnt,ttt.childCnt,ttt.guideCnt
		FROM(
		SELECT tt.province_name AS
		provinceName,(SUM(IFNULL(tt.num_adult,0))+SUM(IFNULL(tt.num_child,0)))
		guestCnt,
		SUM(IFNULL(tt.num_adult,0)) adultCnt,SUM(IFNULL(tt.num_child,0))
		childCnt,SUM(IFNULL(tt.num_guide,0)) guideCnt
		FROM (
		SELECT (CASE WHEN
		go.province_name IS NULL THEN '未知' WHEN
		go.province_name='' THEN '未知'
		ELSE go.province_name END)
		province_name,go.num_adult,go.num_child,go.num_guide
		FROM `group_order`
		go
		WHERE
		go.`state`=1
		AND go.biz_id=#{condition.bizId,jdbcType=INTEGER}
		and go.operator_id in
		<if test="set != null">
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach></if>
		<if test="condition.orderMode!=null">
			AND
			go.`order_type`=#{condition.orderMode,jdbcType=INTEGER}
		</if>
		<if test="condition.supplierName!=null and condition.supplierName!=''">
			AND go.`supplier_name` like
			CONCAT('%',#{condition.supplierName},'%')
		</if>
		<if test="condition.productName!=null and condition.productName!=''">
			AND ( go.`product_name` like
			CONCAT('%',#{condition.productName},'%') or
			go.`product_brand_name`
			like
			CONCAT('%',#{condition.productName},'%') )
		</if>
		<if test="condition.operatorIds!=null and condition.operatorIds!='' ">
			<if test="condition.operatorType==0">
				AND go.sale_operator_id in (${condition.operatorIds})
			</if>
			<if test="condition.operatorType==1">
				AND go.operator_id in (${condition.operatorIds})
			</if>
		</if>
		<if test="condition.dateType==0">
			<if test="condition.startDate!=null">
				<![CDATA[ AND go.departure_date>=#{condition.startDate}]]>
			</if>
			<if test="condition.endDate!=null">
				<![CDATA[ AND go.departure_date<=#{condition.endDate}]]>
			</if>
		</if>
		<if test="condition.dateType==1">
			<if test="condition.startDate!=null">
				<![CDATA[ AND go.create_time>=#{condition.startDateNum}]]>
			</if>
			<if test="condition.endDate!=null">
				<![CDATA[ AND go.create_time<=#{condition.endDateNum}]]>
			</if>
		</if>
		)tt
		GROUP BY tt.`province_name`
		) ttt
		ORDER BY ttt.guestCnt DESC
		<if test="condition.showNum!=null">
			limit #{condition.showNum}
		</if>
	</select>

	<!-- 关联收入 -->
	<select id="selectIncomeJoinTableListPage" parameterType="com.yihg.mybatis.utility.PageBean" resultType="java.util.HashMap">
		select a.id,
		<if test="page.parameter.supType==6">
			(IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0))
			total,
			(IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0) -
			IFNULL(a.total_cash,0)) balance,
		</if>
		<if test="page.parameter.supType!=6">
			IFNULL(a.total,0) total, (IFNULL(a.total,0) -
			IFNULL(a.total_cash,0)) balance,
		</if>
		<if test="page.parameter.supType==1">
			a.receive_mode, a.num_adult, a.num_child,
			(IFNULL(a.num_adult,0)+IFNULL(a.num_child,0)+IFNULL(a.num_guide,0))
			sum_person, a.order_no
		</if>
		<if test="page.parameter.supType!=1">a.booking_no</if>
		order_no,
		<if test="page.parameter.supType == 12">a.cash_type,a.supplier_type,a.remark,</if>
		a.total_cash,
		a.audit_user,
		b.id group_id,
		b.group_code,
		b.product_name,
		b.product_brand_name,
		b.group_mode,
		b.operator_name,
		a.state_finance,
		a.state_seal
		from
		<if test="page.parameter.supType==1">group_order</if>
		<if test="page.parameter.supType==6">booking_shop</if>
		<if test="page.parameter.supType==12">booking_supplier</if>
		a left join tour_group b on (a.group_id = b.id and b.group_state IN (1,3,4))
		where
		b.biz_id = #{bizId}
		and a.supplier_id=#{page.parameter.supplierId}
		<if test="page.parameter.supType==1">
			and a.state = 1
		</if>
		<if test="page.parameter.supType==12">
			and a.supplier_type = 120
		</if>
		<if test="page.parameter.orderNo!=null">
			and
			<if test="page.parameter.supType==1">a.receive_mode</if>
			<if test="page.parameter.supType!=1">a.booking_no</if>
			like '%${page.parameter.orderNo}%'
		</if>
		<if test="page.parameter.groupCode!=null">and b.group_code like '%${page.parameter.groupCode}%'
		</if>

		<if test="page.parameter.dateType == 'groupDate'">
			<if test="page.parameter.startMin != null">
				and b.date_start <![CDATA[>=]]>
				#{page.parameter.startMin}
			</if>
			<if test="page.parameter.startMax != null">
				and b.date_start <![CDATA[<=]]>
				#{page.parameter.startMax}
			</if>
		</if>
		<if test="page.parameter.dateType == 'orderDate'">
			<if test="page.parameter.startMin != null">
				and
				<if test="page.parameter.supType==1">a.departure_date</if>
				<if test="page.parameter.supType==6">a.shop_date</if>
				<if test="page.parameter.supType==12">a.booking_date</if>
				<![CDATA[>=]]>
				#{page.parameter.startMin}
			</if>
			<if test="page.parameter.startMax != null">
				and
				<if test="page.parameter.supType==1">a.departure_date</if>
				<if test="page.parameter.supType==6">a.shop_date</if>
				<if test="page.parameter.supType==12">a.booking_date</if>
				<![CDATA[<=]]>
				#{page.parameter.startMax}
			</if>
		</if>

		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and b.operator_id in (${page.parameter.saleOperatorIds})
		</if>
		<if test="page.parameter.set != null">
			and b.operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.payState == 'unPaid'">
			<if test="page.parameter.supType==6">
				and (IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0) - IFNULL(a.total_cash,0)) != 0
			</if>
			<if test="page.parameter.supType!=6">
				and (IFNULL(a.total,0) - IFNULL(a.total_cash,0)) != 0
			</if>
		</if>
		<if test="page.parameter.payState == 'paid'">
			<if test="page.parameter.supType==6">
				and (IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0) - IFNULL(a.total_cash,0)) = 0
			</if>
			<if test="page.parameter.supType!=6">
				and (IFNULL(a.total,0) - IFNULL(a.total_cash,0)) = 0
			</if>
		</if>
		order by b.date_start asc
	</select>
	<select id="getGroupInfoByGroupId" resultType="java.util.HashMap">
		SELECT
		go.`supplier_name` supplierName,
		go.`receive_mode` receiveMode,
		go.id
		orderId,
		go.province_name provinceName,go.city_name cityName,
		IFNULL(go.`num_adult`, 0) adultCount,
		IFNULL(go.`num_child`, 0)
		childCount ,
		go.order_type orderType
		FROM
		`tour_group` tg join
		`group_order` go
		on tg.id=go.group_id

		WHERE go.group_id = #{groupId} and
		go.biz_Id=#{bizId}
	</select>

	<select id="getOrderBreifInfoByGroupId" resultType="java.util.HashMap">
		SELECT id
		orderId,supplier_name supplierName,receive_mode receiveMode
		FROM
		group_order
		WHERE group_id =
		#{groupId}
	</select>
	<select id="selectGroupNumForQuery" resultMap="BaseResultMap" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		SELECT
		p.supplier_name AS supplierName,
		COUNT(p.supplier_name) AS
		supplierCount,
		SUM(m.guestCount) AS guestCount,
		sum(p.num_adult)
		num_adult,
		sum(p.num_child) num_child
		FROM
		group_order p left join
		(SELECT
		m.order_id AS order_id,
		COUNT(m.order_id) AS guestCount
		FROM
		group_order_guest m
		GROUP BY m.order_id) m on p.id = m.order_id
		WHERE

		p.state!=-1
		and p.biz_id=#{bizId}
		and p.operator_id in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="groupOrder.dateType==1">
			<if test="groupOrder.startTime!=null and groupOrder.startTime!=''">
				<![CDATA[
	    	 	AND p.departure_date >=#{groupOrder.startTime} ]]>
			</if>
			<if test="groupOrder.endTime!=null and groupOrder.endTime!=''">
				<![CDATA[
	    	 	AND p.departure_date <=#{groupOrder.endTime}]]>
			</if>
		</if>

		<if test="groupOrder.dateType==2">
			<if test="groupOrder.startTime!=null and groupOrder.startTime!=''">
				<![CDATA[
	    	 	AND p.create_time >=#{groupOrder.startTime} ]]>
			</if>
			<if test="groupOrder.endTime!=null and groupOrder.endTime!=''">
				<![CDATA[
	    	 	AND p.create_time <=#{groupOrder.endTime}]]>
			</if>
		</if>

		<if test="groupOrder.productBrandName != null and groupOrder.productBrandName != ''">
			AND (p.product_brand_name LIKE
			CONCAT('%',#{groupOrder.productBrandName},'%')
			or p.product_name
			like
			CONCAT('%',#{groupOrder.productBrandName},'%' ))
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and p.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and p.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.orderType !=null ">
			and p.order_type=#{groupOrder.orderType}
		</if>
		GROUP BY p.supplier_id order by num_adult desc, supplierCount desc
		<if test="groupOrder.showNum!=null">limit #{groupOrder.showNum}</if>
	</select>

	<update id="updateGroupOrderPersonNum" parameterType="java.lang.Integer">
		update
		group_order
		SET num_adult=(SELECT count(1) from group_order_guest t
		where t.order_id=#{orderId} and t.type=1 ),
		num_child=(SELECT count(1)
		from group_order_guest t where t.order_id=#{orderId} and
		t.type=2 ),
		num_guide=(SELECT count(1) from group_order_guest t where
		t.order_id=#{orderId} and
		t.type=3)
		WHERE id=#{orderId,jdbcType=INTEGER}
	</update>

	<update id="updateTourGroupPersonNum" parameterType="java.lang.Integer">
		update
		tour_group
		SET
		total_adult=(SELECT sum(IFNULL(t.num_adult,0)) from
		group_order t where
		t.group_id=#{groupId} and t.state!=-1 ),
		total_child=(SELECT sum(IFNULL(t.num_child,0)) from group_order t
		where
		t.group_id=#{groupId} and t.state!=-1 ),
		total_guide=(SELECT
		sum(IFNULL(t.num_guide,0)) from group_order t where
		t.group_id=#{groupId} and t.state!=-1 ),
		total_baby=(SELECT
		sum(IFNULL(t.num_child_baby,0)) from group_order t where
		t.group_id=#{groupId} and t.state!=-1 )
		WHERE id=#{groupId}
	</update>


	<update id="updateOrderPrice" parameterType="java.lang.Integer">
		update group_order
		SET total=(SELECT IFNULL(SUM(t.total_price),0) from group_order_price
		t where t.order_id=#{orderId} and t.mode=0 )
		WHERE
		id=#{orderId,jdbcType=INTEGER}
	</update>

	<update id="updateGroupPrice" parameterType="java.lang.Integer">
		update tour_group
		SET total_income=(SELECT IFNULL(SUM(b.total_price),0) FROM group_order
		a , group_order_price b WHERE b.order_id=a.id AND
		a.group_id=#{groupId} and b.mode =0 AND a.state!=-1 )
		WHERE
		id=#{groupId}
	</update>

	<select id="selectGroupIdsByReceiveMode" resultType="java.util.HashMap" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.vo.TourGroupVO">
		SELECT DISTINCT group_id FROM `group_order`
		WHERE
		<if test="receiveMode==null or receiveMode==''">
			1!=1
		</if>
		<if test="receiveMode!=null and receiveMode!=''">
			receive_mode LIKE CONCAT('%',#{receiveMode},'%')
		</if>
		AND order_type=1 AND biz_id=#{bizId}
		<if test="startTime!=null">
			<![CDATA[ AND departure_date>=#{startTime}]]>
		</if>
		<if test="endTime!=null">
			<![CDATA[ AND departure_date<=#{endTime}]]>
		</if>
	</select>

	<!-- 一地散 -->
	<select id="selectSpecialOrderListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select a.*,ifNull(b.group_state,0) as groupState,b.group_mode ,b.group_state
		from group_order a left join tour_group b on a.group_id=b.id 
		where a.state!=-1 and a.biz_id=${bizId} and a.order_type=-1
		and a.sale_operator_id in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<choose>
			<when test="page.parameter.startTime != null and page.parameter.endTime != null ">
				<if test="page.parameter.dateType==1">
					<![CDATA[  and a.departure_date >=#{page.parameter.startTime}  and a.departure_date <=#{page.parameter.endTime}]]>
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[  and a.create_time >=#{page.parameter.startTime}  and a.create_time <=#{page.parameter.endTime}]]>
				</if>
			</when>
			<when test="page.parameter.startTime != null  and page.parameter.endTime == null  ">
				<if test="page.parameter.dateType==1">
					and a.departure_date=#{page.parameter.startTime}
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[	and a.create_time<=#{page.parameter.startTime}]]>
				</if>
			</when>
			<when test="page.parameter.endTime != null and  page.parameter.startTime == null ">
				<if test="page.parameter.dateType==1">
					<![CDATA[  and a.departure_date =#{page.parameter.endTime}]]>
				</if>
				<if test="page.parameter.dateType==2">
					<![CDATA[  and a.create_time >=#{page.parameter.endTime}]]>
				</if>
			</when>
		</choose>
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and a.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE
			CONCAT('%','${page.parameter.productName}','%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and a.supplier_name LIKE
			CONCAT('%','${page.parameter.supplierName}','%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.sourceTypeId != null and page.parameter.sourceTypeId !=-1">
			and a.source_type_id=#{page.parameter.sourceTypeId}
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and a.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and a.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.state ==1">
			and a.group_id is not null
		</if>
		<if test="page.parameter.state ==2">
			and a.group_id is null
		</if>
		<if test="page.parameter.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="page.parameter.orderLockState ==1">
			and a.order_lock_state=1
		</if>

		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			and b.group_code LIKE
			CONCAT('%',trim(#{page.parameter.groupCode}),'%')
		</if>

		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.orderBusiness!=null and page.parameter.orderBusiness!=''">
			and a.order_business =#{page.parameter.orderBusiness}
		</if>
		<if test="page.parameter.stateFinance ==0">
			AND (a.state_finance = 0 or a.state_finance is null)
		</if>
		<if test="page.parameter.stateFinance ==1">
			and a.state_finance=1
		</if>
		<if test="page.parameter.groupMode!=null and page.parameter.groupMode!=''">
			and b.group_mode=#{page.parameter.groupMode}
		</if>

		ORDER BY a.departure_date,a.create_time
	</select>

	<!-- 
	@Auther TengDong
	@Date 20161112
	内部结算销售总合计人数统计、收入、其它收入、成本、毛利 -->
	<select id="selectProfitEverifyByCon"  resultMap="BaseResultMap">
			SELECT
				a.biz_id,				
				sum(IFNULL(a.num_adult,0)) AS num_adult, 
				sum(IFNULL(a.num_child,0)) AS num_child,
				sum(IFNULL(a.num_guide,0)) AS num_guide, 
				sum(IFNULL(a.total,0)) AS sum_total, 
				sum(ifnull(c.qdtotal,0)) AS sum_qdtotal, 
				sum(ifnull(bd.total_price,0)) AS sum_budget,
				sum(ifnull(a.total,0)+ifnull(c.qdtotal,0)-ifnull(bd.total_price,0)) AS sum_profit
			FROM
				group_order a
			LEFT JOIN tour_group b ON a.group_id = b.id
			left join (select order_id,sum(total) qdtotal from booking_supplier sup 
				where sup.supplier_type=120 GROUP BY sup.order_id)  c on c.order_id=a.id
			left join (select
					order_id,sum(total_price) total_price from group_order_price where mode=1 
					GROUP BY order_id) bd on (a.id=bd.order_id)
			where a.state!=-1 
			<if test = "bizId!=null">
			and a.biz_id=#{bizId}
		</if>
			and a.aiyou_group_id=-1
		<!--<if test="userRightType==1">
			and a.sale_operator_id in
		</if>
		<if test="userRightType!=1"> 
			and a.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>-->
		<if test="groupOrder.startTime != null and groupOrder.startTime !='' ">
			<if test="groupOrder.dateType==1">
				and a.departure_date<![CDATA[>=]]>#{groupOrder.startTime}
			</if>
			<if test="groupOrder.dateType==2">
				and a.create_time <![CDATA[>=]]>#{groupOrder.startTime}
			</if>
		</if>
		<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
			<if test="groupOrder.dateType==1">
				and a.departure_date<![CDATA[<=]]>#{groupOrder.endTime}
			</if>
			<if test="groupOrder.dateType==2">
				nd a.create_time<![CDATA[<=]]>#{groupOrder.endTime}
			</if>
		</if>
			
		<if test="groupOrder.groupCode !=null and groupOrder.groupCode !=''">
			and b.group_code LIKE CONCAT('%',trim(#{groupOrder.groupCode}),'%')
		</if>
		<if test="groupOrder.receiveMode != null and groupOrder.receiveMode !=''">
			and a.receive_mode LIKE CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.supplierName != null and groupOrder.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${groupOrder.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${groupOrder.supplierName}','%') )
		</if>
		<if test="groupOrder.idList!=null and groupOrder.idList.size() > 0">
			and a.id not in
			<foreach collection="groupOrder.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==3">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.creator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.productBrandId != null and groupOrder.productBrandId != -1">
			and a.product_brand_id =#{groupOrder.productBrandId}
		</if>
		<if test="groupOrder.productName != null and groupOrder.productName !=''">
			and a.product_name LIKE CONCAT('%','${groupOrder.productName}','%')
		</if>
		<if test="groupOrder.stateFinance !=null">
			AND a.state_finance = #{groupOrder.stateFinance}
		</if>
		<if test="groupOrder.orderLockState !=null">
			and a.order_lock_state=#{groupOrder.orderLockState}
		</if>		
		<if test="groupOrder.orderLockState!=null and groupOrder.orderLockState!=100  and groupOrder.orderLockState!=''">
			and a.order_lock_state=#{groupOrder.orderLockState}
		</if>
		<if test="groupOrder.orderLockState==100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="groupOrder.orderNo != null and groupOrder.orderNo!=''">
			AND a.order_mode IN (${groupOrder.orderNo})
		</if>
		ORDER BY a.departure_date,a.create_time desc
	</select>
	
	<!--内部结算销售总合计(导出Excel) -->
	<select id="selectProfitEverifyByTotal"  resultType="java.util.HashMap">
			SELECT
				a.biz_id,a.departure_date,
				sum(IFNULL(a.num_adult,0)) AS num_adult, 
				sum(IFNULL(a.num_child,0)) AS num_child,
				sum(IFNULL(a.num_guide,0)) AS num_guide, 
				sum(IFNULL(a.total,0)) AS sum_total, 
				sum(ifnull(c.qdtotal,0)) AS sum_qdtotal, 
				sum(ifnull(bd.total_price,0)) AS sum_budget,
				sum(ifnull(a.total,0)+ifnull(c.qdtotal,0)-ifnull(bd.total_price,0)) AS sum_profit
			FROM
				group_order a
			LEFT JOIN tour_group b ON a.group_id = b.id
			left join (select order_id,sum(total) qdtotal from booking_supplier sup 
				where sup.supplier_type=120 GROUP BY sup.order_id)  c on c.order_id=a.id
			left join (select
					order_id,sum(total_price) total_price from group_order_price where mode=1 
					GROUP BY order_id) bd on (a.id=bd.order_id)
			where a.state!=-1 
			<if test = "bizId!=null">
			and a.biz_id=#{bizId}
		</if>
			and a.aiyou_group_id=-1
		<if test="userRightType==1"> 
			and a.sale_operator_id in
		</if>
		<if test="userRightType!=1"> 
			and a.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="page.parameter.startTime != null and page.parameter.startTime !='' ">
			<if test="page.parameter.dateType==1">
				and a.departure_date<![CDATA[>=]]>#{page.parameter.startTime}
			</if>
			<if test="page.parameter.dateType==2">
				and a.create_time <![CDATA[>=]]>#{page.parameter.startTime}
			</if>
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			<if test="page.parameter.dateType==1">
				and a.departure_date<![CDATA[<=]]>#{page.parameter.endTime}
			</if>
			<if test="page.parameter.dateType==2">
				nd a.create_time<![CDATA[<=]]>#{page.parameter.endTime}
			</if>
		</if>
			
		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			and b.group_code LIKE CONCAT('%',trim(#{page.parameter.groupCode}),'%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and a.receive_mode LIKE CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${page.parameter.supplierName}','%') )
		</if>
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and a.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE CONCAT('%','${page.parameter.productName}','%')
		</if>
		<if test="page.parameter.stateFinance !=null">
			AND a.state_finance = #{page.parameter.stateFinance}
		</if>
		<if test="page.parameter.orderLockState !=null">
			and a.order_lock_state=#{page.parameter.orderLockState}
		</if>		
		<if test="page.parameter.orderLockState!=null and page.parameter.orderLockState!=100  and page.parameter.orderLockState!=''">
			and a.order_lock_state=#{page.parameter.orderLockState}
		</if>
		<if test="page.parameter.orderLockState==100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="page.parameter.orderNo != null and page.parameter.orderNo!=''">
			AND a.order_mode IN (${page.parameter.orderNo})
		</if>
		ORDER BY a.departure_date,a.create_time desc
	</select>
	
	
	<select id="selectProfitEverifyListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
			a.*, 
			ifNull(b.group_state, 0) AS groupState,
			b.group_mode,
			b.group_state,
			b.group_code,
			ifnull(bd.total_price, 0) budget,
		    ifnull(c.qdtotal, 0) qdtotal,
			ifnull(a.total,0)+ifnull(c.qdtotal,0)-ifnull(bd.total_price,0) as g_profit
		FROM
			group_order a
		LEFT JOIN tour_group b ON a.group_id = b.id
		left join (select sup.order_id,sum(sup.total) qdtotal from booking_supplier sup 
			where sup.supplier_type=120 GROUP BY sup.order_id) c on c.order_id=a.id
		left join (select
				order_id,sum(total_price) total_price from group_order_price where mode=1 GROUP BY order_id) bd on (a.id=bd.order_id)
		where a.state!=-1 
		<if test = "bizId!=null">
			and a.biz_id=#{bizId}
		</if>
		<!--and a.aiyou_group_id=-1
    <if test="userRightType==1">
        and a.sale_operator_id in
    </if>
    <if test="userRightType!=1">
        and a.operator_id in
    </if>
    <foreach item="item" index="index" collection="set" open="(" separator="," close=")">
        #{item}
    </foreach>-->
		<if test="page.parameter.startTime != null and page.parameter.startTime !='' ">
			<if test="page.parameter.dateType==1">
				and a.departure_date<![CDATA[>=]]>#{page.parameter.startTime}
			</if>
			<if test="page.parameter.dateType==2">
				and a.create_time <![CDATA[>=]]>#{page.parameter.startTime}
			</if>
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			<if test="page.parameter.dateType==1">
				and a.departure_date<![CDATA[<=]]>#{page.parameter.endTime}
			</if>
			<if test="page.parameter.dateType==2">
				and a.create_time<![CDATA[<=]]>#{page.parameter.endTime}
			</if>
		</if>
			
		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			and b.group_code LIKE CONCAT('%',trim(#{page.parameter.groupCode}),'%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and a.receive_mode LIKE CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${page.parameter.supplierName}','%') )
		</if>
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and a.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE CONCAT('%','${page.parameter.productName}','%')
		</if>
		<if test="page.parameter.stateFinance !=null">
			AND a.state_finance = #{page.parameter.stateFinance}
		</if>
		<if test="page.parameter.orderLockState !=null">
			and a.order_lock_state=#{page.parameter.orderLockState}
		</if>		
		<if test="page.parameter.orderLockState!=null and page.parameter.orderLockState!=100  and page.parameter.orderLockState!=''">
			and a.order_lock_state=#{page.parameter.orderLockState}
		</if>
		<if test="page.parameter.orderLockState==100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="page.parameter.orderNo != null and page.parameter.orderNo!=''">
			AND a.order_mode IN (${page.parameter.orderNo})
		</if>
		ORDER BY a.departure_date,a.create_time desc
	</select>
	
	
	
	

	<!-- 爱游淘宝 -->
	<select id="selectTaobaoOrderListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select a.*,ifNull(b.group_state,0) as groupState,b.group_mode ,b.group_state,b.group_code
		from group_order a left join tour_group b on a.group_id=b.id 
		where a.state!=-1 and a.biz_id=${bizId}

		<if test="userRightType==1"> 
			and a.sale_operator_id in
		</if>
		<if test="userRightType!=1"> 
			and a.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
			<if test="page.parameter.startTime != null and page.parameter.startTime !='' ">
				<if test="page.parameter.dateType==1">
					and a.departure_date<![CDATA[>=]]>#{page.parameter.startTime}
				</if>
				<if test="page.parameter.dateType==2">
					and a.create_time <![CDATA[>=]]>#{page.parameter.startTime}
				</if>
			</if>
			<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
				<if test="page.parameter.dateType==1">
					and a.departure_date<![CDATA[<=]]>#{page.parameter.endTime}
				</if>
				<if test="page.parameter.dateType==2">
					nd a.create_time<![CDATA[<=]]>#{page.parameter.endTime}
				</if>
			</if>
			
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and a.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE CONCAT('%','${page.parameter.productName}','%')
		</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName !=''">
			and a.product_brand_name LIKE CONCAT('%','${page.parameter.productBrandName}','%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${page.parameter.supplierName}','%') )
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.sourceTypeId != null and page.parametersourceTypeId !=-1">
			and a.source_type_id=#{page.parameter.sourceTypeId}
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and a.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and a.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.state ==1">
			and a.group_id is not null
		</if>
		<if test="page.parameter.state ==2">
			and a.group_id is null
		</if>
		<if test="page.parameter.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="page.parameter.orderLockState ==1">
			and a.order_lock_state=1
		</if>

		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			and b.group_code LIKE CONCAT('%',trim(#{page.parameter.groupCode}),'%')
		</if>

		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.orderBusiness!=null and page.parameter.orderBusiness!=''">
			and a.order_business =#{page.parameter.orderBusiness}
		</if>
		<if test="page.parameter.stateFinance ==0">
			AND (a.state_finance = 0 or a.state_finance is null)
		</if>
		<if test="page.parameter.stateFinance ==1">
			and a.state_finance=1
		</if>
		<if test="page.parameter.orderMode!=null and page.parameter.orderMode!=''">
			and a.order_mode=#{page.parameter.orderMode}
		</if>
		<if test="page.parameter.orderLockState!=null and page.parameter.orderLockState!=100  and page.parameter.orderLockState!=''">
			and a.order_lock_state=#{page.parameter.orderLockState}
		</if>
		<if test="page.parameter.orderLockState==100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="page.parameter.buyerNick != null and page.parameter.buyerNick != ''">
			and a.buyer_nick LIKE CONCAT('%',trim(#{page.parameter.buyerNick}),'%')
		</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and a.order_mode<![CDATA[<>]]>0 and a.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.type != null">
			and a.type =#{page.parameter.type}
		</if>
		<choose>
			<when test="page.parameter.sidx != null and page.parameter.sidx !=''">
				order by ${page.parameter.sidx} ${page.parameter.sord}
			</when>
			<otherwise>
				<if test="page.parameter.byType == 1">
					ORDER BY a.create_time desc,a.departure_date desc
				</if>
				<if test="page.parameter.byType == 2">
					ORDER BY a.departure_date desc,a.create_time desc
				</if>
			</otherwise>
		</choose>
	</select>
	
	<!-- 操作单根据游客姓名进行查询 -->
	<select id="selectTaobaoOrderGuestNameListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select gg.`name`, a.*,ifNull(b.group_state,0) as groupState,b.group_mode ,b.group_state,b.group_code
		from group_order a left join tour_group b on a.group_id=b.id left join group_order_guest gg on a.id=gg.order_id
		where a.state!=-1 and a.biz_id=${bizId}

		<if test="userRightType==1"> 
			and a.sale_operator_id in
		</if>
		<if test="userRightType!=1"> 
			and a.operator_id in
		</if>
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
			<if test="page.parameter.startTime != null and page.parameter.startTime !='' ">
				<if test="page.parameter.dateType==1">
					and a.departure_date<![CDATA[>=]]>#{page.parameter.startTime}
				</if>
				<if test="page.parameter.dateType==2">
					and a.create_time <![CDATA[>=]]>#{page.parameter.startTime}
				</if>
			</if>
			<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
				<if test="page.parameter.dateType==1">
					and a.departure_date<![CDATA[<=]]>#{page.parameter.endTime}
				</if>
				<if test="page.parameter.dateType==2">
					nd a.create_time<![CDATA[<=]]>#{page.parameter.endTime}
				</if>
			</if>
			
		<if test="page.parameter.idList!=null and page.parameter.idList.size() > 0">
			and a.id not in
			<foreach collection="page.parameter.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE CONCAT('%','${page.parameter.productName}','%')
		</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName !=''">
			and a.product_brand_name LIKE CONCAT('%','${page.parameter.productBrandName}','%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${page.parameter.supplierName}','%') )
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${page.parameter.receiveMode}','%')
		</if>
		<if test="page.parameter.sourceTypeId != null and page.parametersourceTypeId !=-1">
			and a.source_type_id=#{page.parameter.sourceTypeId}
		</if>
		<if test="page.parameter.provinceId != null and page.parameter.provinceId !=-1">
			and a.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId != null and page.parameter.cityId !=-1">
			and a.city_id =#{page.parameter.cityId}
		</if>
		<if test="page.parameter.state ==1">
			and a.group_id is not null
		</if>
		<if test="page.parameter.state ==2">
			and a.group_id is null
		</if>
		<if test="page.parameter.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="page.parameter.orderLockState ==1">
			and a.order_lock_state=1
		</if>

		<if test="page.parameter.groupCode !=null and page.parameter.groupCode !=''">
			and b.group_code LIKE CONCAT('%',trim(#{page.parameter.groupCode}),'%')
		</if>

		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and a.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.orderBusiness!=null and page.parameter.orderBusiness!=''">
			and a.order_business =#{page.parameter.orderBusiness}
		</if>
		<if test="page.parameter.stateFinance ==0">
			AND (a.state_finance = 0 or a.state_finance is null)
		</if>
		<if test="page.parameter.stateFinance ==1">
			and a.state_finance=1
		</if>
		<if test="page.parameter.orderMode!=null and page.parameter.orderMode!=''">
			and a.order_mode=#{page.parameter.orderMode}
		</if>
		<if test="page.parameter.orderLockState!=null and page.parameter.orderLockState!=100  and page.parameter.orderLockState!=''">
			and a.order_lock_state=#{page.parameter.orderLockState}
		</if>
		<if test="page.parameter.orderLockState==100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="page.parameter.buyerNick != null and page.parameter.buyerNick != ''">
			and a.buyer_nick LIKE CONCAT('%',trim(#{page.parameter.buyerNick}),'%')
		</if>
		<if test="page.parameter.guestName != null and page.parameter.guestName != ''">
			and gg.`name` LIKE CONCAT('%',trim(#{page.parameter.guestName}),'%')
		</if>
		<if test="page.parameter.mobile != null and page.parameter.mobile != ''">
			and gg.`mobile` LIKE CONCAT('%',trim(#{page.parameter.mobile}),'%')
		</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and a.order_mode<![CDATA[<>]]>0 and a.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.type != null">
			and a.type =#{page.parameter.type}
		</if>
		ORDER BY a.create_time desc,a.departure_date desc
	</select>

	<select id="selectTotalSpecialOrder" resultMap="BaseResultMap" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		select IFNULL(sum(a.num_adult),0) as numAdult ,
		IFNULL(sum(a.num_child),0) as numChild, IFNULL(sum(a.num_guide),0) as
		numGuide, IFNULL(sum(a.total),0) as total from group_order a left join
		tour_group b on a.group_id=b.id where
		a.state!=-1 and a.biz_id=${bizId}
		and a.order_type=-1
		and a.sale_operator_id
		in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="groupOrder.startTime != null and groupOrder.startTime !='' ">
				<if test="groupOrder.dateType==1">
					and a.departure_date<![CDATA[>=]]>#{groupOrder.startTime}
				</if>
				<if test="groupOrder.dateType==2">
					and a.create_time <![CDATA[>=]]>#{groupOrder.startTime}
				</if>
			</if>
			<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
				<if test="groupOrder.dateType==1">
					and a.departure_date<![CDATA[<=]]>#{groupOrder.endTime}
				</if>
				<if test="groupOrder.dateType==2">
					and a.create_time<![CDATA[<=]]>#{groupOrder.endTime}
				</if>
			</if>
		<if test="groupOrder.idList!=null and groupOrder.idList.size() > 0">
			and a.id not in
			<foreach collection="groupOrder.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="groupOrder.productBrandId != null and groupOrder.productBrandId != -1">
			and a.product_brand_id =#{groupOrder.productBrandId}
		</if>
		<if test="groupOrder.productName != null and groupOrder.productName !=''">
			and a.product_name LIKE
			CONCAT('%',#{groupOrder.productName},'%')
		</if>
		<if test="groupOrder.supplierName != null and groupOrder.supplierName !=''">
			and a.supplier_name LIKE
			CONCAT('%',#{groupOrder.supplierName},'%')
		</if>
		<if test="groupOrder.receiveMode != null and groupOrder.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.sourceTypeId != null and groupOrder.sourceTypeId !=-1">
			and a.source_type_id=#{groupOrder.sourceTypeId}
		</if>
		<if test="groupOrder.provinceId != null and groupOrder.provinceId !=-1">
			and a.province_id =#{groupOrder.provinceId}
		</if>
		<if test="groupOrder.cityId != null and groupOrder.cityId !=-1">
			and a.city_id =#{groupOrder.cityId}
		</if>
		<if test="groupOrder.state ==1">
			and a.group_id is not null
		</if>
		<if test="groupOrder.state ==2">
			and a.group_id is null
		</if>
		<if test="groupOrder.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="groupOrder.orderLockState ==1">
			and a.order_lock_state=1
		</if>
		<if test="groupOrder.groupCode !=null and groupOrder.groupCode !=''">
			and b.group_code LIKE
			CONCAT('%',trim(#{groupOrder.groupCode}),'%')
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.orderBusiness!=null and groupOrder.orderBusiness!=''">
			and a.order_business =#{groupOrder.orderBusiness}
		</if>
		<if test="groupOrder.stateFinance ==0">
			AND (state_finance = 0 or state_finance is null)
		</if>
		<if test="groupOrder.stateFinance ==1">
			and a.state_finance=1
		</if>
		<if test="groupOrder.groupMode!=null and groupOrder.groupMode!=''">
			and b.group_mode =#{groupOrder.groupMode}
		</if>

		ORDER BY a.departure_date,a.create_time
	</select>

<select id="selectTotalTaobaoOrder" resultMap="BaseResultMap" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		select IFNULL(sum(a.num_adult),0) as numAdult ,
		IFNULL(sum(a.num_child),0) as numChild, IFNULL(sum(a.num_guide),0) as
		numGuide, IFNULL(sum(a.total),0) as total from group_order a left join
		tour_group b on a.group_id=b.id where
		a.state!=-1 and a.biz_id=${bizId}

		and a.sale_operator_id
		in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="groupOrder.startTime != null and groupOrder.startTime !='' ">
				<if test="groupOrder.dateType==1">
					and a.departure_date<![CDATA[>=]]>#{groupOrder.startTime}
				</if>
				<if test="groupOrder.dateType==2">
					and a.create_time <![CDATA[>=]]>#{groupOrder.startTime}
				</if>
			</if>
			<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
				<if test="groupOrder.dateType==1">
					and a.departure_date<![CDATA[<=]]>#{groupOrder.endTime}
				</if>
				<if test="groupOrder.dateType==2">
					nd a.create_time<![CDATA[<=]]>#{groupOrder.endTime}
				</if>
			</if>
		<if test="groupOrder.idList!=null and groupOrder.idList.size() > 0">
			and a.id not in
			<foreach collection="groupOrder.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="groupOrder.productBrandId != null and groupOrder.productBrandId != -1">
			and a.product_brand_id =#{groupOrder.productBrandId}
		</if>
		<if test="groupOrder.productName != null and groupOrder.productName !=''">
			and a.product_name LIKE
			CONCAT('%',#{groupOrder.productName},'%')
		</if>
	<if test="groupOrder.productBrandName != null and groupOrder.productBrandName !=''">
		and a.product_brand_name LIKE
		CONCAT('%',#{groupOrder.productBrandName},'%')
	</if>
		<if test="groupOrder.supplierName != null and groupOrder.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${groupOrder.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${groupOrder.supplierName}','%') )
		</if>
		<if test="groupOrder.receiveMode != null and groupOrder.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.sourceTypeId != null and groupOrdersourceTypeId !=-1">
			and a.source_type_id=#{groupOrder.sourceTypeId}
		</if>
		<if test="groupOrder.provinceId != null and groupOrder.provinceId !=-1">
			and a.province_id =#{groupOrder.provinceId}
		</if>
		<if test="groupOrder.cityId != null and groupOrder.cityId !=-1">
			and a.city_id =#{groupOrder.cityId}
		</if>
		<if test="groupOrder.state ==1">
			and a.group_id is not null
		</if>
		<if test="groupOrder.state ==2">
			and a.group_id is null
		</if>
		<if test="groupOrder.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="groupOrder.orderLockState ==1">
			and a.order_lock_state=1
		</if>
		<if test="groupOrder.groupCode !=null and groupOrder.groupCode !=''">
			and b.group_code LIKE
			CONCAT('%',trim(#{groupOrder.groupCode}),'%')
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.orderBusiness!=null and groupOrder.orderBusiness!=''">
			and a.order_business =#{groupOrder.orderBusiness}
		</if>
		<if test="groupOrder.stateFinance ==0">
			AND (state_finance = 0 or state_finance is null)
		</if>
		<if test="groupOrder.stateFinance ==1">
			and a.state_finance=1
		</if>
		<if test="groupOrder.groupMode!=null and groupOrder.groupMode!=''">
			and b.group_mode =#{groupOrder.groupMode}
		</if>
		<if test="groupOrder.orderLockState!=null and groupOrder.orderLockState!=100 and groupOrder.orderLockState!=''">
			and a.order_lock_state=#{groupOrder.orderLockState}
		</if>
		<if test="groupOrder.orderLockState == 100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="groupOrder.buyerNick != null and groupOrder.buyerNick != ''">
			and a.buyer_nick LIKE CONCAT('%',trim(#{groupOrder.buyerNick}),'%')
		</if>
		<if test="groupOrder.orderNo!=null and groupOrder.orderNo!=''">
			and a.order_mode<![CDATA[<>]]>0 and a.order_mode in (${groupOrder.orderNo})
		</if>
	<if test="groupOrder.type!=null">
		and a.type =#{groupOrder.type}
	</if>
		ORDER BY a.departure_date,a.create_time
	</select>
	
	<select id="selectTotalTaobaoGuestNameOrder" resultMap="BaseResultMap" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		select IFNULL(sum(a.num_adult),0) as numAdult ,
		IFNULL(sum(a.num_child),0) as numChild, IFNULL(sum(a.num_guide),0) as
		numGuide, IFNULL(sum(a.total),0) as total from group_order a left join
		tour_group b on a.group_id=b.id left join group_order_guest gg on a.id=gg.order_id
		where a.state!=-1 and a.biz_id=${bizId}

		and a.sale_operator_id
		in
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="groupOrder.startTime != null and groupOrder.startTime !='' ">
				<if test="groupOrder.dateType==1">
					and a.departure_date<![CDATA[>=]]>#{groupOrder.startTime}
				</if>
				<if test="groupOrder.dateType==2">
					and a.create_time <![CDATA[>=]]>#{groupOrder.startTime}
				</if>
			</if>
			<if test="groupOrder.endTime != null and groupOrder.endTime != ''">
				<if test="groupOrder.dateType==1">
					and a.departure_date<![CDATA[<=]]>#{groupOrder.endTime}
				</if>
				<if test="groupOrder.dateType==2">
					nd a.create_time<![CDATA[<=]]>#{groupOrder.endTime}
				</if>
			</if>
		<if test="groupOrder.idList!=null and groupOrder.idList.size() > 0">
			and a.id not in
			<foreach collection="groupOrder.idList" item="itemId" open="(" separator="," close=")">
				#{itemId}
			</foreach>
		</if>
		<if test="groupOrder.productBrandId != null and groupOrder.productBrandId != -1">
			and a.product_brand_id =#{groupOrder.productBrandId}
		</if>
		<if test="groupOrder.productName != null and groupOrder.productName !=''">
			and a.product_name LIKE
			CONCAT('%',#{groupOrder.productName},'%')
		</if>
		<if test="groupOrder.productBrandName != null and groupOrder.productBrandName !=''">
			and a.product_brand_name LIKE
			CONCAT('%',#{groupOrder.productBrandName},'%')
		</if>
		<if test="groupOrder.supplierName != null and groupOrder.supplierName !=''">
			and (a.supplier_name LIKE CONCAT('%','${groupOrder.supplierName}','%') or a.supplier_code LIKE CONCAT('%','${groupOrder.supplierName}','%') )
		</if>
		<if test="groupOrder.receiveMode != null and groupOrder.receiveMode !=''">
			and a.receive_mode LIKE
			CONCAT('%','${groupOrder.receiveMode}','%')
		</if>
		<if test="groupOrder.sourceTypeId != null and groupOrdersourceTypeId !=-1">
			and a.source_type_id=#{groupOrder.sourceTypeId}
		</if>
		<if test="groupOrder.provinceId != null and groupOrder.provinceId !=-1">
			and a.province_id =#{groupOrder.provinceId}
		</if>
		<if test="groupOrder.cityId != null and groupOrder.cityId !=-1">
			and a.city_id =#{groupOrder.cityId}
		</if>
		<if test="groupOrder.state ==1">
			and a.group_id is not null
		</if>
		<if test="groupOrder.state ==2">
			and a.group_id is null
		</if>
		<if test="groupOrder.orderLockState ==0">
			and a.order_lock_state=0
		</if>
		<if test="groupOrder.orderLockState ==1">
			and a.order_lock_state=1
		</if>
		<if test="groupOrder.groupCode !=null and groupOrder.groupCode !=''">
			and b.group_code LIKE
			CONCAT('%',trim(#{groupOrder.groupCode}),'%')
		</if>
		<if test="groupOrder.operType==1">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.sale_operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.operType==2">
			<if test="groupOrder.saleOperatorIds!=null and groupOrder.saleOperatorIds!=''">
				and a.operator_id in (${groupOrder.saleOperatorIds})
			</if>
		</if>
		<if test="groupOrder.orderBusiness!=null and groupOrder.orderBusiness!=''">
			and a.order_business =#{groupOrder.orderBusiness}
		</if>
		<if test="groupOrder.stateFinance ==0">
			AND (state_finance = 0 or state_finance is null)
		</if>
		<if test="groupOrder.stateFinance ==1">
			and a.state_finance=1
		</if>
		<if test="groupOrder.groupMode!=null and groupOrder.groupMode!=''">
			and b.group_mode =#{groupOrder.groupMode}
		</if>
		<if test="groupOrder.orderLockState!=null and groupOrder.orderLockState!=100 and groupOrder.orderLockState!=''">
			and a.order_lock_state=#{groupOrder.orderLockState}
		</if>
		<if test="groupOrder.orderLockState == 100">
			and a.order_lock_state in (1,2)
		</if>
		<if test="groupOrder.buyerNick != null and groupOrder.buyerNick != ''">
			and a.buyer_nick LIKE CONCAT('%',trim(#{groupOrder.buyerNick}),'%')
		</if>
		<if test="groupOrder.guestName != null and groupOrder.guestName != ''">
			and gg.`name` LIKE CONCAT('%',trim(#{groupOrder.guestName}),'%')
		</if>
		<if test="groupOrder.mobile != null and groupOrder.mobile != ''">
			and gg.`mobile` LIKE CONCAT('%',trim(#{groupOrder.mobile}),'%')
		</if>
		<if test="groupOrder.orderNo!=null and groupOrder.orderNo!=''">
			and a.order_mode<![CDATA[<>]]>0 and a.order_mode in (${groupOrder.orderNo})
		</if>
		<if test="groupOrder.type!=null">
			and a.type =#{groupOrder.type}
		</if>
		ORDER BY a.departure_date,a.create_time
	</select>
	
	<select id="selectInitOrderList" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from group_order t where t.order_type=-2 and t.biz_id=#{bizId} and
		t.group_id =#{groupId} and t.state!=-1
	</select>

	<select id="selectOrderByParameterListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT go.`supplier_name`,go.`supplier_id` FROM
		`group_order` go

		WHERE go.biz_id = #{bizId}
		and go.state=1
		and go.operator_id in
		<foreach collection="set" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and go.supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and go.sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
		<if test=" page.parameter.dateType==0">
			<if test="page.parameter.startTime != null">and
				go.departure_date  <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null">and
				go.departure_date<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType==1">
			<if test="page.parameter.startTime != null">and
				go.create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{page.parameter.startTime})*1000
			</if>
			<if test="page.parameter.endTime != null">and
				go.create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{page.parameter.endTime})*1000
			</if>
		</if>


		GROUP BY go.`supplier_id`
	</select>
	<select id="selectOrderByParameter2" resultMap="BaseResultMap" parameterType="java.util.HashMap">
		SELECT
		go.`sale_operator_id`,go.`sale_operator_name`,go.`product_brand_name`,ifnull(SUM(go.`num_adult`),0)
		num_adult,ifnull(SUM(go.`num_child`),0) num_child
		FROM `group_order` go
		WHERE go.state=1 and go.biz_id=#{parameter.bizId}
		and go.operator_id in
		<foreach collection="parameter.set" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="parameter.supplierId!=null">
			and go.`supplier_id`= #{parameter.supplierId}
		</if>
		<if test="parameter.saleOperatorIds!=null and parameter.saleOperatorIds!=''">
			and go.sale_operator_id in (${parameter.saleOperatorIds})
		</if>
		<if test=" parameter.dateType==0">
			<if test="parameter.startTime != null">and
				go.departure_date  <![CDATA[>=]]>
				#{parameter.startTime}
			</if>
			<if test="parameter.endTime != null">and
				go.departure_date<![CDATA[<=]]>
				#{parameter.endTime}
			</if>
		</if>
		<if test="parameter.dateType==1">
			<if test="parameter.startTime != null">and
				go.create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{parameter.startTime})*1000
			</if>
			<if test="parameter.endTime != null">and
				go.create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{parameter.endTime})*1000
			</if>
		</if>
		GROUP BY go.`product_brand_name`
		order by go.`sale_operator_name`
	</select>
	<!-- <select id="getDeservedCashGroupByOrderIdListPage" resultMap="BaseResultMap" parameterType="com.yihg.sales.po.GroupOrder"> SELECT tg.`group_code`,go.`product_brand_name`,go.`product_name`,go.`operator_id`,go.`operator_name`, go.`sale_operator_id`,go.`sale_operator_name`,go.`num_adult`,go.`num_child`,go.`num_guide`,go.`supplier_name`,go.`receive_mode`, guest.guestInfo,price.priceInfo,SUM(totalPrice) totalSum,IFNULL(got.pickUpInfo,'') pickUpInfo,IFNULL(got.transferInfo,'') transferInfo FROM `tour_group` 
		tg JOIN `group_order` go ON tg.`id`=go.`group_id` JOIN ( SELECT order_id,GROUP_CONCAT(DISTINCT CONCAT_WS('/',`name`,IF(gender=1,'女','男'),age,IFNULL(certificate_num,''),native_place)) guestInfo FROM `group_order_guest` GROUP BY order_id) guest ON go.`id`=guest.`order_id` JOIN (SELECT order_id,item_id,SUM(total_price) totalPrice,GROUP_CONCAT(DISTINCT CONCAT_WS( '/',item_name,unit_price,num_times,num_person,total_price)) priceInfo FROM `group_order_price` GROUP BY order_id) price ON go.`id`=price.`order_id` 
		JOIN (SELECT order_id, (CASE WHEN `type`=0 THEN GROUP_CONCAT(DISTINCT CONCAT(departure_city,'-',arrival_city,'/',class_no,'/',departure_time)) END) pickUpInfo, (CASE WHEN `type`=1 THEN GROUP_CONCAT(DISTINCT CONCAT(departure_city,'-',arrival_city,'/',class_no,'/',departure_time)) END ) transferInfo FROM `group_order_transport` where method=154 GROUP BY order_id) got ON go.`id`=got.`order_id` WHERE tg.`group_state` IN (1,3,4) AND tg.`biz_id`=#{page.parameter.bizId} <if test="set!=null"> AND tg.operator_id 
		in <foreach item="item" index="index" collection="set" open="(" separator="," close=")"> #{item} </foreach></if> <if test=" page.parameter.dateType==0"> <if test="page.parameter.startTime != null">and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime} </if> <if test="page.parameter.endTime != null">and tg.date_start<![CDATA[<=]]> #{page.parameter.endTime} </if> </if> <if test="page.parameter.dateType==1"> <if test="page.parameter.startTime != null">and go.create_time <![CDATA[>=]]> UNIX_TIMESTAMP(#{page.parameter.startTime})*1000 
		</if> <if test="page.parameter.endTime != null">and go.create_time<![CDATA[<=]]> UNIX_TIMESTAMP(#{page.parameter.endTime})*1000 </if> </if> <if test="page.parameter.groupMode == 0">and tg.group_mode <![CDATA[<]]> 1</if> <if test="page.parameter.groupMode !=0 and page.parameter.groupMode!=null">and tg.group_mode <![CDATA[>]]>0</if> <if test="page.parameter.productName != null and page.parameter.productName !=''"> and (go.product_brand_name LIKE CONCAT('%','${page.parameter.productBrandName}','%') 
		or go.product_name LIKE CONCAT('%','${page.parameter.productBrandName}','%')) </if> <if test="page.parameter.supplierName != null and page.parameter.supplierName !=''"> and go.supplier_name LIKE CONCAT('%','${page.parameter.supplierName}','%') </if> <if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''"> and go.receive_mode LIKE CONCAT('%','${page.parameter.receiveMode}','%') </if> <if test="page.parameter.groupCode != null">and tg.group_code LIKE CONCAT('%',trim(#{page.parameter.groupCode}),'%')</if> 
		<if test="page.parameter.operType==0 or page.parameter.operType==null "> <if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''"> and tg.operator_id in (${page.parameter.saleOperatorIds}) </if> </if> <if test="page.parameter.operType==1"> <if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''"> and go.sale_operaotor_id in (${page.parameter.saleOperatorIds}) </if> </if> <if test="page.parameter.provinceId!=null"> and go.province_id =#{page.parameter.provinceId} 
		</if> <if test="page.parameter.cityId!=null"> and go.city_id =#{page.parameter.cityId} </if> <if test="page.parameter.itemId!=null"> and price.item_id =#{page.parameter.itemId} </if> GROUP BY go.`id` </select> -->
	<select id="getDeservedCashGroupByOrderIdListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		SELECT
		tg.`group_code`,go.`product_brand_name`,go.`product_name`,go.`operator_id`,go.`operator_name`,tg.group_mode,go.id,
		go.`sale_operator_id`,go.`sale_operator_name`,IFNULL(go.`num_adult`,0)
		num_adult,IFNULL(go.`num_child`,0) num_child,IFNULL(go.`num_guide`,0)
		num_guide,go.`supplier_name`,go.`receive_mode`,
		IFNULL(got.pickUpInfo,'') pickUpInfo,IFNULL(got.transferInfo,'')
		transferInfo,SUM(totalPrice) totalSum,tg.id as groupId
		FROM `tour_group` tg JOIN `group_order` go ON tg.`id`=go.`group_id` JOIN
		(SELECT order_id,
		(CASE WHEN `type`=0 THEN GROUP_CONCAT(DISTINCT
		CONCAT(departure_city,'-',arrival_city,'/',class_no,'/',departure_time))
		END) pickUpInfo,
		(CASE WHEN `type`=1 THEN GROUP_CONCAT(DISTINCT
		CONCAT(departure_city,'-',arrival_city,'/',class_no,'/',departure_time))
		END ) transferInfo
		FROM `group_order_transport` where method=154 GROUP BY order_id) got ON
		go.`id`=got.`order_id` JOIN
		(SELECT order_id,item_id,SUM(total_price) totalPrice FROM `group_order_price`
		where 1=1
		<if test="page.parameter.itemId!=null">
			and item_id =#{page.parameter.itemId}
		</if>
		GROUP BY order_id)
		price ON go.`id`=price.`order_id`
		where tg.`group_state` IN (1,3,4) AND tg.`biz_id`=#{page.parameter.bizId}
		<if test="set!=null">
			AND tg.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test=" page.parameter.dateType==0">
			<if test="page.parameter.startTime != null">and
				tg.date_start  <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null">and
				tg.date_start<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType==1">
			<if test="page.parameter.startTime != null">and
				go.create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{page.parameter.startTime})*1000
			</if>
			<if test="page.parameter.endTime != null">and
				go.create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{page.parameter.endTime})*1000
			</if>
		</if>
		<if test="page.parameter.groupMode==0">and
			tg.group_mode <![CDATA[<]]>
			1
		</if>
		<if test="page.parameter.groupMode ==1">and
			tg.group_mode <![CDATA[>]]>0
		</if>

		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and (go.product_brand_name LIKE
			CONCAT('%',#{page.parameter.productName},'%')
			or go.product_name LIKE
			CONCAT('%',#{page.parameter.productName},'%'))
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and go.supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and
			REPLACE(receive_mode,' ','') LIKE REPLACE(CONCAT('%',#{page.parameter.receiveMode},'%'),'
			','')

		</if>
		<if test="page.parameter.groupCode != null and page.parameter.groupCode !=''">
			and tg.group_code LIKE CONCAT('%',#{page.parameter.groupCode},'%')
		</if>
		<if test="page.parameter.operType==0 or page.parameter.operType==null ">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and tg.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.sale_operaotor_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.provinceId!=null">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId!=null">
			and go.city_id =#{page.parameter.cityId}
		</if>

		GROUP BY go.`id`
	</select>
	<select id="getDeservedCashGroupByOrderIdTotal" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select SUM(numAdult) totalAdult,
		SUM(numChild) totalChild, SUM(numGuide) totalGuide,
		SUM(totalPrice) totalSum from (
		SELECT
		SUM(total_price) totalPrice,IFNULL(go.`num_adult`,0) numAdult,
		IFNULL(go.`num_child`,0) numChild,IFNULL(go.`num_guide`,0) numGuide
		FROM `tour_group` tg JOIN `group_order` go ON tg.`id`=go.`group_id` JOIN
		(SELECT order_id,item_id,SUM(total_price) total_price FROM `group_order_price`
		where 1=1
		<if test="page.parameter.itemId!=null">
			and item_id =#{page.parameter.itemId}
		</if>
		GROUP BY order_id)
		price ON go.`id`=price.`order_id`
		where tg.`group_state` IN (1,3,4) AND tg.`biz_id`=#{page.parameter.bizId}
		<if test="set!=null">
			AND tg.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test=" page.parameter.dateType==0">
			<if test="page.parameter.startTime != null">and
				tg.date_start  <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null">and
				tg.date_start<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType==1">
			<if test="page.parameter.startTime != null">and
				go.create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{page.parameter.startTime})*1000
			</if>
			<if test="page.parameter.endTime != null">and
				go.create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{page.parameter.endTime})*1000
			</if>
		</if>
		<if test="page.parameter.groupMode==0">and
			tg.group_mode <![CDATA[<]]>
			1
		</if>
		<if test="page.parameter.groupMode ==1">and
			tg.group_mode <![CDATA[>]]>0
		</if>

		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and (go.product_brand_name LIKE
			CONCAT('%',#{page.parameter.productName},'%')
			or go.product_name LIKE
			CONCAT('%',#{page.parameter.productName},'%'))
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName !=''">
			and go.supplier_name LIKE
			CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode !=''">
			and
			REPLACE(receive_mode,' ','') LIKE REPLACE(CONCAT('%',#{page.parameter.receiveMode},'%'),'
			','')

		</if>
		<if test="page.parameter.groupCode != null and page.parameter.groupCode !=''">
			and tg.group_code LIKE CONCAT('%',#{page.parameter.groupCode},'%')
		</if>
		<if test="page.parameter.operType==0 or page.parameter.operType==null ">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and tg.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.sale_operaotor_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.provinceId!=null">
			and go.province_id =#{page.parameter.provinceId}
		</if>
		<if test="page.parameter.cityId!=null">
			and go.city_id =#{page.parameter.cityId}
		</if>

		GROUP BY go.`id`) t
	</select>
	<select id="guestSourceStatics2" resultType="java.util.HashMap">
		SELECT ttt.provinceName,cast(ttt.guestCnt as signed)
		guestCnt,cast(ttt.adultCnt as signed) adultCnt,cast(ttt.childCnt as
		signed) childCnt,cast(ttt.guideCnt as signed) guideCnt
		FROM(
		SELECT
		tt.province_name AS
		provinceName,(SUM(IFNULL(tt.num_adult,0))+SUM(IFNULL(tt.num_child,0)))
		guestCnt,
		SUM(IFNULL(tt.num_adult,0)) adultCnt,SUM(IFNULL(tt.num_child,0))
		childCnt,SUM(IFNULL(tt.num_guide,0)) guideCnt
		FROM (
		SELECT (CASE WHEN
		go.province_name IS NULL THEN '未知' WHEN
		go.province_name='' THEN '未知'
		ELSE
		go.province_name END)
		province_name,go.num_adult,go.num_child,go.num_guide
		FROM tour_group tg
		join `group_order` go ON tg.`id`=go.`group_id`
		WHERE go.`state`=1 and
		tg.biz_id=#{parameter.bizId} and tg.group_state in (1,3,4)
		AND tg.operator_id IN
		<foreach item="item" index="index" collection="parameter.set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test=" parameter.dateType==0">
			<if test="parameter.startTime != null">and
				tg.date_start  <![CDATA[>=]]>
				#{parameter.startTime}
			</if>
			<if test="parameter.endTime != null">and
				tg.date_start<![CDATA[<=]]>
				#{parameter.endTime}
			</if>
		</if>
		<if test="parameter.dateType==1">
			<if test="parameter.startTime != null">and
				go.create_time  <![CDATA[>=]]>
				#{parameter.startTime}
			</if>
			<if test="parameter.endTime != null">and
				go.create_time<![CDATA[<=]]>
				#{parameter.endTime}
			</if>
		</if>
		<if test="parameter.productName != null and parameter.productName !=''">and
			(go.product_brand_name like concat( '%',#{parameter.productName},'%') or go.product_name
			like concat('%',#{parameter.productName},'%') )
		</if>
		<if test="parameter.supplierName != null and parameter.supplierName != ''">and
			go.supplier_name like concat( '%',#{parameter.supplierName},'%')
		</if>
		<if test="parameter.operType==0 ">
			<if test="parameter.saleOperatorIds!=null and parameter.saleOperatorIds!=''">
				and go.sale_operator_id in (${parameter.saleOperatorIds})
			</if>
		</if>
		<if test="parameter.operType==1">
			<if test="parameter.saleOperatorIds!=null and parameter.saleOperatorIds!=''">
				and tg.operator_id in (${parameter.saleOperatorIds})
			</if>
		</if>
		)tt
		GROUP BY tt.`province_name`
		) ttt
		ORDER BY ttt.guestCnt DESC

	</select>
	<select id="departmentOrderStatistics" resultType="com.yimayhd.erpcenter.dal.sales.client.query.vo.DepartmentOrderResult">
		SELECT SUM(go.`num_adult`) numAdult,SUM(go.`num_child`)
		numChild,DATE_FORMAT(FROM_UNIXTIME(go.`create_time`/1000,'%Y-%m-%d'),'%Y-%m-%d')
		createDate,
		go.create_time createTime,go.`departure_date` departureDate,go.`operator_id`
		operatorId,go.`operator_name` operatorName,
		COUNT(CASE WHEN go.`type`=1
		THEN go.id WHEN go.`type` IS NULL THEN go.id END)
		affirmOrderCount,COUNT(CASE WHEN go.`type`=0 THEN go.id END )
		reserveOrderCount
		FROM `group_order` go
		WHERE go.`biz_id`=#{condition.bizId} AND go.`state`=1 AND
		order_type IN
		(-1,0,1)
		AND go.operator_id IN
		<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="condition.dateType==0">
			<if test="condition.startTime!=null">
				AND go.`create_time`<![CDATA[>=]]>#{condition.startTimeNum}
			</if>
			<if test="condition.endTime!=null">
				AND go.`create_time`<![CDATA[<=]]>#{condition.endTimeNum}
			</if>
		</if>
		<if test="condition.dateType==1">
			<if test="condition.startTime!=null">
				AND go.`departure_date`<![CDATA[>=]]>#{condition.startTime}
			</if>
			<if test="condition.endTime!=null">
				AND go.`departure_date`<![CDATA[<=]]>#{condition.endTime}
			</if>
		</if>
		<if test="condition.supplierName != null and condition.supplierName != ''">and
			go.supplier_name like concat( '%',#{condition.supplierName},'%')
		</if>

		<if test="condition.operatorIds!=null and condition.operatorIds!=''">
			and go.operator_id in (${condition.operatorIds})
		</if>
		<if test="condition.productName != null and condition.productName !=''">and
			(go.product_brand_name like concat( '%',#{condition.productName},'%') or go.product_name
			like concat('%',#{condition.productName},'%') )
		</if>
		GROUP BY go.`operator_id`
		<if test="condition.dateType==0">
			,FROM_UNIXTIME(go.`create_time`/1000,'%Y-%m-%d ')
		</if>
		<if test="condition.dateType==1">
			, go.`departure_date`
		</if>

	</select>
	<select id="selectReserveOrderList" resultMap="BaseResultMap">
		SELECT
		<include refid="Base_Column_List" />
		FROM group_order t WHERE t.state!=-1
		AND t.type=0 AND t.group_id IS
		NULL AND t.order_type=0
	</select>
	<!-- 爱游 -->
	<select id="selectAiYouOrders" resultMap="BaseResultMap">
		SELECT
		<include refid="Base_Column_List" />
		<![CDATA[FROM group_order t WHERE
		t.biz_id=#{bizId}
		and t.departure_date>=#{startTime}
		and t.departure_date<=#{endTime}
		and t.state!=-1
		AND t.aiyou_group_id is not null 
		]]>
	</select>
	<select id="selectTopAiYouOrders">
		SELECT
		<include refid="Base_Column_List" />
		FROM group_order t WHERE
		t.biz_id=#{bizId}
		AND t.state!=-1
		AND t.departure_date=#{startTime}
		AND t.aiyou_group_id is not null
		order by t.create_time desc
		<if test="limit!=null">
			limit #{limit}
		</if>

	</select>
	<!-- -->
	<select id="getCountByProductIdAndDate" resultType="java.util.HashMap">
		SELECT SUM(IFNULL(num_adult,0)) totalAdult,SUM(IFNULL(num_child,0)) totalChild,SUM(IFNULL(num_guide,0)) totalGuide
		FROM group_order
		WHERE biz_id=#{bizId,jdbcType=INTEGER} AND state=1 AND product_id=#{productId,jdbcType=INTEGER} AND departure_date=#{date,jdbcType=DATE}
	</select>

	<select id="selectIncomeOrderTotalCash" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT s.id, s.total, IFNULL(SUM(pd.cash),0) total_cash FROM group_order s
		LEFT JOIN finance_pay_detail pd ON s.id = pd.loc_order_id
		LEFT JOIN finance_pay p ON p.id = pd.pay_id
		WHERE p.TYPE = 0 AND p.supplier_type = 1 AND s.id = #{groupOrderId,jdbcType=INTEGER}
	</select>

	<select id="selectIdList" resultMap="BaseResultMap">
		SELECT id FROM group_order WHERE 1=1
		<if test="supplierId != null">
			and supplier_id = #{supplierId,jdbcType=INTEGER}
		</if>
		ORDER BY id ASC
	</select>

	<select id="existgroupOrder" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM group_order WHERE supplier_id = #{supplierId,jdbcType=INTEGER};
	</select>

		<!-- 操作单 更新orderLockState -->
	<update id="updateOrderLockState">
		UPDATE group_order
		SET order_lock_state=1
		 WHERE id = #{orderId,jdbcType=INTEGER}
	</update>
	
		<!-- 操作单 更新orderLockState -->
	<update id="updateOrderLockStateByOp">
		UPDATE group_order
		SET order_lock_state=2
		 WHERE id = #{orderId,jdbcType=INTEGER}
	</update>
	
	<update id="updateLockStateToFinance">
		UPDATE group_order
		SET order_lock_state=3
		 WHERE id = #{orderId,jdbcType=INTEGER}
	</update>
	
		<update id="goBackOrderLockStateByOp">
		UPDATE group_order
		SET order_lock_state=0
		 WHERE id = #{orderId,jdbcType=INTEGER}
	</update>
	<!-- B2B 开始 -->
	<!-- B2B查询销售订单信息 -->
	<select id="selectGroupOrderListToB2B" resultType="java.util.HashMap">
		SELECT
		gro.id,
		tg.group_code,
		gro.departure_date,
		concat('【',gro.product_brand_name,'】',gro.product_name) AS product_name,
		gro.supplier_name,
		gro.receive_mode,
		gro.num_adult,
		gro.num_child,
		gro.total,
		gro.sale_operator_name,
		gro.operator_name,
		gro.b2b_export_state
		FROM group_order AS gro
		LEFT JOIN tour_group AS tg ON(gro.group_id=tg.id)
		WHERE gro.state = 1 AND tg.group_state IN (1,3,4)
		AND gro.departure_date<![CDATA[>=]]>#{dateStart}
		AND gro.departure_date<![CDATA[<=]]>#{dateEnd}
		AND gro.supplier_name LIKE concat('%',#{clientName,jdbcType=VARCHAR},'%')
		AND gro.biz_id=#{bizId}
		AND tg.group_code NOT LIKE CONCAT('%','变更','%')
		AND gro.b2b_export_state=#{exports}
		ORDER BY gro.departure_date ASC,gro.create_time ASC
	</select>
	<!-- B2B 更新导出订单状态 -->
	<update id="updateB2bExportState">
		UPDATE group_order
		SET b2b_export_state=1 WHERE id
		IN (${ids})
	</update>

	<!-- B2B根据订单ids查询销售订单信息 -->
	<select id="selectGroupOrderDetailByIds" resultMap="BaseResultMap">
		SELECT
		gro.id,
		gro.supplier_id,
		gro.supplier_name,
		gro.contact_name,
		gro.contact_mobile,
		gro.contact_fax,
		gro.contact_tel,
		gro.operator_id,
		gro.operator_name,
		gro.sale_operator_id,
		gro.sale_operator_name,
		gro.num_adult,
		gro.num_child,
		gro.departure_date,
		ifnull(gro.product_id,0) AS product_id,
		ifnull(gro.product_brand_id,0) AS product_brand_id,
		gro.product_brand_name,
		gro.product_name,
		gro.receive_mode,
		ifnull(gro.remark,'') AS remark,
		gro.total,
		gro.total_cash,
		gro.b2b_export_state
		FROM group_order AS gro
		WHERE gro.id IN (${ids})
		ORDER BY gro.id
	</select>
	<!-- B2B 结束 -->

	<!-- 产品收客人数查询 -->
	<select id="selectProductTrendListPageInnerLayer" parameterType="java.util.HashMap" resultMap="BaseResultMap">
		select go.product_brand_id,go.product_brand_name,go.product_id,go.product_name,go.departure_date,sum(num_adult+num_child) as person
		from group_order go left join tour_group tg on (go.group_id=tg.id and tg.group_state in (1,3,4))
		where go.state=1 and go.biz_id=1

		<if test="parameter.set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="parameter.set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- 日期 -->
		<if test="parameter.startTime != null and parameter.startTime!=''">and
			departure_date <![CDATA[>=]]>
			#{parameter.startTime}
		</if>
		<if test="parameter.endTime != null and parameter.endTime!=''">and
			departure_date<![CDATA[<=]]>
			#{parameter.endTime}
		</if>

		<!-- 品牌 -->
		<if test="parameter.productBrandId != null and parameter.productBrandId != '' ">
			and go.product_brand_id = #{parameter.productBrandId}
		</if>
		<!-- 产品名称 -->
		<if test="parameter.productName != null and parameter.productName != '' ">
			and go.product_name LIKE CONCAT('%',#{parameter.productName},'%')
		</if>
		<!-- 团类型 -->
		<if test="parameter.groupMode!=null and parameter.groupMode!=''">
			<if test="parameter.groupMode == 1">and
				go.order_type <![CDATA[ = ]]>1
			</if>
			<if test="parameter.groupMode == 0">and
				go.order_type <![CDATA[ != ]]>1
			</if>
		</if>
		<!-- 部门 -->
		<if test="parameter.orgIds != null and parameter.orgIds != ''">
			and go.operator_id in (${parameter.orgIds})
		</if>
		<!-- 销售 -->
		<if test="parameter.saleOperatorIds != null and parameter.saleOperatorIds != ''">
			and go.sale_operator_id in (${parameter.saleOperatorIds})
		</if>
		group by go.product_brand_id,go.product_brand_name,go.product_id,go.product_name,go.departure_date
		having sum(num_adult+num_child) >0
		ORDER BY go.departure_date
	</select>

	<select id="selectProductTrendListPageOutLayer" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		select go.product_brand_id,go.product_brand_name,go.product_id,go.product_name
		from group_order go left join tour_group tg on (go.group_id=tg.id and tg.group_state in (1,3,4))
		where go.state=1 and go.biz_id=1

		<if test="parameter.set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="parameter.set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- 日期 -->
		<if test="parameter.startTime != null and parameter.startTime!=''">and
			departure_date <![CDATA[>=]]>
			#{parameter.startTime}
		</if>
		<if test="parameter.endTime != null and parameter.endTime!=''">and
			departure_date<![CDATA[<=]]>
			#{parameter.endTime}
		</if>

		<!-- 品牌 -->
		<if test="parameter.productBrandId != null and parameter.productBrandId != '' ">
			and go.product_brand_id = #{parameter.productBrandId}
		</if>
		<!-- 产品名称 -->
		<if test="parameter.productName != null and parameter.productName != '' ">
			and go.product_name LIKE CONCAT('%',#{parameter.productName},'%')
		</if>
		<!-- 团类型 -->
		<if test="parameter.groupMode!=null and parameter.groupMode!=''">
			<if test="parameter.groupMode == 1">and
				go.order_type <![CDATA[ = ]]>1
			</if>
			<if test="parameter.groupMode == 0">and
				go.order_type <![CDATA[ != ]]>1
			</if>
		</if>
		<!-- 部门 -->
		<if test="parameter.orgIds != null and parameter.orgIds != ''">
			and go.operator_id in (${parameter.orgIds})
		</if>
		<!-- 销售 -->
		<if test="parameter.saleOperatorIds != null and parameter.saleOperatorIds != ''">
			and go.sale_operator_id in (${parameter.saleOperatorIds})
		</if>

		<!-- <if test="parameter.orgIds != null and parameter.orgIds != ''"> and go.operator_id in (${parameter.orgIds}) </if> -->
		group by go.product_brand_id,go.product_brand_name,go.product_id,go.product_name
	</select>

	<select id="selectGroupOrderById" resultMap="BaseResultMap">
		SELECT * FROM group_order WHERE id=${orderId}
	</select>

	<!-- 资源订单查询 -->
	<select id="findResOrderListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		id, biz_id, group_id, supplier_id,supplier_name,order_business,
		order_no,order_no_sort,order_type,type,contract_no,guest_source_id,guest_source_name,
		supplier_code,total,total_cash,
		contact_name,
		contact_tel,
		contact_mobile, contact_fax,
		operator_id,
		operator_name,
		sale_operator_id,
		sale_operator_name,price_id,
		num_adult,num_child,num_guide,
		num_child_baby,
		departure_date, product_id,
		product_brand_id,
		product_brand_name,
		product_name,
		product_short_name,receive_mode,
		service_standard,
		remark,
		remark_internal,
		creator_id,
		creator_name,
		create_time,state,state_finance,audit_user,audit_user_id,audit_time,source_type_id,source_type_name,province_id,province_name,city_id,city_name,order_lock_state,aiyou_group_id,
		ext_res_id,ext_res_state,ext_res_clean_time,ext_res_clean_stock,ext_res_prepay,ext_res_confirm_id,ext_res_confirm_name,
		FROM_UNIXTIME((create_time + (ext_res_clean_time*60*1000)) /1000 ) as limitTime
		from group_order
		where ext_res_id <![CDATA[> ]]>0
		and state !=-1
		and biz_id =#{page.parameter.bizId,jdbcType=INTEGER}
		<if test="set!=null">
			AND creator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- <if test="page.parameter.startTime != null and page.parameter.startTime!='' "> and departure_date <![CDATA[>= ]]>#{page.parameter.startTime} </if> <if test="page.parameter.endTime!= null and page.parameter.endTime!='' "> and departure_date <![CDATA[<= ]]>#{page.parameter.endTime} </if> -->
		<if test="page.parameter.dateType==1">
			<if test="page.parameter.startTime != null">and
				departure_date  <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null">and
				departure_date<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType==2">
			<if test="page.parameter.startTime != null">and
				create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{page.parameter.startTime})*1000
			</if>
			<if test="page.parameter.endTime != null">and
				create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{page.parameter.endTime})*1000
			</if>
		</if>
		<!-- 判断尾款时限 -->
		<if test="page.parameter.extHour != null and page.parameter.extHour!=''">
			<!-- and ((UNIX_TIMESTAMP(now())-UNIX_TIMESTAMP(ext_res_clean_time)) / 3600) BETWEEN 0 and #{page.parameter.extHour} -->
			and ((create_time + ext_res_clean_time*60*1000)/1000) - UNIX_TIMESTAMP(now())  BETWEEN 0 and #{page.parameter.extHour}*60
		</if>
		<if test="page.parameter.saleOperatorName != null and page.parameter.saleOperatorName!=''">
			and creator_name LIKE CONCAT('%',#{page.parameter.saleOperatorName},'%' )
		</if>
		<if test="page.parameter.orderId != null and page.parameter.orderId!=''">
			and order_no = #{page.parameter.orderId}
		</if>
		<!-- <if test="page.parameter.productBrandId != null"> and product_brand_id =#{page.parameter.productBrandId,jdbcType=INTEGER} </if> -->
		<if test="page.parameter.productName != null and page.parameter.productName!=''">
			and product_name LIKE CONCAT('%',#{page.parameter.productName},'%' )
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode!=''">
			and receive_mode LIKE CONCAT('%',#{page.parameter.receiveMode},'%' )
		</if>
		<if test="page.parameter.type!=null and page.parameter.type!=''">
			and type =#{page.parameter.type}
		</if>
		<if test="page.parameter.extResState!=null and page.parameter.extResState!=''">
			and ext_res_state =#{page.parameter.extResState}
		</if>
		<!-- 收款状态 -->
		<if test="page.parameter.gatherState!=null and page.parameter.gatherState!=''">
			<if test="page.parameter.gatherState==0">
				and total-total_cash=0
			</if>
			<if test="page.parameter.gatherState==1">
				and total-total_cash!=0
			</if>
		</if>
		order by departure_date,create_time
	</select>

	<update id="updateResOrderState" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		update group_order
		<set>
			<if test="remarkInternal != null">
				remark_internal = #{remarkInternal,jdbcType=VARCHAR},
			</if>
			<if test="extResState != null">
				ext_res_state=#{extResState,jdbcType=INTEGER},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="sumGroupOrder" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		sum(num_adult) as numAdult,
		sum(num_child) as numChild,
		sum(num_child_baby) as numChildBaby,
		sum(total) total, sum(total_cash) totalCash,
		sum(ext_res_prepay) as extResPrepay
		from group_order
		where ext_res_id <![CDATA[> ]]>0
		and state !=-1
		and biz_id =#{parameter.bizId,jdbcType=INTEGER}
		<if test="parameter.set!=null">
			AND creator_id in
			<foreach item="item" index="index" collection="parameter.set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="parameter.dateType==1">
			<if test="parameter.startTime != null">and
				departure_date  <![CDATA[>=]]>
				#{parameter.startTime}
			</if>
			<if test="parameter.endTime != null">and
				departure_date<![CDATA[<=]]>
				#{parameter.endTime}
			</if>
		</if>
		<if test="parameter.dateType==2">
			<if test="parameter.startTime != null">and
				create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{parameter.startTime})*1000
			</if>
			<if test="parameter.endTime != null">and
				create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{parameter.endTime})*1000
			</if>
		</if>

		<if test="parameter.saleOperatorName != null and parameter.saleOperatorName!=''">
			and sale_operator_name LIKE CONCAT('%',#{parameter.saleOperatorName},'%' )
		</if>
		<!-- 判断尾款时限 -->
		<if test="parameter.extHour != null and parameter.extHour!=''">
			<!-- and (UNIX_TIMESTAMP(now())-UNIX_TIMESTAMP(ext_res_clean_time)) / 3600 BETWEEN 0 and #{parameter.extHour} -->
			and ext_res_clean_time BETWEEN 0 and #{parameter.extHour}
		</if>
		<!-- <if test="parameter.productBrandId != null"> and product_brand_id =#{parameter.productBrandId,jdbcType=INTEGER} </if> -->
		<if test="parameter.orderId != null and parameter.orderId!=''">
			and order_no = #{parameter.orderId}
		</if>
		<if test="parameter.productName != null and parameter.productName!=''">
			and product_name LIKE CONCAT('%',#{parameter.productName},'%' )
		</if>
		<if test="parameter.receiveMode != null and parameter.receiveMode!=''">
			and receive_mode LIKE CONCAT('%',#{parameter.receiveMode},'%' )
		</if>
		<if test="parameter.type!=null and parameter.type!=''">
			and type =#{parameter.type}
		</if>
		<if test="parameter.extResState!=null and parameter.extResState!=''">
			and ext_res_state =#{parameter.extResState}
		</if>
		<!-- 收款状态 -->
		<if test="parameter.gatherState!=null and parameter.gatherState!=''">
			<if test="parameter.gatherState==0">
				and total-total_cash=0
			</if>
			<if test="parameter.gatherState==1">
				and total-total_cash!=0
			</if>
		</if>
		order by departure_date,create_time
	</select>

	<select id="findResAdminOrderListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		id, biz_id, group_id, supplier_id,supplier_name,order_business,
		order_no,order_no_sort,order_type,type,contract_no,guest_source_id,guest_source_name,
		supplier_code,total,total_cash,
		contact_name,
		contact_tel,
		contact_mobile, contact_fax,
		operator_id,
		operator_name,
		sale_operator_id,
		sale_operator_name,price_id,
		num_adult,num_child,num_guide,
		num_child_baby,
		departure_date, product_id,
		product_brand_id,
		product_brand_name,
		product_name,
		product_short_name,receive_mode,
		service_standard,
		remark,
		remark_internal,
		creator_id,
		creator_name,
		create_time,state,state_finance,audit_user,audit_user_id,audit_time,source_type_id,source_type_name,province_id,province_name,city_id,city_name,order_lock_state,aiyou_group_id,
		ext_res_id,ext_res_state,ext_res_clean_time,ext_res_clean_stock,ext_res_prepay,ext_res_confirm_id,ext_res_confirm_name,
		FROM_UNIXTIME((create_time + (ext_res_clean_time*60*1000)) /1000 ) as limitTime

		from group_order
		where ext_res_id <![CDATA[> ]]>0
		and state !=-1
		and biz_id =#{page.parameter.bizId,jdbcType=INTEGER}
		<if test="set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<!-- <if test="page.parameter.startTime != null and page.parameter.startTime!='' "> and departure_date <![CDATA[>= ]]>#{page.parameter.startTime} </if> <if test="page.parameter.endTime!= null and page.parameter.endTime!='' "> and departure_date <![CDATA[<= ]]>#{page.parameter.endTime} </if> -->
		<if test="page.parameter.dateType==1">
			<if test="page.parameter.startTime != null">and
				departure_date  <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null">and
				departure_date<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType==2">
			<if test="page.parameter.startTime != null">
				and FROM_UNIXTIME(create_time/1000) <![CDATA[>=]]> #{page.parameter.startTime}

			</if>
			<if test="page.parameter.endTime != null">and
				FROM_UNIXTIME(create_time/1000) <![CDATA[<=]]> #{page.parameter.endTime}
			</if>
		</if>
		<!-- 判断尾款时限 -->
		<if test="page.parameter.extHour != null and page.parameter.extHour!=''">
			<!-- 到期时间戳 - 当前时间戳-->
			and ((create_time + ext_res_clean_time*60*1000)/1000) - UNIX_TIMESTAMP(now())  BETWEEN 0 and #{page.parameter.extHour}*60
		</if>
		<if test="page.parameter.saleOperatorName != null and page.parameter.saleOperatorName!=''">
			and sale_operator_name LIKE CONCAT('%',#{page.parameter.saleOperatorName},'%' )
		</if>
		<if test="page.parameter.orderId != null and page.parameter.orderId!=''">
			and order_no = #{page.parameter.orderId}
		</if>
		<!-- <if test="page.parameter.productBrandId != null"> and product_brand_id =#{page.parameter.productBrandId,jdbcType=INTEGER} </if> -->
		<if test="page.parameter.productName != null and page.parameter.productName!=''">
			and product_name LIKE CONCAT('%',#{page.parameter.productName},'%' )
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName!=''">
			and supplier_name LIKE CONCAT('%',#{page.parameter.supplierName},'%' )
		</if>
		<if test="page.parameter.receiveMode != null and page.parameter.receiveMode!=''">
			and receive_mode LIKE CONCAT('%',#{page.parameter.receiveMode},'%' )
		</if>
		<if test="page.parameter.type!=null and page.parameter.type!=''">
			and type =#{page.parameter.type}
		</if>
		<if test="page.parameter.extResState!=null and page.parameter.extResState!=''">
			and ext_res_state =#{page.parameter.extResState}
		</if>
		<!-- 收款状态 -->
		<if test="page.parameter.gatherState!=null and page.parameter.gatherState!=''">
			<if test="page.parameter.gatherState==0">
				and total-total_cash=0
			</if>
			<if test="page.parameter.gatherState==1">
				and total-total_cash!=0
			</if>
		</if>
		order by departure_date,create_time
	</select>

	<update id="updateResAdminOrderState" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		update group_order
		<set>
			<if test="remarkInternal != null">
				remark_internal = #{remarkInternal,jdbcType=VARCHAR},
			</if>
			<if test="extResState != null">
				ext_res_state=#{extResState,jdbcType=INTEGER},
			</if>
			<!-- <if test="state != null"> state=#{state,jdbcType=INTEGER}, </if> -->
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="sumResAdminOrder" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select
		sum(num_adult) as numAdult,
		sum(num_child) as numChild,
		sum(num_child_baby) as numChildBaby,
		sum(total) total, sum(total_cash) totalCash,
		sum(ext_res_prepay) as extResPrepay
		from group_order
		where ext_res_id <![CDATA[> ]]>0
		and state !=-1
		and biz_id =#{parameter.bizId,jdbcType=INTEGER}
		<if test="parameter.set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="parameter.set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="parameter.dateType==1">
			<if test="parameter.startTime != null">and
				departure_date  <![CDATA[>=]]>
				#{parameter.startTime}
			</if>
			<if test="parameter.endTime != null">and
				departure_date<![CDATA[<=]]>
				#{parameter.endTime}
			</if>
		</if>
		<if test="parameter.dateType==2">
			<if test="parameter.startTime != null">and
				create_time  <![CDATA[>=]]>
				UNIX_TIMESTAMP(#{parameter.startTime})*1000
			</if>
			<if test="parameter.endTime != null">and
				create_time<![CDATA[<=]]>
				UNIX_TIMESTAMP(#{parameter.endTime})*1000
			</if>
		</if>

		<if test="parameter.saleOperatorName != null and parameter.saleOperatorName!=''">
			and sale_operator_name LIKE CONCAT('%',#{parameter.saleOperatorName},'%' )
		</if>
		<!-- 判断尾款时限 -->
		<if test="parameter.extHour != null and parameter.extHour!=''">
			<!-- and ((UNIX_TIMESTAMP(now())-UNIX_TIMESTAMP(ext_res_clean_time)) / 3600) BETWEEN 0 and #{parameter.extHour} -->
			and ext_res_clean_time BETWEEN 0 and #{parameter.extHour}
		</if>
		<!-- <if test="parameter.productBrandId != null"> and product_brand_id =#{parameter.productBrandId,jdbcType=INTEGER} </if> -->
		<if test="parameter.orderId != null and parameter.orderId!=''">
			and order_no = #{parameter.orderId}
		</if>
		<if test="parameter.productName != null and parameter.productName!=''">
			and product_name LIKE CONCAT('%',#{parameter.productName},'%' )
		</if>
		<if test="parameter.supplierName != null and parameter.supplierName!=''">
			and supplier_name LIKE CONCAT('%',#{parameter.supplierName},'%' )
		</if>
		<if test="parameter.receiveMode != null and parameter.receiveMode!=''">
			and receive_mode LIKE CONCAT('%',#{parameter.receiveMode},'%' )
		</if>
		<if test="parameter.type!=null and parameter.type!=''">
			and type =#{parameter.type}
		</if>
		<if test="parameter.extResState!=null and parameter.extResState!=''">
			and ext_res_state =#{parameter.extResState}
		</if>
		<!-- 收款状态 -->
		<if test="parameter.gatherState!=null and parameter.gatherState!=''">
			<if test="parameter.gatherState==0">
				and total-total_cash=0
			</if>
			<if test="parameter.gatherState==1">
				and total-total_cash!=0
			</if>
		</if>
		order by departure_date,create_time
	</select>

	<update id="updateExtResState" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		update group_order
		<set>
			<if test="extResState != null">
				ext_res_state=#{extResState,jdbcType=INTEGER},
			</if>
			<if test="extResConfirmId != null">
				ext_res_confirm_id=#{extResConfirmId,jdbcType=INTEGER},
			</if>
			<if test="extResConfirmName != null and extResConfirmName != ''">
				ext_res_confirm_name=#{extResConfirmName,jdbcType=INTEGER},
			</if>
			<if test="state != null">
				state=#{state,jdbcType=INTEGER}
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>

	<delete id="delGroupOrderId" parameterType="java.lang.Integer">
		update group_order set
		state = -1
		where id = #{id,jdbcType=INTEGER}
	</delete>

	<select id="selectSumPersonByProductId" resultType="java.lang.Integer">
		select ifnull(sum(num_adult+num_child+num_guide),0) sumPerson
		from group_order where ext_res_state in(0,1) AND ext_res_id=#{resId,jdbcType=INTEGER} AND product_id=#{productId,jdbcType=INTEGER} and departure_date=#{departureDate,jdbcType=VARCHAR}
	</select>

	<select id="selectOrderOverTime" resultMap="BaseResultMap">
		SELECT id, biz_id, group_id,state,ext_res_id,ext_res_state,ext_res_clean_time,ext_res_clean_stock,ext_res_prepay,ext_res_confirm_id,ext_res_confirm_name
		from group_order
		where ext_res_id<![CDATA[> ]]>0 and ext_res_state=0
		and now() <![CDATA[> ]]> DATE_ADD(FROM_UNIXTIME(create_time/1000),INTERVAL ext_res_clean_time MINUTE)
			and ext_res_clean_time is not null and ext_res_clean_time>0
			and total_cash=0
	</select>

	<select id="selectByTimeListPage" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		SELECT
		*
		FROM group_order
		WHERE push_order_id>0
		AND biz_id=#{bizId}
		<if test="page.parameter.dateType == 1">
			<if test="page.parameter.startTime !=null and page.parameter.startTime !=''">
				AND departure_date <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime !=null and page.parameter.endTime !=''">
				AND departure_date <![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType == 2">
			<if test="page.parameter.startTime !=null and page.parameter.startTime !=''">
				AND create_time <![CDATA[>=]]>
				#{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime !=null and page.parameter.endTime !=''">
				AND create_time<![CDATA[<=]]>
				#{page.parameter.endTime}
			</if>
		</if>
	</select>

	<select id="selectByPushOrderId" resultMap="BaseResultMap">
		SELECT
		*
		FROM group_order
		WHERE push_order_id=#{pushOrderId, jdbcType=INTEGER}
	</select>
	
	<select id="selectBySaleOperatorId" resultMap="BaseResultMap">
		<!-- select go.id,go.biz_id,go.group_id,go.order_no_sort,go.order_no,go.departure_date,go.state,go.create_time,
			go.supplier_id,go.supplier_name,go.province_id,go.province_name,go.city_id,go.city_name,go.order_type,
			go.operator_id,go.operator_name,go.sale_operator_id,go.sale_operator_name,go.num_adult,go.num_child,go.total,
			go.total_cash,go.product_brand_id,go.product_brand_name,go.product_id,go.product_name,go.type -->
		select go.sale_operator_id,go.sale_operator_name, go.product_brand_name,go.product_id,go.product_name
			,sum(go.num_adult)num_adult,sum(go.num_child)num_child,sum(go.total)total,sum(go.total_cash)total_cash
				
		from group_order  go
		WHERE go.biz_id=#{bizId} AND go.state=1 
		<if test="set!=null">
			AND go.operator_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
    	<if test="condition.dateType==0">
			<if test="condition.startTime!=null">
				AND FROM_UNIXTIME(go.create_time / 1000) <![CDATA[>=]]>#{condition.startTime}
			</if>
			<if test="condition.endTime!=null">
				AND FROM_UNIXTIME(go.create_time / 1000) <![CDATA[<=]]>#{condition.endTime}
			</if>
		</if>
		<if test="condition.dateType==1">
			<if test="condition.startTime!=null">
				AND go.departure_date<![CDATA[>=]]>#{condition.startTime}
			</if>
			<if test="condition.endTime!=null">
				AND go.departure_date<![CDATA[<=]]>#{condition.endTime}
			</if>
		</if>
		
		<if test="condition.supplierName != null and condition.supplierName != ''">
			and go.supplier_name like concat( '%',#{condition.supplierName},'%')
		</if>
		<if test="condition.saleOperatorIds!=null and condition.saleOperatorIds!=''">
				and go.sale_operator_id in (${condition.saleOperatorIds})
		</if>
		<if test="condition.productName != null and condition.productName !=''">
			and (go.product_brand_name like concat( '%',#{condition.productName},'%') or go.product_name
			like concat('%',#{condition.productName},'%') )
		</if>
		GROUP BY go.sale_operator_id,go.`product_id`
		ORDER BY go.sale_operator_id
	</select>
	
	<update id="updateExtVisa" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrder">
		update group_order
		<set>
			<if test="extVisaInfo != null">
				ext_visa_info = #{extVisaInfo,jdbcType=VARCHAR},
			</if>
			<if test="orderMode != null">
				order_mode = #{orderMode,jdbcType=VARCHAR}
			</if>
			
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	
	<select id="selectgroupIdByAY" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		select tg.id as group_id,tg.group_code,tg.date_start,tg.product_name,receive_mode,order_mode,
		1 as supplier_type,supplier_name,'' as departure_place,num_adult,num_child,sale_operator_name,
		total ,total_cash,total-total_cash as total_balance,
		0 as cost, 0 as cost_cash,0 as cost_balance
		 from group_order go join tour_group tg on (go.group_id=tg.id)
		where tg.group_state in (1,3,4) and tg.biz_id=#{bizId,jdbcType=INTEGER} and go.state !=-1
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.supplierName!=null">
			and supplier_name like concat('%',#{page.parameter.supplierName},'%') 
		</if>
		<if test="page.parameter.groupMode == 1 ">
			and tg.group_mode <![CDATA[>]]> 0
		</if>
		<if test="page.parameter.productName!=null">
			and tg.product_name like concat('%',#{page.parameter.productName},'%') 
		</if>
		<if test="page.parameter.dateType == 1">
			<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
				and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
				and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
			</if>
		</if>
		<if test="page.parameter.dateType == 2">
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and tg.date_end <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and tg.date_end <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		</if>
	<if test="page.parameter.operType==1">
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and go.operator_id in (${page.parameter.saleOperatorIds})
		</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds!=''">
			and go.operator_id in (${page.parameter.operatorIds})
		</if>
		</if>
			<if test="page.parameter.operType==2">
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds!=''">
			and sale_operator_id in (${page.parameter.operatorIds})
		</if>
		</if>
			<if test="page.parameter.groupCode!=null">
			and tg.group_code like concat('%',#{page.parameter.groupCode},'%') 
		</if>
			<if test="page.parameter.receiveMode!=null">
			and receive_mode like concat('%',#{page.parameter.receiveMode},'%') 
		</if>
	</select>
		<select id="selectMonthlyReportStatisticsListPage" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
			select * from (
			select tg.id as group_id,tg.group_code,tg.date_start,tg.date_end,tg.product_brand_name,tg.product_name,receive_mode,order_mode,
			1 as supplier_type,supplier_name as businessName,'' as supplier_name, '' as
			departure_place,num_adult,num_child,sale_operator_name,go.operator_name,
			total ,total_cash,total-total_cash as total_balance,
			0 as cost, 0 as cost_cash,0 as cost_balance,tg.total_income - tg.total_cost as group_cost,
			0 as other_total ,0 as other_total_cash,0 as other_total_balance
			from group_order go join tour_group tg on (go.group_id=tg.id)
			where tg.group_state in (1,3,4) and tg.biz_id=#{bizId,jdbcType=INTEGER} and go.state !=-1
			<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
				and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
			</if>
			<if test="page.parameter.supplierName!=null">
				and supplier_name like concat('%',#{page.parameter.supplierName},'%')
			</if>
			<if test="page.parameter.groupMode == 1 ">
				and tg.group_mode <![CDATA[>]]> 0
			</if>
			<if test="page.parameter.productName!=null">
				and tg.product_name like concat('%',#{page.parameter.productName},'%')
			</if>
			<if test="page.parameter.productBrandName!=null">
				and tg.product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
			</if>
			<if test="page.parameter.dateType == 1">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.dateType == 2">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_end <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_end <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.operType==1">
				<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
					and go.operator_id in (${page.parameter.saleOperatorIds})
				</if>
				<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds!=''">
					and go.operator_id in (${page.parameter.operatorIds})
				</if>
			</if>
			<if test="page.parameter.operType==2">
				<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
					and sale_operator_id in (${page.parameter.saleOperatorIds})
				</if>
				<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds!=''">
					and sale_operator_id in (${page.parameter.operatorIds})
				</if>
			</if>
			<if test="page.parameter.groupCode!=null">
				and tg.group_code like concat('%',#{page.parameter.groupCode},'%')
			</if>
			<if test="page.parameter.receiveMode!=null">
				and receive_mode like concat('%',#{page.parameter.receiveMode},'%')
			</if>
			union all

			select tg.id as group_id,tg.group_code,tg.date_start,tg.date_end,tg.product_brand_name,tg.product_name,go.receive_mode,go.order_mode
			,bs.supplier_type,go.businessName,bs.supplier_name,'' as departure_place,0 as num_adult, 0 as num_child,'' sale_operator_name,bs.operator_name
			,0 as total, 0 as total_cash, 0 as total_balance
			,bs.total cost,bs.total_cash cost_cash,bs.total-bs.total_cash as cost_balance,0
			group_cost,other_total,other_total_cash,other_total-other_total_cash as other_total_balance
			from
			(select group_id,16 as supplier_type,supplier_id,supplier_name,user_name as operator_name,sum(ifnull(total,0))
			total, 0 as other_total,0 as other_total_cash,
			sum(ifnull(total_cash,0)) total_cash from booking_delivery
			where
			<if test="set!=null">
				group_id in
				<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			group by group_id,supplier_id,user_name
			union all
			select group_id,supplier_type,supplier_id,supplier_name,user_name as operator_name
			,sum(case when supplier_type <![CDATA[<>]]>120 then total else 0 end) as total
			,sum(case when (supplier_type =120 or sub_type = 1) then total else 0 end) as other_total
			,ifnull(sum(case when supplier_type =120 or sub_type = 1 then total_cash else 0 end),0) as other_total_cash
			,sum(ifnull(total_cash,0)) total_cash
			from booking_supplier where
			<if test="set!=null">
				group_id in
				<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			group by group_id,supplier_id,user_name
			) as bs join tour_group tg on (tg.id=bs.group_id)
			left join
			(select group_id,GROUP_CONCAT(CONCAT_WS('、',receive_mode)) receive_mode,supplier_name as businessName,order_mode
			from group_order where state !=-1 group by group_id
			) go on (go.group_id=tg.id)
			where tg.group_state in (1,3,4) and tg.biz_id=#{bizId,jdbcType=INTEGER}
			<if test="page.parameter.supplierName!=null">
				and supplier_name like concat('%',#{page.parameter.supplierName},'%')
			</if>
			<if test="page.parameter.productName!=null">
				and tg.product_name like concat('%',#{page.parameter.productName},'%')
			</if>
			<if test="page.parameter.productBrandName!=null">
				and tg.product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
			</if>
			<if test="page.parameter.groupMode == 1 ">
				and tg.group_mode <![CDATA[>]]> 0
			</if>
			<if test="page.parameter.dateType == 1">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.dateType == 2">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_end <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_end <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.groupCode!=null">
				and tg.group_code like concat('%',#{page.parameter.groupCode},'%')
			</if>
			<if test="page.parameter.receiveMode!=null">
				and receive_mode like concat('%',#{page.parameter.receiveMode},'%')
			</if>
			) as aa
			<if test="page.parameter.deliveryName != null and  page.parameter.deliveryName != ''">
				where group_id in (select group_id from booking_delivery where supplier_name like concat('%',#{page.parameter.deliveryName},'%'))
				<if test="set!=null">
					and  group_id in
					<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
			</if>

			order by date_start,group_id,supplier_type
		</select>
	<select id="selectGroupOrderGuestListPage" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select go.group_id,go.product_name,go.sale_operator_id,go.sale_operator_name,go.departure_date ,tg.group_code,
			go.operator_id,go.operator_name,go.supplier_id,go.total,go.supplier_name,go.num_adult,go.num_child,go.order_mode,go.receive_mode, go.remark,go.creator_id,
			gog.order_id,gog.`name`,gog.type,gog.certificate_num,gog.gender,gog.mobile,gog.native_place,gog.age
		from group_order_guest as gog join group_order go on (gog.order_id=go.id) join tour_group tg on (tg.id=go.group_id)
		where go.state=1 and go.biz_id = #{bizId} 
		<if test="set!=null">
		<if test="userRightType==1"> 
			and go.sale_operator_id in
		</if>
		<if test="userRightType!=1"> 
			and go.operator_id in
		</if>
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and go.departure_date <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and go.departure_date <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.groupCode!=null and page.parameter.groupCode != ''">
			AND tg.group_code like concat('%',#{page.parameter.groupCode},'%')
		</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.remark != null and page.parameter.remark != ''">
			and go.remark LIKE CONCAT('%',#{page.parameter.remark},'%')
		</if>
		<if test="page.parameter.guestName != null and page.parameter.guestName != ''">
			and (gog.`name` LIKE CONCAT('%',#{page.parameter.guestName},'%') or gog.mobile LIKE CONCAT('%',#{page.parameter.guestName},'%')) 
		</if>
		<if test="page.parameter.nativePlace != null and page.parameter.nativePlace != ''">
			and gog.`native_place` LIKE CONCAT('%',#{page.parameter.nativePlace},'%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			and go.supplier_name LIKE CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		
		<if test="page.parameter.gender != null">
			and gog.`gender` = #{page.parameter.gender}
		</if>
		<if test="page.parameter.ageFirst == null and page.parameter.ageSecond != null">
			and gog.`age` <![CDATA[<=]]> #{page.parameter.ageSecond}
		</if>
		<if test="page.parameter.ageFirst != null and page.parameter.ageSecond == null">
			and gog.`age` <![CDATA[>=]]> #{page.parameter.ageFirst}
		</if>
		<if test="page.parameter.ageSecond != null and page.parameter.ageFirst != null">
			and gog.`age` BETWEEN #{page.parameter.ageFirst} AND #{page.parameter.ageSecond}
		</if>
		<if test="page.parameter.receiveMode != null">
			and go.receive_mode LIKE CONCAT('%',#{page.parameter.receiveMode},'%')
		</if>
	</select>
	
		<select id="selectGroupOrderGuestListPageOu" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select go.group_id,go.product_name,go.sale_operator_id,go.sale_operator_name,go.departure_date ,tg.group_code,
		go.operator_id,go.operator_name,go.supplier_id,go.total,go.supplier_name,go.num_adult,go.num_child,go.order_mode,go.receive_mode, go.remark,go.creator_id,
		gog.order_id,gog.`name`,gog.type,gog.certificate_num,gog.gender,gog.mobile,gog.native_place,gog.age
		from group_order_guest as gog join group_order go on (gog.order_id=go.id) join tour_group tg on (tg.id=go.group_id)
		where go.state=1 and go.biz_id = #{bizId}
		<if test="set!=null">
			<if test="userRightType==1">
				and go.sale_operator_id in
			</if>
			<if test="userRightType!=1">
				and go.operator_id in
			</if>
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and go.departure_date <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and go.departure_date <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.operator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==3">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
				and go.creator_id in (${page.parameter.saleOperatorIds})
			</if>
		</if>
		<if test="page.parameter.groupCode!=null and page.parameter.groupCode != ''">
			AND tg.group_code like concat('%',#{page.parameter.groupCode},'%')
		</if>
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.remark != null and page.parameter.remark != ''">
			and go.remark LIKE CONCAT('%',#{page.parameter.remark},'%')
		</if>
		<if test="page.parameter.guestName != null and page.parameter.guestName != ''">
			and (gog.`name` LIKE CONCAT('%',#{page.parameter.guestName},'%') or gog.mobile LIKE CONCAT('%',#{page.parameter.guestName},'%'))
		</if>
		<if test="page.parameter.nativePlace != null and page.parameter.nativePlace != ''">
			and gog.`native_place` LIKE CONCAT('%',#{page.parameter.nativePlace},'%')
		</if>
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			and go.supplier_name LIKE CONCAT('%',#{page.parameter.supplierName},'%')
		</if>

		<if test="page.parameter.gender != null">
			and gog.`gender` = #{page.parameter.gender}
		</if>
		<if test="page.parameter.ageFirst == null and page.parameter.ageSecond != null">
			and gog.`age` <![CDATA[<=]]> #{page.parameter.ageSecond}
		</if>
		<if test="page.parameter.ageFirst != null and page.parameter.ageSecond == null">
			and gog.`age` <![CDATA[>=]]> #{page.parameter.ageFirst}
		</if>
		<if test="page.parameter.ageSecond != null and page.parameter.ageFirst != null">
			and gog.`age` BETWEEN #{page.parameter.ageFirst} AND #{page.parameter.ageSecond}
		</if>
		<if test="page.parameter.receiveMode != null">
			and go.receive_mode LIKE CONCAT('%',#{page.parameter.receiveMode},'%')
		</if>
			<choose>
				<when test="sidx != null and sidx !=''">
					order by ${sidx} ${sord}
				</when>
				<otherwise>
					ORDER BY go.departure_date desc
				</otherwise>
			</choose>

	</select>
		
		<select id="selectMonthlyReportStatistics" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
			select * from (
		select tg.id as group_id,tg.group_code,tg.date_start,tg.product_name,receive_mode,order_mode,
		1 as supplier_type,supplier_name as businessName,'' as supplier_name, '' as departure_place,num_adult,num_child,sale_operator_name,go.operator_name,
		total ,total_cash,total-total_cash as total_balance,
		0 as cost, 0 as cost_cash,0 as cost_balance,(tg.total_income - tg.total_cost)/(tg.total_adult+tg.total_child)*(go.num_adult+go.num_child) as group_cost,
		 0 as other_total ,0 as other_total_cash,0 as other_total_balance
		from group_order go join tour_group tg on (go.group_id=tg.id)
		where tg.group_state in (1,3,4) and tg.biz_id=#{bizId,jdbcType=INTEGER} and go.state !=-1
		<if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			and go.order_mode<![CDATA[<>]]>0 and go.order_mode in (${page.parameter.orderNo})
		</if>
		<if test="page.parameter.supplierName!=null">
			and supplier_name like concat('%',#{page.parameter.supplierName},'%') 
		</if>
			<if test="page.parameter.groupMode == 1 ">
				and tg.group_mode <![CDATA[>]]> 0
			</if>
			<if test="page.parameter.productBrandName!=null">
				and tg.product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
			</if>
			<if test="page.parameter.productName!=null">
				and tg.product_name like concat('%',#{page.parameter.productName},'%')
			</if>
			<if test="page.parameter.dateType == 1">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.dateType == 2">
			<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
				and tg.date_end <![CDATA[>=]]> #{page.parameter.startTime}
			</if>
			<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
				and tg.date_end <![CDATA[<=]]> #{page.parameter.endTime}
			</if>
			</if>
		<if test="page.parameter.operType==1">
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and go.operator_id in (${page.parameter.saleOperatorIds})
		</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds!=''">
			and go.operator_id in (${page.parameter.operatorIds})
		</if>
		</if>
			<if test="page.parameter.operType==2">
		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and sale_operator_id in (${page.parameter.saleOperatorIds})
		</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds!=''">
			and sale_operator_id in (${page.parameter.operatorIds})
		</if>
		</if>
			<if test="page.parameter.groupCode!=null">
			and tg.group_code like concat('%',#{page.parameter.groupCode},'%') 
		</if>
			<if test="page.parameter.receiveMode!=null">
			and receive_mode like concat('%',#{page.parameter.receiveMode},'%') 
		</if>
		 union all 
		select tg.id as group_id,tg.group_code,tg.date_start,tg.product_name,go.receive_mode,go.order_mode
		,bs.supplier_type,go.businessName,bs.supplier_name,'' as departure_place,0 as num_adult, 0 as num_child,
		'' sale_operator_name,bs.operator_name
		,0 as total, 0 as total_cash, 0 as total_balance
		,bs.total cost,bs.total_cash cost_cash,bs.total-bs.total_cash as cost_balance,0 group_cost,other_total,other_total_cash,other_total-other_total_cash as other_total_balance
		 from 
			(select group_id,16 as supplier_type,supplier_id,supplier_name,user_name as operator_name,sum(ifnull(total,0)) total, 0 as other_total,0 as other_total_cash,
			sum(ifnull(total_cash,0)) total_cash from booking_delivery 
		where <if test="set!=null">
				 group_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		group by group_id,supplier_id,user_name
			 union all
			select group_id,supplier_type,supplier_id,supplier_name,user_name as operator_name
			,sum(case when supplier_type <![CDATA[<>]]>120 then total else 0 end) as total
			,sum(case when (supplier_type =120 or sub_type = 1) then total else 0 end) as other_total
			,ifnull(sum(case when supplier_type =120 or sub_type = 1 then total_cash else 0 end),0) as other_total_cash
			,sum(ifnull(total_cash,0)) total_cash
			from booking_supplier where  
		<if test="set!=null">
				 group_id in
			<foreach item="item" index="index" collection="set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		group by group_id,supplier_id,user_name
			) as bs join tour_group tg on (tg.id=bs.group_id)
			left join
				(select group_id,GROUP_CONCAT(CONCAT_WS('、',receive_mode)) receive_mode,supplier_name as businessName,order_mode
					from group_order where state !=-1 group by group_id
				) go on (go.group_id=tg.id) 
		 where tg.group_state in (1,3,4) and tg.biz_id=#{bizId,jdbcType=INTEGER}
			<if test="page.parameter.supplierName!=null">
			and supplier_name like concat('%',#{page.parameter.supplierName},'%') 
		</if>
			<if test="page.parameter.productBrandName!=null">
				and tg.product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
			</if>
			<if test="page.parameter.productName!=null">
				and tg.product_name like concat('%',#{page.parameter.productName},'%')
			</if>
			<if test="page.parameter.groupMode == 1 ">
				and tg.group_mode <![CDATA[>]]> 0
			</if>
			<if test="page.parameter.dateType == 1">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.dateType == 2">
				<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
					and tg.date_end <![CDATA[>=]]> #{page.parameter.startTime}
				</if>
				<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
					and tg.date_end <![CDATA[<=]]> #{page.parameter.endTime}
				</if>
			</if>
			<if test="page.parameter.groupCode!=null">
			and tg.group_code like concat('%',#{page.parameter.groupCode},'%') 
		</if>
			<if test="page.parameter.receiveMode!=null">
			and receive_mode like concat('%',#{page.parameter.receiveMode},'%') 
		</if>
		) as aa order by date_start,group_id,supplier_type
		</select>
		
	<select id="selectProductProfitStatisticsListPage" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		SELECT go.supplier_name, go.order_mode,tg.product_brand_name, tg.product_id, tg.product_name,sum(go.adult) numAdult,sum(go.child) numChild
		 ,sum(go.goTotal) totalIncome, sum(ifnull(oIn.otherIn,0))/sum(tg.total_adult+tg.total_child)*sum(go.adult+go.child) otherTotal, 
		sum(tg.total_cost) /sum(tg.total_adult+tg.total_child)*sum(go.adult+go.child) as total_cost
		FROM tour_group tg
		JOIN (select group_id,supplier_id,supplier_name,order_mode,sum(total) goTotal,sum(num_adult) adult,sum(num_child) child 
					from group_order  where group_id in (select id from tour_group 
					 where biz_id=#{bizId,jdbcType=INTEGER} 
			<if test="page.parameter.startMin != null and page.parameter.startMin != ''">
			and date_start <![CDATA[>=]]> #{page.parameter.startMin} 
			</if>
			<if test="page.parameter.startMax != null and page.parameter.startMax != ''">
			and date_start <![CDATA[<=]]> #{page.parameter.startMax}
			</if>
			<if test="page.parameter.productName != null and page.parameter.productName != ''">
			and product_name like concat('%',#{page.parameter.productName},'%')  
			</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName != ''">
			and product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
		</if>
			<if test="page.parameter.operType == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
		<!-- 	<if test="page.parameter.set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="("
				separator="," close=")">
				#{item}
			</foreach>
			</if> -->
		and group_state in (1,3,4) and group_mode <![CDATA[<=]]>0) 
		 <if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			 and order_mode in (${page.parameter.orderNo})
			</if> 
			<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			and supplier_name like concat('%',#{page.parameter.supplierName},'%')  
			</if>
			<if test="page.parameter.operType == 2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and sale_operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
						group by group_id,supplier_id,order_mode) go ON(tg.id=go.group_id)

		left JoIN (select group_id, sum(total) as otherIn from booking_supplier where (sub_type = 1 or supplier_type=120) 
					and group_id in (select id from tour_group  where biz_id=#{bizId,jdbcType=INTEGER} 	
					<if test="page.parameter.startMin != null and page.parameter.startMin != ''">
			and date_start <![CDATA[>=]]> #{page.parameter.startMin} 
			</if>
			<if test="page.parameter.startMax != null and page.parameter.startMax != ''">
			and date_start <![CDATA[<=]]> #{page.parameter.startMax}
			</if>
			<if test="page.parameter.productName != null and page.parameter.productName != ''">
			and product_name like concat('%',#{page.parameter.productName},'%')  
			</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName != ''">
			and product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
		</if>
			<if test="page.parameter.operType == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
		<!-- 	<if test="page.parameter.set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="("
				separator="," close=")">
				#{item}
			</foreach>
			</if> -->
		and group_state in (1,3,4) and group_mode <![CDATA[<=]]>0
					)  
					group by group_id) oIn on (tg.id=oIn.group_id)
			
		where biz_id=#{bizId,jdbcType=INTEGER}	
			<if test="page.parameter.startMin != null and page.parameter.startMin != ''">
			and date_start <![CDATA[>=]]> #{page.parameter.startMin} 
			</if>
			<if test="page.parameter.startMax != null and page.parameter.startMax != ''">
			and date_start <![CDATA[<=]]> #{page.parameter.startMax}
			</if>
			<if test="page.parameter.productName != null and page.parameter.productName != ''">
			and product_name like concat('%',#{page.parameter.productName},'%')  
			</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName != ''">
			and product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
		</if>
			<if test="page.parameter.operType == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
		<!-- 	<if test="page.parameter.set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="("
				separator="," close=")">
				#{item}
			</foreach>
			</if> -->
		group by tg.product_brand_name,tg.product_name,go.supplier_name,go.order_mode
		
		union all 
		
		SELECT  supplier_name,order_mode,tg.product_brand_name, tg.product_id, tg.product_name,sum(tg.total_adult) numAdult,sum(tg.total_child) numChild
		 ,sum(go.goTotal) totalIncome, sum(ifnull(oIn.otherIn,0)) otherTotal, sum(tg.total_cost) as total_cost
		FROM tour_group tg
		 JOIN (select group_id,sum(total) goTotal,supplier_name,order_mode from group_order where order_type>0 and group_id in (select id from tour_group 
		where biz_id=#{bizId,jdbcType=INTEGER} 
		<if test="page.parameter.startMin != null and page.parameter.startMin != ''">
			and date_start <![CDATA[>=]]> #{page.parameter.startMin} 
			</if>
			<if test="page.parameter.startMax != null and page.parameter.startMax != ''">
			and date_start <![CDATA[<=]]> #{page.parameter.startMax}
			</if>
			<if test="page.parameter.productName != null and page.parameter.productName != ''">
			and product_name like concat('%',#{page.parameter.productName},'%')  
			</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName != ''">
			and product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
		</if>
			<if test="page.parameter.operType == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
		<!-- 	<if test="page.parameter.set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="("
				separator="," close=")">
				#{item}
			</foreach>
			</if> -->
		and group_state in (1,3,4) and group_mode <![CDATA[>]]>0)
		 <if test="page.parameter.orderNo!=null and page.parameter.orderNo!=''">
			 and order_mode in (${page.parameter.orderNo})
			</if> 
			<if test="page.parameter.supplierName != null and page.parameter.supplierName != ''">
			and supplier_name like concat('%',#{page.parameter.supplierName},'%')  
			</if>
				<if test="page.parameter.operType == 2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and sale_operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
		group by group_id,supplier_name,order_mode) go ON(tg.id=go.group_id)
		left JoIN (select group_id, sum(total) as otherIn from booking_supplier where (sub_type = 1 or supplier_type=120) and group_id in (select id from tour_group 
		where biz_id=#{bizId,jdbcType=INTEGER} 
		<if test="page.parameter.startMin != null and page.parameter.startMin != ''">
			and date_start <![CDATA[>=]]> #{page.parameter.startMin} 
			</if>
			<if test="page.parameter.startMax != null and page.parameter.startMax != ''">
			and date_start <![CDATA[<=]]> #{page.parameter.startMax}
			</if>
			<if test="page.parameter.productName != null and page.parameter.productName != ''">
			and product_name like concat('%',#{page.parameter.productName},'%')  
			</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName != ''">
			and product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
		</if>
			<if test="page.parameter.operType == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
	<!-- 		<if test="page.parameter.set!=null">
			AND operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="("
				separator="," close=")">
				#{item}
			</foreach>
			</if> -->
		and group_state in (1,3,4) and group_mode <![CDATA[>]]>0) 
		group by group_id) oIn on (tg.id=oIn.group_id)
		where tg.biz_id=#{bizId,jdbcType=INTEGER} 
		<if test="page.parameter.startMin != null and page.parameter.startMin != ''">
			and tg.date_start <![CDATA[>=]]> #{page.parameter.startMin} 
			</if>
			<if test="page.parameter.startMax != null and page.parameter.startMax != ''">
			and tg.date_start <![CDATA[<=]]> #{page.parameter.startMax}
			</if>
			<if test="page.parameter.productName != null and page.parameter.productName != ''">
			and tg.product_name like concat('%',#{page.parameter.productName},'%')  
			</if>
		<if test="page.parameter.productBrandName != null and page.parameter.productBrandName != ''">
			and product_brand_name like concat('%',#{page.parameter.productBrandName},'%')
		</if>
			<if test="page.parameter.operType == 1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and tg.operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and tg.operator_id in (${page.parameter.operatorIds})
			</if>
			</if>
			<!-- <if test="page.parameter.set!=null">
			AND tg.operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="("
				separator="," close=")">
				#{item}
			</foreach>
			</if> -->
		and tg.group_state in (1,3,4) and tg.group_mode <![CDATA[>]]> 0 
		group by supplier_name,order_mode,tg.product_brand_name,tg.product_name
			</select>
	<select id="selectGroupOrdersInGroupsForCarCar" resultMap="groupOrderForCarCar" parameterType="com.yihg.mybatis.utility.PageBean">
		select go.id, go.group_id, go.operator_id,go.operator_name,
		order_no,order_type,`type`,
		go.total,
		contact_name,
		contact_tel,
		contact_mobile, contact_fax,

		num_adult,
		num_child,
		num_guide,

		departure_date, go.product_id,
		go.product_brand_id,
		go.product_brand_name,
		go.product_name,
		receive_mode,
		go.province_name,
		go.city_name,
		go.remark,tg.group_code,bg.`guide_id`,bg.`guide_name`,bg.`guide_mobile`
		from group_order go left join tour_group tg on go.group_id = tg.id
		join booking_guide bg on tg.id = bg.group_id
		where <!-- create_time <![CDATA[>=]]> #{page.parameter.startTime}
		  and create_time <![CDATA[<=]]> #{page.parameter.endTime}
		  and -->
		  go.group_id IN
		<foreach item="item" index="index" collection="page.parameter.groupIdSet" open="("
				 separator="," close=")">
			#{item}
		</foreach>
		AND bg.`is_default` = 1
	</select>


	<select id="selectPaymentStatisticsListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select * from (
		select supplier_name as businessName,'' as supplier_name,order_type,
		sum(total) total ,sum(total_cash) total_cash,total-total_cash as total_balance,
		0 as cost, 0 as cost_cash,0 as cost_balance,0 as other_total
		from group_order go join tour_group tg on (go.group_id=tg.id)
		where tg.group_state in (1,3,4)  and go.state !=-1 and group_mode <![CDATA[>]]> 0
		and tg.biz_id=#{bizId,jdbcType=INTEGER}
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and go.sale_operator_id in (${page.parameter.operatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and tg.operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and tg.operator_id in (${page.parameter.operatorIds})
			</if>
		</if>
		GROUP BY businessName
		union all

		select  go.businessName,bs.supplier_name,go.order_type
		,0 as total, 0 as total_cash, 0 as total_balance
		,sum(bs.total) cost,sum(bs.total_cash) cost_cash,sum(bs.total)-sum(bs.total_cash) as cost_balance,bs.other_total
		from
		(select group_id,supplier_name,sum(ifnull(total,0)) total,
		sum(ifnull(total_cash,0)) total_cash,0 as other_total from booking_delivery
		where group_id in(select tg.id from tour_group tg
		left join group_order go on (tg.id=go.group_id)
		where  tg.group_state in (1,3,4) and tg.group_mode <![CDATA[>]]> 0
		and tg.biz_id=#{bizId,jdbcType=INTEGER}
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and go.sale_operator_id in (${page.parameter.operatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and tg.operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and tg.operator_id in (${page.parameter.operatorIds})
			</if>
		</if>
		)
		group by supplier_name
		union all
		select group_id,supplier_name
		,sum(case when supplier_type <![CDATA[<>]]> 120 then total else 0 end) as total
		,sum(ifnull(total_cash,0)) total_cash
		,sum(case when supplier_type =120 then total else 0 end) as other_total
		from booking_supplier where
		group_id in(select tg.id from tour_group tg
		left join group_order go on (tg.id=go.group_id)
		where  tg.group_state in (1,3,4) and tg.group_mode <![CDATA[>]]> 0
		and tg.biz_id=#{bizId,jdbcType=INTEGER}
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.operType==1">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and go.sale_operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and go.sale_operator_id in (${page.parameter.operatorIds})
			</if>
		</if>
		<if test="page.parameter.operType==2">
			<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds !=''">
				and tg.operator_id in (${page.parameter.saleOperatorIds})
			</if>
			<if test="page.parameter.operatorIds!=null and page.parameter.operatorIds !=''">
				and tg.operator_id in (${page.parameter.operatorIds})
			</if>
		</if>
		)
		group by supplier_name
		) as bs
		join tour_group tg on (tg.id=bs.group_id)
		left join
		(select group_id,supplier_name as businessName,order_type
		from group_order where state !=-1
		group by group_id
		) go on (go.group_id=tg.id)
		where tg.group_state in (1,3,4)
		and group_mode <![CDATA[>]]> 0
		and tg.biz_id=#{bizId,jdbcType=INTEGER}
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and tg.date_start <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and tg.date_start <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		GROUP BY supplier_name
		) as aa
		where 1=1
		<if test="page.parameter.supplierName != null and page.parameter.supplierName != '' ">
			and aa.supplier_name LIKE CONCAT('%',#{page.parameter.supplierName},'%')
		</if>
		<if test="page.parameter.businessName != null and page.parameter.businessName != '' ">
			and aa.businessName LIKE CONCAT('%',#{page.parameter.businessName},'%')
		</if>
		order by supplier_name

	</select>

	<select id="selectRoomExtrabedListPage" parameterType="com.yihg.mybatis.utility.PageBean" resultMap="BaseResultMap">
		select a.product_id,a.product_brand_name,a.product_name,a.departure_date, sum(b.count_double_room) as count_double_room,sum(b.extrabed) as extrabed
		from group_order a join group_requirement b on (a.id=b.order_id)
		where a.biz_id=#{bizId} and a.state=1
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and	a.departure_date <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and a.departure_date <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE CONCAT('%','${page.parameter.productName}','%')
		</if>
		group by a.product_id,a.departure_date
	</select>

	<select id="selectSumRoomExtrabed" resultType="java.util.HashMap" parameterType="com.yihg.mybatis.utility.PageBean">
		select sum(b.count_double_room) as count_double_room,sum(b.extrabed) as extrabed
		from group_order a join group_requirement b on (a.id=b.order_id)
		where a.biz_id=#{bizId} and a.state=1
		<if test="page.parameter.startTime != null and page.parameter.startTime != ''">
			and	a.departure_date <![CDATA[>=]]> #{page.parameter.startTime}
		</if>
		<if test="page.parameter.endTime != null and page.parameter.endTime != ''">
			and a.departure_date <![CDATA[<=]]> #{page.parameter.endTime}
		</if>
		<if test="page.parameter.productBrandId != null and page.parameter.productBrandId != -1">
			and a.product_brand_id =#{page.parameter.productBrandId}
		</if>
		<if test="page.parameter.productName != null and page.parameter.productName !=''">
			and a.product_name LIKE CONCAT('%','${page.parameter.productName}','%')
		</if>
	</select>

	<select id="selectGroupOrderByResId" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from group_order
		where ext_res_id = #{resId,jdbcType=INTEGER}
	</select>

	<select id="selectSumTotalByResId" resultMap="BaseResultMap">
		SELECT SUM(total_income) total,SUM(total_cost) cost
		FROM tour_group WHERE group_state !=2
		AND id in (SELECT distinct group_id FROM group_order
		WHERE ext_res_id=#{resId,jdbcType=INTEGER} AND group_id <![CDATA[>]]>0 AND state !=-1)
	</select>

	<select id="selectGroupOrderGroupByPro" resultMap="BaseResultMap">
		SELECT product_name,product_id,ext_res_id,SUM(num_adult) num_adult,SUM(num_child) num_child,
		SUM(num_child_baby) num_child_baby,SUM(total) total from group_order
		where ext_res_id = #{resId,jdbcType=INTEGER}
		and state=1
		GROUP BY product_id  ORDER BY product_id
	</select>

	<select id="selectGroupOrderCountBySidAndDate" resultType="integer">
		SELECT count(*) FROM group_order WHERE biz_id=#{bizId,jdbcType=INTEGER} AND ext_res_id>0
		AND ext_res_state=0 AND supplier_id=#{supplierId,jdbcType=INTEGER} and total <![CDATA[<>]]> total_cash
		AND departure_date=#{departureDate,jdbcType=VARCHAR}
	</select>

	<select id="selectGroupOrderBysIdAndResState" resultMap="BaseResultMap">
		select id,ext_res_id,product_id,product_name,departure_date,num_adult,num_child,num_child_baby,total,
		order_no,DATE_ADD(FROM_UNIXTIME(create_time/1000),INTERVAL ext_res_clean_time MINUTE) AS date_latest
		from group_order as gOrder
		where ext_res_id > 0 and gOrder.state !=-1 and gOrder.biz_id = #{bizId,jdbcType=INTEGER}
		and ext_res_state = #{extResState,jdbcType=INTEGER}
		and supplier_id = #{supplierId,jdbcType=INTEGER}
		order by departure_date,create_time desc
	</select>

	<!-- 收款处理添加订单信息 -->
	<select id="selectIncomePayAddTableListPage" parameterType="com.yihg.mybatis.utility.PageBean"
			resultType="java.util.HashMap">
		select a.id,
		<if test="page.parameter.supType==6">
			(IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0))
			total,
			(IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0) -
			IFNULL(a.total_cash,0)) balance,
		</if>
		<if test="page.parameter.supType!=6">
			IFNULL(a.total,0) total, (IFNULL(a.total,0) -
			IFNULL(a.total_cash,0)) balance,
		</if>
		<if test="page.parameter.supType==1">
			a.receive_mode, a.num_adult, a.num_child,
			(IFNULL(a.num_adult,0)+IFNULL(a.num_child,0)+IFNULL(a.num_guide,0))
			sum_person, a.order_no
		</if>
		<if test="page.parameter.supType!=1">a.booking_no</if>
		order_no,
		<if test="page.parameter.supType == 12">a.cash_type,a.supplier_type,a.remark,</if>
		a.total_cash,
		a.audit_user,
		b.id group_id,
		b.group_code,
		b.product_name,
		b.product_brand_name,
		b.group_mode,
		b.operator_name,
		a.state_finance,
		a.state_seal
		from
		<if test="page.parameter.supType==1">group_order</if>
		<if test="page.parameter.supType==6">booking_shop</if>
		<if test="page.parameter.supType==12">booking_supplier</if>
		a left join tour_group b on (a.group_id = b.id and b.group_state IN (1,3,4))
		where
		b.biz_id = #{bizId}
		and a.supplier_id=#{page.parameter.supplierId}
		<if test="page.parameter.supType==1">
			and a.state = 1
		</if>
		<if test="page.parameter.supType==12">
			and a.supplier_type = 120
		</if>
		<if test="page.parameter.orderNo!=null">
			and
			<if test="page.parameter.supType==1">a.receive_mode</if>
			<if test="page.parameter.supType!=1">a.booking_no</if>
			like '%${page.parameter.orderNo}%'
		</if>
		<if test="page.parameter.groupCode!=null">and b.group_code like '%${page.parameter.groupCode}%'
		</if>

		<if test="page.parameter.dateType == 'groupDate'">
			<if test="page.parameter.startMin != null">
				and b.date_start <![CDATA[>=]]>
				#{page.parameter.startMin}
			</if>
			<if test="page.parameter.startMax != null">
				and b.date_start <![CDATA[<=]]>
				#{page.parameter.startMax}
			</if>
		</if>
		<if test="page.parameter.dateType == 'orderDate'">
			<if test="page.parameter.startMin != null">
				and
				<if test="page.parameter.supType==1">a.departure_date</if>
				<if test="page.parameter.supType==6">a.shop_date</if>
				<if test="page.parameter.supType==12">a.booking_date</if>
				<![CDATA[>=]]>
				#{page.parameter.startMin}
			</if>
			<if test="page.parameter.startMax != null">
				and
				<if test="page.parameter.supType==1">a.departure_date</if>
				<if test="page.parameter.supType==6">a.shop_date</if>
				<if test="page.parameter.supType==12">a.booking_date</if>
				<![CDATA[<=]]>
				#{page.parameter.startMax}
			</if>
		</if>

		<if test="page.parameter.saleOperatorIds!=null and page.parameter.saleOperatorIds!=''">
			and b.operator_id in (${page.parameter.saleOperatorIds})
		</if>
		<if test="page.parameter.set != null">
			and b.operator_id in
			<foreach item="item" index="index" collection="page.parameter.set" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="page.parameter.payState == 'unPaid'">
			<if test="page.parameter.supType==6">
				and (IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0) - IFNULL(a.total_cash,0)) != 0
			</if>
			<if test="page.parameter.supType!=6">
				and (IFNULL(a.total,0) - IFNULL(a.total_cash,0)) != 0
			</if>
		</if>
		<if test="page.parameter.payState == 'paid'">
			<if test="page.parameter.supType==6">
				and (IFNULL(a.total_repay,0)+IFNULL(a.person_repay_total,0) - IFNULL(a.total_cash,0)) = 0
			</if>
			<if test="page.parameter.supType!=6">
				and (IFNULL(a.total,0) - IFNULL(a.total_cash,0)) = 0
			</if>
		</if>
		order by b.date_start asc
	</select>
</mapper>