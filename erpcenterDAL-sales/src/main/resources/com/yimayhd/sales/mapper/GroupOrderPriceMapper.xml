<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yimayhd.erpcenter.dal.sales.sales.dao.GroupOrderPriceMapper">
	<resultMap id="BaseResultMap" type="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrderPrice">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="mode" property="mode" jdbcType="INTEGER" />
		<result column="order_id" property="orderId" jdbcType="INTEGER" />
		<result column="item_id" property="itemId" jdbcType="INTEGER" />
		<result column="item_name" property="itemName" jdbcType="VARCHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="unit_price" property="unitPrice" jdbcType="DOUBLE" />
		<result column="num_times" property="numTimes" jdbcType="DOUBLE" />
		<result column="num_person" property="numPerson" jdbcType="DOUBLE" />
		<result column="total_price" property="totalPrice" jdbcType="DOUBLE" />
		<result column="row_state" property="rowState" jdbcType="INTEGER" />
		<result column="creator_id" property="creatorId" jdbcType="INTEGER" />
		<result column="creator_name" property="creatorName" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="BIGINT" />
		<result column="price_lock_state" property="priceLockState" jdbcType="INTEGER" />
		<result column="state_finance" property="stateFinance" jdbcType="INTEGER" />
	</resultMap>
	<sql id="Base_Column_List">
		id, mode, order_id, item_id,item_name, remark, unit_price, num_times, num_person,
		total_price,
		row_state, creator_id, creator_name, create_time,price_lock_state,state_finance
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from group_order_price
		where id = #{id,jdbcType=INTEGER}
	</select>
	<select id="selectByOrder" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		id, mode, 
		order_id, 
		item_id,
		item_name, 
		remark, 
		unit_price, 
		num_times, 
		num_person, 
		total_price, 
		row_state, 
		creator_id, 
		creator_name, 
		create_time,
		price_lock_state
		from group_order_price
		where order_id = #{id,jdbcType=INTEGER}
		and mode = 0
	</select>
	<select id="selectAllPriceByOrder" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from group_order_price
		where order_id = #{id,jdbcType=INTEGER}
	</select>
	
	<select id="selectByOrderAndType" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from group_order_price
		where order_id = #{orderId,jdbcType=INTEGER} and
		mode=#{mode,jdbcType=INTEGER}
	</select>

	<select id="selectByOrderAndTypeAndRowState" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from group_order_price
		where order_id = #{orderId,jdbcType=INTEGER} and
		mode=#{mode,jdbcType=INTEGER} and
		row_state=#{rowState,jdbcType=INTEGER}
	</select>
	
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from group_order_price
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrderPrice">
		insert into group_order_price (id, mode, order_id,item_id,
		item_name, remark, unit_price,
		num_times, num_person, total_price,
		row_state, creator_id, creator_name,
		create_time,price_lock_state)
		values (#{id,jdbcType=INTEGER}, #{mode,jdbcType=INTEGER},
		#{orderId,jdbcType=INTEGER},#{itemId,jdbcType=INTEGER},
		#{itemName,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, #{unitPrice,jdbcType=DOUBLE},
		#{numTimes,jdbcType=DOUBLE}, #{numPerson,jdbcType=DOUBLE},
		#{totalPrice,jdbcType=DOUBLE},
		#{rowState,jdbcType=INTEGER}, #{creatorId,jdbcType=INTEGER}, #{creatorName,jdbcType=VARCHAR},
		#{createTime,jdbcType=BIGINT},#{priceLockState,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrderPrice">
		insert into group_order_price
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="mode != null">
				mode,
			</if>
			<if test="orderId != null">
				order_id,
			</if>
			<if test="itemId != null">
				item_id,
			</if>
			<if test="itemName != null">
				item_name,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="unitPrice != null">
				unit_price,
			</if>
			<if test="numTimes != null">
				num_times,
			</if>
			<if test="numPerson != null">
				num_person,
			</if>
			<if test="totalPrice != null">
				total_price,
			</if>
			<if test="rowState != null">
				row_state,
			</if>
			<if test="creatorId != null">
				creator_id,
			</if>
			<if test="creatorName != null">
				creator_name,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="priceLockState != null">
				price_lock_state,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="mode != null">
				#{mode,jdbcType=INTEGER},
			</if>
			<if test="orderId != null">
				#{orderId,jdbcType=INTEGER},
			</if>
			<if test="itemId != null">
				#{itemId,jdbcType=INTEGER},
			</if>
			<if test="itemName != null">
				#{itemName,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="unitPrice != null">
				#{unitPrice,jdbcType=DOUBLE},
			</if>
			<if test="numTimes != null">
				#{numTimes,jdbcType=DOUBLE},
			</if>
			<if test="numPerson != null">
				#{numPerson,jdbcType=DOUBLE},
			</if>
			<if test="totalPrice != null">
				#{totalPrice,jdbcType=DOUBLE},
			</if>
			<if test="rowState != null">
				#{rowState,jdbcType=INTEGER},
			</if>
			<if test="creatorId != null">
				#{creatorId,jdbcType=INTEGER},
			</if>
			<if test="creatorName != null">
				#{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=BIGINT},
			</if>
			<if test="priceLockState != null">
				#{priceLockState,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrderPrice">
		update group_order_price
		<set>
			<if test="mode != null">
				mode = #{mode,jdbcType=INTEGER},
			</if>
			<if test="orderId != null">
				order_id = #{orderId,jdbcType=INTEGER},
			</if>
			<if test="itemId != null">
				item_id = #{itemId,jdbcType=INTEGER},
			</if>
			<if test="itemName != null">
				item_name = #{itemName,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="unitPrice != null">
				unit_price = #{unitPrice,jdbcType=DOUBLE},
			</if>
			<if test="numTimes != null">
				num_times = #{numTimes,jdbcType=DOUBLE},
			</if>
			<if test="numPerson != null">
				num_person = #{numPerson,jdbcType=DOUBLE},
			</if>
			<if test="totalPrice != null">
				total_price = #{totalPrice,jdbcType=DOUBLE},
			</if>
			<if test="rowState != null">
				row_state = #{rowState,jdbcType=INTEGER},
			</if>
			<if test="creatorId != null">
				creator_id = #{creatorId,jdbcType=INTEGER},
			</if>
			<if test="creatorName != null">
				creator_name = #{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=BIGINT},
			</if>
			<if test="priceLockState != null">
				price_lock_state = #{priceLockState,jdbcType=INTEGER},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.yimayhd.erpcenter.dal.sales.client.sales.po.GroupOrderPrice">
		update group_order_price
		set mode = #{mode,jdbcType=INTEGER},
		order_id = #{orderId,jdbcType=INTEGER},
		item_id = #{itemId,jdbcType=INTEGER},
		item_name = #{itemName,jdbcType=VARCHAR},
		remark = #{remark,jdbcType=VARCHAR},
		unit_price = #{unitPrice,jdbcType=DOUBLE},
		num_times = #{numTimes,jdbcType=DOUBLE},
		num_person = #{numPerson,jdbcType=DOUBLE},
		total_price = #{totalPrice,jdbcType=DOUBLE},
		row_state = #{rowState,jdbcType=INTEGER},
		creator_id = #{creatorId,jdbcType=INTEGER},
		creator_name = #{creatorName,jdbcType=VARCHAR},
		create_time = #{createTime,jdbcType=BIGINT}
		price_lock_state = #{priceLockState,jdbcType=INTEGER},
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updatePriceLockState" parameterType="java.lang.Integer">
		update group_order_price
		<set>
			<if test="priceLockState != null">
				price_lock_state = #{priceLockState,jdbcType=INTEGER},
			</if>
		</set>
		where order_id = #{orderId,jdbcType=INTEGER}
	</update>
	<!-- <select id="getPriceInfoByOrderId" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT  GROUP_CONCAT(DISTINCT CONCAT_WS( '/',item_name,
		cast(unit_price as decimal(6,1)),cast(num_times as decimal(6,1)),
		cast(num_person as decimal(6,1)),cast(total_price as decimal(20,2)))) priceInfo FROM `group_order_price` 
		where 1=1 <if test="orderIds!=null and orderIds!=''">and  order_id in (#{orderIds})</if>
		GROUP BY order_id
		
	</select> -->
	<select id="getPriceInfoByOrderId" parameterType="java.lang.String" resultMap="BaseResultMap">
	SELECT  item_name,
		unit_price ,num_times ,
		num_person ,total_price FROM `group_order_price` 
		where 1=1 <if test="orderId!=null ">and  order_id =#{orderId}</if>
		<!-- GROUP BY order_id -->
	
	</select>
	
	<update id="auditPriceByIds" parameterType="java.util.HashMap">
		UPDATE group_order_price 
		SET state_finance = #{stateFinance,jdbcType=INTEGER} 
		WHERE id IN (${ids})
	</update>
</mapper>