<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yihg.images.mapper.ImgSpaceMapper" >
  <resultMap id="BaseResultMap" type="com.yihg.images.po.ImgSpace" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="img_id" property="imgId" jdbcType="INTEGER" />
    <result column="img_name" property="imgName" jdbcType="VARCHAR" />
    <result column="parent_id" property="parentId" jdbcType="INTEGER" />
    <result column="type" property="type" jdbcType="TINYINT" />
    <result column="file_path" property="filePath" jdbcType="VARCHAR" />
    <result column="sys_id" property="sysId" jdbcType="VARCHAR" />
    <result column="dealer_id" property="dealerId" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
     <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="BIT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    img_id, img_name, parent_id, type, file_path, sys_id, dealer_id, user_id, create_time,update_time,
    status
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from img_space
    where img_id = #{imgId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from img_space
    where img_id = #{imgId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.yihg.images.po.ImgSpace" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into img_space (img_id, img_name, parent_id, 
      type, file_path, sys_id, 
      dealer_id, user_id, create_time, 
      status)
    values (#{imgId,jdbcType=INTEGER}, #{imgName,jdbcType=VARCHAR}, #{parentId,jdbcType=INTEGER}, 
      #{type,jdbcType=TINYINT}, #{filePath,jdbcType=VARCHAR}, #{sysId,jdbcType=VARCHAR}, 
      #{dealerId,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, 
      #{status,jdbcType=BIT})
  </insert>
  <insert id="insertSelective" parameterType="com.yihg.images.po.ImgSpace" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into img_space
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="imgId != null" >
        img_id,
      </if>
      <if test="imgName != null" >
        img_name,
      </if>
      <if test="parentId != null" >
        parent_id,
      </if>
      <if test="type != null" >
        type,
      </if>
      <if test="filePath != null" >
        file_path,
      </if>
      <if test="sysId != null" >
        sys_id,
      </if>
      <if test="dealerId != null" >
        dealer_id,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="imgId != null" >
        #{imgId,jdbcType=INTEGER},
      </if>
      <if test="imgName != null" >
        #{imgName,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null" >
        #{parentId,jdbcType=INTEGER},
      </if>
      <if test="type != null" >
        #{type,jdbcType=TINYINT},
      </if>
      <if test="filePath != null" >
        #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="sysId != null" >
        #{sysId,jdbcType=VARCHAR},
      </if>
      <if test="dealerId != null" >
        #{dealerId,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        #{status,jdbcType=BIT},
      </if>
    </trim>
  </insert>
 <insert  id="insertListImgSpaces"  parameterType="java.util.List" > 
	    insert into img_space (img_name, parent_id, type, file_path, sys_id, dealer_id, user_id, create_time, status)
	    values   
	  
	<foreach collection="list"  item="item" index="index" separator=",">  
	         (#{item.imgName}, #{item.parentId}, 
      #{item.type}, #{item.filePath}, #{item.sysId}, 
      #{item.dealerId}, #{item.userId}, #{item.createTime}, 
      #{item.status})  
	    </foreach>  
  </insert >
  <update id="updateByPrimaryKeySelective" parameterType="com.yihg.images.po.ImgSpace" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update img_space
    <set >
      <if test="imgName != null" >
        img_name = #{imgName,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null" >
        parent_id = #{parentId,jdbcType=INTEGER},
      </if>
      <if test="type != null" >
        type = #{type,jdbcType=TINYINT},
      </if>
      <if test="filePath != null" >
        file_path = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="sysId != null" >
        sys_id = #{sysId,jdbcType=VARCHAR},
      </if>
      <if test="dealerId != null" >
        dealer_id = #{dealerId,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=BIT},
      </if>
    </set>
    where img_id = #{imgId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.yihg.images.po.ImgSpace" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update img_space
    set img_name = #{imgName,jdbcType=VARCHAR},
      parent_id = #{parentId,jdbcType=INTEGER},
      type = #{type,jdbcType=TINYINT},
      file_path = #{filePath,jdbcType=VARCHAR},
      sys_id = #{sysId,jdbcType=VARCHAR},
      dealer_id = #{dealerId,jdbcType=INTEGER},
      user_id = #{userId,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=BIT}
    where img_id = #{imgId,jdbcType=INTEGER}
  </update>
  
  <select id="selectDirTreeByConditions" resultType="com.yihg.images.dto.TreeDto" parameterType="com.yihg.images.po.ImgSpace">
  	SELECT img_id AS id,img_name AS NAME,parent_id AS pid FROM img_space
  	where 1=1
  	<if test="imgName != null" >
        and img_name = #{imgName,jdbcType=VARCHAR}
      </if>
      <if test="parentId != null" >
        and parent_id = #{parentId,jdbcType=INTEGER}
      </if>
      <if test="type != null" >
        and type = #{type,jdbcType=TINYINT}
      </if>
      <if test="filePath != null" >
        and file_path = #{filePath,jdbcType=VARCHAR}
      </if>
      <if test="sysId != null" >
        and sys_id = #{sysId,jdbcType=VARCHAR}
      </if>
      <if test="dealerId != null" >
        and dealer_id = #{dealerId,jdbcType=INTEGER}
      </if>
      <if test="userId != null" >
        and user_id = #{userId,jdbcType=INTEGER}
      </if>
      <if test="createTime != null" >
        and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="status != null" >
        and status = #{status,jdbcType=BIT}
      </if>
  
  </select>
  
  <!-- 分页查询图片空间内容 -->
  <select id="selectImgSpaceListPage" resultMap="BaseResultMap" parameterType="com.yihg.mybatis.utility.PageBean">
  	select
	 <include refid="Base_Column_List" />
  	from img_space
    where 1 = 1
	   <if test="parameter != null">
	    <if test="parameter.imgName != null" >
	        and img_name like CONCAT('%',#{parameter.imgName},'%') 
	      </if>
	      <if test="parameter.parentId != null" >
	        and parent_id = #{parameter.parentId,jdbcType=INTEGER}
	      </if>
	      <if test="parameter.type != null" >
	        and type = #{parameter.type,jdbcType=TINYINT}
	      </if>
	      <if test="parameter.filePath != null" >
	        and file_path = #{parameter.filePath,jdbcType=VARCHAR}
	      </if>
	      <if test="parameter.sysId != null" >
	        and sys_id = #{parameter.sysId,jdbcType=VARCHAR}
	      </if>
	      <if test="parameter.dealerId != null" >
	        and dealer_id = #{parameter.dealerId,jdbcType=INTEGER}
	      </if>
	      <if test="parameter.userId != null" >
	        and user_id = #{parameter.userId,jdbcType=INTEGER}
	      </if>
	      <if test="parameter.createTime != null" >
	        and create_time = #{parameter.createTime,jdbcType=TIMESTAMP}
	      </if>
	      <if test="parameter.updateTime != null" >
	        and update_time = #{parameter.updateTime,jdbcType=TIMESTAMP}
	      </if>
	      <if test="parameter.status != null" >
	        and status = #{parameter.status,jdbcType=BIT}
	      </if>
	  </if>
  </select>
  <!-- 20150709 added by gejinjun 不分页功能 -->
  <select id="selectImgSpaceList" resultMap="BaseResultMap">
  	select
	 <include refid="Base_Column_List" />
  	from img_space s
    where 1 = 1
	   <if test="space != null">
	    <if test="space.imgName != null" >
	        and img_name like CONCAT('%',#{space.imgName},'%') 
	      </if>
	      <if test="space.parentId != null" >
	        and parent_id = #{space.parentId,jdbcType=INTEGER}
	      </if>
	      <if test="space.type != null" >
	        and type = #{space.type,jdbcType=TINYINT}
	      </if>
	      <if test="space.filePath != null" >
	        and file_path = #{space.filePath,jdbcType=VARCHAR}
	      </if>
	      <if test="space.sysId != null" >
	        and sys_id = #{space.sysId,jdbcType=VARCHAR}
	      </if>
	      <if test="space.dealerId != null" >
	        and dealer_id = #{space.dealerId,jdbcType=INTEGER}
	      </if>
	      <if test="space.userId != null" >
	        and user_id = #{space.userId,jdbcType=INTEGER}
	      </if>
	      <if test="space.createTime != null" >
	        and create_time = #{space.createTime,jdbcType=TIMESTAMP}
	      </if>
	      <if test="space.updateTime != null" >
	        and update_time = #{space.updateTime,jdbcType=TIMESTAMP}
	      </if>
	      <if test="space.status != null" >
	        and status = #{space.status,jdbcType=BIT}
	      </if>
	  </if>
	  <if test="sortFileds!=null">
	  	order by ${sortFileds} <if test="order!=null"> ${order}</if>
	  </if>
  </select>
  
  <select id="selectImgSpaceListWithStartAndSize" resultMap="BaseResultMap" parameterType="com.yihg.images.dto.PageDto">
  	select
	 <include refid="Base_Column_List" />
  	from img_space
    where 1 = 1
	
	      <if test="type != null" >
	        and type = #{type,jdbcType=TINYINT}
	      </if>
	      <if test="sysId != null" >
	        and sys_id = #{sysId,jdbcType=VARCHAR}
	      </if>
	      <if test="dealerId != null" >
	        and dealer_id = #{dealerId,jdbcType=INTEGER}
	      </if>
	      <if test="userId != null" >
	        and user_id = #{userId,jdbcType=INTEGER}
	      </if>
	      <if test="status != null" >
	        and status = #{status,jdbcType=BIT} 
	      </if>
	      <if test="start != null" >
	         limit  #{start,jdbcType=INTEGER},#{size,jdbcType=INTEGER}
	      </if>
	       
  </select>
  
  <!-- 删除 -->
  <delete id="imageDelete" >
  	  UPDATE  `img_space`  SET `status` = -1,update_time = #{updateTime} WHERE (img_id = #{parentId} OR parent_id = #{parentId});
  </delete>
  
  
  <!-- 还原 -->
  <delete id="restoreImageById" >
  	  UPDATE `img_space` t SET t.`status` = 1 ,t.`parent_id` = 0 WHERE t.`img_id` = #{imageId};
  </delete>
  
  
  <!-- 查询 parentId -->
  <select id="queryImageById" resultType="int">
   	  SELECT t.`parent_id` FROM img_space t WHERE t.`img_id` = #{imageId} 
  </select>
  
  <!-- 永久性删除  -->
  <delete id="perpetualDelRestore">
  	  DELETE FROM img_space WHERE (img_id = #{imageId} OR parent_id = #{imageId});
  </delete>
  
  <update id="imageRename">
  	 UPDATE `img_space` t SET t.`img_name` = #{imgName} WHERE t.`img_id` = #{imageId};
  </update>
  <!-- 移动图片或者文件夹 -->
  <update id="moveImage">
  	 UPDATE `img_space` t SET t.`parent_id` = #{parentId} WHERE t.`img_id` = #{imageId};
  </update>
  <!-- 图片替换 -->
  <update id="replaceImage">
  	 UPDATE `img_space` t SET t.`img_name` = #{fileName}, t.`file_path` = #{uploadFileUrl} WHERE t.`img_id` = #{imageId};
  </update>
  <update id="updateNewPathName">
  	UPDATE `img_space` t SET t.`file_path_new` = #{newPathName} WHERE t.`img_id` = #{id};
  </update>
</mapper>